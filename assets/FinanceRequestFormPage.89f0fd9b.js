import{Q as se}from"./QToolbarTitle.6ccd69c9.js";import{Q as re}from"./QToolbar.6678c232.js";import{Q as de}from"./QHeader.433aa874.js";import{s as ae,v as fe,x as H,N as O,O as ce,z as v,F as k,H as me,U as ve,A as w,C as Y,D as pe,ak as ge,ac as ne,aj as ye,aa as be,af as he,_ as Fe,i as Ve,u as qe,a as Re,f as xe,a6 as Se,o as A,k as I,w as h,l as c,p as Z,t as E,m,a4 as K,aQ as Ce,aN as _e,Q as ee,b5 as Qe}from"./index.943c308d.js";import{p as ze,a as we,Q as W}from"./QSelect.444deb37.js";import{f as Oe,j as Ne,g as Ue,i as ke,k as Pe,o as je,l as te,h as De,Q as Te,a as X,c as B}from"./QInput.0d863c51.js";import{Q as le}from"./QSpace.38c37b7b.js";import{Q as Ae}from"./QPage.457c46a8.js";import{b as Ie,Q as Be,a as Le}from"./QLayout.77abe9cd.js";import{Q as Me}from"./QItem.9e778489.js";var $e=ae({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:g,emit:x}){const{proxy:{$q:n}}=Y(),t=fe(pe,H);if(t===H)return console.error("QFooter needs to be child of QLayout"),H;const f=O(parseInt(e.heightHint,10)),p=O(!0),S=O(ce.value===!0||t.isContainer.value===!0?0:window.innerHeight),C=v(()=>e.reveal===!0||t.view.value.indexOf("F")>-1||n.platform.is.ios&&t.isContainer.value===!0),F=v(()=>t.isContainer.value===!0?t.containerHeight.value:S.value),V=v(()=>{if(e.modelValue!==!0)return 0;if(C.value===!0)return p.value===!0?f.value:0;const i=t.scroll.value.position+F.value+f.value-t.height.value;return i>0?i:0}),u=v(()=>e.modelValue!==!0||C.value===!0&&p.value!==!0),_=v(()=>e.modelValue===!0&&u.value===!0&&e.reveal===!0),r=v(()=>"q-footer q-layout__section--marginal "+(C.value===!0?"fixed":"absolute")+"-bottom"+(e.bordered===!0?" q-footer--bordered":"")+(u.value===!0?" q-footer--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus"+(C.value!==!0?" hidden":""):"")),j=v(()=>{const i=t.rows.value.bottom,a={};return i[0]==="l"&&t.left.space===!0&&(a[n.lang.rtl===!0?"right":"left"]=`${t.left.size}px`),i[2]==="r"&&t.right.space===!0&&(a[n.lang.rtl===!0?"left":"right"]=`${t.right.size}px`),a});function s(i,a){t.update("footer",i,a)}function Q(i,a){i.value!==a&&(i.value=a)}function D({height:i}){Q(f,i),s("size",i)}function l(){if(e.reveal!==!0)return;const{direction:i,position:a,inflectionPoint:b}=t.scroll.value;Q(p,i==="up"||a-b<100||t.height.value-F.value-a-f.value<300)}function q(i){_.value===!0&&Q(p,!0),x("focusin",i)}k(()=>e.modelValue,i=>{s("space",i),Q(p,!0),t.animate()}),k(V,i=>{s("offset",i)}),k(()=>e.reveal,i=>{i===!1&&Q(p,e.modelValue)}),k(p,i=>{t.animate(),x("reveal",i)}),k([f,t.scroll,t.height],l),k(()=>n.screen.height,i=>{t.isContainer.value!==!0&&Q(S,i)});const N={};return t.instances.footer=N,e.modelValue===!0&&s("size",f.value),s("space",e.modelValue),s("offset",V.value),me(()=>{t.instances.footer===N&&(t.instances.footer=void 0,s("size",0),s("offset",0),s("space",!1))}),()=>{const i=ve(g.default,[w(Ie,{debounce:0,onResize:D})]);return e.elevated===!0&&i.push(w("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),w("footer",{class:r.value,style:j.value,onFocusin:q},i)}}});function P(e,g,x,n){const t=[];return e.forEach(f=>{n(f)===!0?t.push(f):g.push({failedPropValidation:x,file:f})}),t}function L(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),ne(e)}const He={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ee=["rejected"];function Ke({editable:e,dnd:g,getFileInput:x,addFilesToQueue:n}){const{props:t,emit:f,proxy:p}=Y(),S=O(null),C=v(()=>t.accept!==void 0?t.accept.split(",").map(l=>(l=l.trim(),l==="*"?"*/":(l.endsWith("/*")&&(l=l.slice(0,l.length-1)),l.toUpperCase()))):null),F=v(()=>parseInt(t.maxFiles,10)),V=v(()=>parseInt(t.maxTotalSize,10));function u(l){if(e.value)if(l!==Object(l)&&(l={target:null}),l.target!==null&&l.target.matches('input[type="file"]')===!0)l.clientX===0&&l.clientY===0&&ge(l);else{const q=x();q&&q!==l.target&&q.click(l)}}function _(l){e.value&&l&&n(null,l)}function r(l,q,N,i){let a=Array.from(q||l.target.files);const b=[],U=()=>{b.length!==0&&f("rejected",b)};if(t.accept!==void 0&&C.value.indexOf("*/")===-1&&(a=P(a,b,"accept",d=>C.value.some(y=>d.type.toUpperCase().startsWith(y)||d.name.toUpperCase().endsWith(y))),a.length===0))return U();if(t.maxFileSize!==void 0){const d=parseInt(t.maxFileSize,10);if(a=P(a,b,"max-file-size",y=>y.size<=d),a.length===0)return U()}if(t.multiple!==!0&&a.length!==0&&(a=[a[0]]),a.forEach(d=>{d.__key=d.webkitRelativePath+d.lastModified+d.name+d.size}),i===!0){const d=N.map(y=>y.__key);a=P(a,b,"duplicate",y=>d.includes(y.__key)===!1)}if(a.length===0)return U();if(t.maxTotalSize!==void 0){let d=i===!0?N.reduce((y,M)=>y+M.size,0):0;if(a=P(a,b,"max-total-size",y=>(d+=y.size,d<=V.value)),a.length===0)return U()}if(typeof t.filter=="function"){const d=t.filter(a);a=P(a,b,"filter",y=>d.includes(y))}if(t.maxFiles!==void 0){let d=i===!0?N.length:0;if(a=P(a,b,"max-files",()=>(d++,d<=F.value)),a.length===0)return U()}if(U(),a.length!==0)return a}function j(l){L(l),g.value!==!0&&(g.value=!0)}function s(l){ne(l),(l.relatedTarget!==null||ye.is.safari!==!0?l.relatedTarget!==S.value:document.elementsFromPoint(l.clientX,l.clientY).includes(S.value)===!1)===!0&&(g.value=!1)}function Q(l){L(l);const q=l.dataTransfer.files;q.length!==0&&n(null,q),g.value=!1}function D(l){if(g.value===!0)return w("div",{ref:S,class:`q-${l}__dnd absolute-full`,onDragenter:L,onDragover:L,onDragleave:s,onDrop:Q})}return Object.assign(p,{pickFiles:u,addFiles:_}),{pickFiles:u,addFiles:_,onDragover:j,onDragleave:s,processFiles:r,getDndNode:D,maxFilesNumber:F,maxTotalSizeNumber:V}}var We=ae({name:"QFile",inheritAttrs:!1,props:{...Oe,...Ne,...He,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Ue,...Ee],setup(e,{slots:g,emit:x,attrs:n}){const{proxy:t}=Y(),f=ke(),p=O(null),S=O(!1),C=Pe(e),{pickFiles:F,onDragover:V,onDragleave:u,processFiles:_,getDndNode:r}=Ke({editable:f.editable,dnd:S,getFileInput:G,addFilesToQueue:J}),j=je(e),s=v(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),Q=v(()=>te(s.value)),D=v(()=>s.value.map(o=>o.name).join(", ")),l=v(()=>ze(s.value.reduce((o,R)=>o+R.size,0))),q=v(()=>({totalSize:l.value,filesNumber:s.value.length,maxFiles:e.maxFiles})),N=v(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:C.value,...n,id:f.targetUid.value,disabled:f.editable.value!==!0})),i=v(()=>"q-file q-field--auto-height"+(S.value===!0?" q-file--dnd":"")),a=v(()=>e.multiple===!0&&e.append===!0);function b(o){const R=s.value.slice();R.splice(o,1),d(R)}function U(o){const R=s.value.indexOf(o);R>-1&&b(R)}function d(o){x("update:modelValue",e.multiple===!0?o:o[0])}function y(o){o.keyCode===13&&he(o)}function M(o){(o.keyCode===13||o.keyCode===32)&&F(o)}function G(){return p.value}function J(o,R){const z=_(o,R,s.value,a.value),$=G();$!=null&&($.value=""),z!==void 0&&((e.multiple===!0?e.modelValue&&z.every(oe=>s.value.includes(oe)):e.modelValue===z[0])||d(a.value===!0?s.value.concat(z):z))}function T(){return[w("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function ue(){if(g.file!==void 0)return s.value.length===0?T():s.value.map((R,z)=>g.file({index:z,file:R,ref:this}));if(g.selected!==void 0)return s.value.length===0?T():g.selected({files:s.value,ref:this});if(e.useChips===!0)return s.value.length===0?T():s.value.map((R,z)=>w(we,{key:"file-"+z,removable:f.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{b(z)}},()=>w("span",{class:"ellipsis",textContent:R.name})));const o=e.displayValue!==void 0?e.displayValue:D.value;return o.length!==0?[w("div",{class:e.inputClass,style:e.inputStyle,textContent:o})]:T()}function ie(){const o={ref:p,...N.value,...j.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:J};return e.multiple===!0&&(o.multiple=!0),w("input",o)}return Object.assign(f,{fieldClass:i,emitValue:d,hasValue:Q,inputRef:p,innerValue:s,floatingLabel:v(()=>Q.value===!0||te(e.displayValue)),computedCounter:v(()=>{if(e.counterLabel!==void 0)return e.counterLabel(q.value);const o=e.maxFiles;return`${s.value.length}${o!==void 0?" / "+o:""} (${l.value})`}),getControlChild:()=>r("file"),getControl:()=>{const o={ref:f.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return f.editable.value===!0&&Object.assign(o,{onDragover:V,onDragleave:u,onKeydown:y,onKeyup:M}),w("div",o,[ie()].concat(ue()))}}),Object.assign(t,{removeAtIndex:b,removeFile:U,getNativeElement:()=>p.value}),be(t,"nativeEl",()=>p.value),De(f)}});const Xe=Ve({__name:"FinanceRequestFormPage",setup(e){const g=qe(),x=Re(),n=xe(),t=O(),f=O(),p=O();Se(()=>{g.readSettings(),x.readAllUsers(),n.readFinanceRequestData()});async function S(V){console.log("At the start of fileOnUpdate: ",n.financeRequest.file),p.value=URL.createObjectURL(V),await Qe(p.value),n.financeRequest.file&&t.value&&(n.financeRequest.file.name=t.value.name,n.financeRequest.file.url=p.value)}const C=v(()=>!n.financeRequest.newValue||!n.financeRequest.requestMessage||!n.recipientOption.value),F=v(()=>{const V=n.financeRequest.fieldType;return V==="number"?{type:"number",rules:[u=>!!u||"Required",u=>/^\d*\.?\d*$/.test(u.toString())||"Only numbers are allowed"]}:V==="date"?{type:"date",rules:[u=>!!u||"Required"]}:{type:"text",rules:[u=>!!u||"Required"]}});return(V,u)=>(A(),I(Be,{view:"hHh lpR fFf"},{default:h(()=>[c(de,null,{default:h(()=>[c(re,{class:"bg-primary"},{default:h(()=>[c(se,null,{default:h(()=>[Z(" Finance Request Form ")]),_:1})]),_:1})]),_:1}),c(Le,null,{default:h(()=>[c(Ae,null,{default:h(()=>[c(Te,{style:{"min-height":"450px"}},{default:h(()=>{var _;return[Z(" financeStore.financeRequest.file: "+E(m(n).financeRequest.file)+" fileModel: "+E((_=t.value)==null?void 0:_.type)+"  fileURL: "+E(p.value)+" ",1),c(m(We),{ref_key:"fileRef",ref:f,modelValue:t.value,"onUpdate:modelValue":[u[1]||(u[1]=r=>t.value=r),S],"max-files":1,"use-chips":""},{before:h(()=>[c(K,{name:"attach_file"})]),append:h(()=>[t.value!==null?(A(),I(K,{key:0,name:"close",class:"cursor-pointer"})):Ce("",!0),c(K,{name:"note_add",onClick:u[0]||(u[0]=_e(()=>{},["stop","prevent"]))})]),_:1},8,["modelValue"]),c(X,null,{default:h(()=>[c(W,{modelValue:m(g).loggedUser.fullName,"onUpdate:modelValue":u[2]||(u[2]=r=>m(g).loggedUser.fullName=r),options:m(x).userOptions,label:"Requester",disable:"",outlined:"",dense:""},null,8,["modelValue","options"]),c(W,{modelValue:m(n).recipientOption,"onUpdate:modelValue":u[3]||(u[3]=r=>m(n).recipientOption=r),options:m(x).userOptions,label:"Request to","lazy-rules":"",rules:[r=>!!r||"Required"],outlined:"",dense:""},null,8,["modelValue","options","rules"]),c(B,{modelValue:m(n).financeRequest.fieldName,"onUpdate:modelValue":u[4]||(u[4]=r=>m(n).financeRequest.fieldName=r),label:"Field",disable:"",outlined:"",dense:""},null,8,["modelValue"]),c(X,{horizontal:"",class:"q-gutter-md"},{default:h(()=>[c(B,{modelValue:m(n).financeRequest.originalValue,"onUpdate:modelValue":u[5]||(u[5]=r=>m(n).financeRequest.originalValue=r),label:"Original Value",type:F.value.type,disable:"",outlined:"",dense:"","input-style":F.value.type==="number"?"text-align: right":""},null,8,["modelValue","type","input-style"]),c(le),m(n).financeRequest.fieldOptions?(A(),I(W,{key:0,modelValue:m(n).financeRequest.newValue,"onUpdate:modelValue":u[6]||(u[6]=r=>m(n).financeRequest.newValue=r),options:m(n).financeRequest.fieldOptions,label:"New Value","emit-value":"",outlined:"",dense:"",style:{"min-width":"200px"}},null,8,["modelValue","options"])):(A(),I(B,{key:1,modelValue:m(n).financeRequest.newValue,"onUpdate:modelValue":u[7]||(u[7]=r=>m(n).financeRequest.newValue=r),label:"New Value",type:F.value.type,rules:F.value.rules,outlined:"",dense:"","input-style":F.value.type==="number"?"text-align: right":""},null,8,["modelValue","type","rules","input-style"]))]),_:1})]),_:1}),c(X,null,{default:h(()=>[c(B,{modelValue:m(n).financeRequest.requestMessage,"onUpdate:modelValue":u[8]||(u[8]=r=>m(n).financeRequest.requestMessage=r),label:"Request Message","lazy-rules":"",type:"textarea",autogrow:"",rules:[r=>!!r||"Required"],outlined:"",dense:""},null,8,["modelValue","rules"])]),_:1})]}),_:1})]),_:1})]),_:1}),c($e,{style:{"background-color":"var(--primary-white)"},class:"text-white"},{default:h(()=>[c(Me,null,{default:h(()=>[c(ee,{color:"primary",type:"cancel",label:"Cancel",onClick:u[9]||(u[9]=_=>m(n).cancelFinanceRequest())}),c(le),c(ee,{color:"primary",type:"submit",label:"Submit Request",onClick:u[10]||(u[10]=_=>m(n).sendFinanceRequest()),disable:C.value},null,8,["disable"])]),_:1})]),_:1})]),_:1}))}});var it=Fe(Xe,[["__scopeId","data-v-18e9cb8e"]]);export{it as default};
