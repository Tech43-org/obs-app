import{Q as sl,a as vt}from"./QBadge.2c7b1294.js";import{k as Ge,d as O,f as Qe,e as mt,a as be,h as je,u as ul,l as il,m as kt,j as dl,b as ve,Q as xe,i as Le}from"./QSeparator.80e4d2f7.js";import{N as ee,a as te,u as Ve,y as I,w as Q,F as M,G as z,H as s,P as b,I as l,Y as q,Q as F,a4 as K,Z as R,K as J,aL as ft,h as S,aM as cl,e as Tt,L as We,X as qt,W as Je,_ as xt,aN as Y,aO as Pt,aP as vl,f as ae,j as y,k as ie,V as ml,l as de,O as Ke,o as Vt,au as fl,ae as bl,q as Dt,s as gl,t as bt,D as Nt,aa as yl,a8 as _l,ac as Sl,ab as gt,aQ as He,aR as yt,aS as pl,J as Rt,aT as wl,as as me,aU as Ye,aV as _t,aW as ke}from"./index.98bb2068.js";import{Q as Ze,a as hl}from"./QToolbar.a134ff33.js";import{Q as Cl}from"./QPage.548f4734.js";import{c as G,a as Xe,Q as Z,b as $t,u as et,d as tt}from"./QList.b5d1b5a3.js";import{a as E,Q as X,e as ze}from"./QToggle.db13b9dd.js";import"./QResizeObserver.b1b7d677.js";import"./QBtnGroup.fac44ed0.js";const Ul=J("br",null,null,-1),kl=ee({__name:"UserCreateDrawer",setup(e){const t=te(),n=Ve(),u=I({subject:"",body:""});Q(()=>({givenName:t.user.givenName,surname:t.user.surname}),c=>{u.value.subject=`Onboarding ${c.givenName} ${c.surname}`,u.value.body=`Please add ${c.givenName} to the Active Directory.
Name: ${c.givenName}
Surname: ${c.surname}

Thanks

This email has been sent from FileMaker by ${n.user.fullName}`},{immediate:!0});const i=()=>{t.user={givenName:"",surname:"",status:"Pending",groupId:null}};return(c,o)=>(M(),z(Ge,{modelValue:b(t).createMode,"onUpdate:modelValue":o[5]||(o[5]=v=>b(t).createMode=v),onBeforeShow:o[6]||(o[6]=v=>i()),width:384,bordered:"",overlay:"",side:"right"},{default:s(()=>[l(X,null,{default:s(()=>[l(E,null,{default:s(()=>[l(Ze,null,{default:s(()=>[q(" Create User ")]),_:1}),l(G,{class:"text-body2"},{default:s(()=>[q(" A new User will be created and, an email request to add him/her to Active Directory will be send ")]),_:1}),Ul,l(F,{dense:"",label:"Create User and Send Request",icon:"person_add",color:"primary",onClick:o[0]||(o[0]=v=>b(t).createUser(u.value)),disable:!b(t).user.givenName||!b(t).user.surname},null,8,["disable"])]),_:1}),l(E,null,{default:s(()=>[l(O,{modelValue:b(t).user.givenName,"onUpdate:modelValue":o[1]||(o[1]=v=>b(t).user.givenName=v),label:"Name",rules:[v=>!!v||"Name is required"]},null,8,["modelValue","rules"]),l(O,{modelValue:b(t).user.surname,"onUpdate:modelValue":o[2]||(o[2]=v=>b(t).user.surname=v),label:"Surname",rules:[v=>!!v||"Surname is required"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(X,{class:"bg-blue-2"},{default:s(()=>[l(E,null,{default:s(()=>[l(Xe,{style:{"background-color":"hsl(200, 50%, 90%)"}},{default:s(()=>[l(Z,{avatar:""},{default:s(()=>[l(K,{name:"mail"})]),_:1}),l(Z,null,{default:s(()=>[q(R(b(n).bookingsSupportEmail),1)]),_:1})]),_:1}),l(O,{modelValue:u.value.subject,"onUpdate:modelValue":o[3]||(o[3]=v=>u.value.subject=v),label:"Subject"},null,8,["modelValue"]),l(O,{modelValue:u.value.body,"onUpdate:modelValue":o[4]||(o[4]=v=>u.value.body=v),label:"Body",type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Tl=ee({__name:"UserUpdateDrawer",setup(e){const t=te(),n=Ve(),u=I({subject:"",body:""}),i=I(320),c=()=>{t.user=JSON.parse(JSON.stringify(t.selectedUser))},o=()=>{if(t.selectedUser.status!=="Inactive"&&t.user.status==="Inactive"){t.user.groupId=null;const v=t.user.email;t.user.email=null,i.value=720,u.value.subject=`Deauthorize ${t.user.givenName} ${t.user.surname}`,u.value.body=`Please remove ${t.user.givenName} from the Active Directory.
Name: ${t.user.givenName}
Surname: ${t.user.surname}
Email: ${v}
 
Thanks
 
This email has been sent from FileMaker by ${n.user.fullName}`}else i.value=320};return(v,a)=>(M(),z(Ge,{modelValue:b(t).editMode,"onUpdate:modelValue":a[11]||(a[11]=f=>b(t).editMode=f),onBeforeShow:a[12]||(a[12]=f=>c()),onBeforeHide:a[13]||(a[13]=f=>i.value=320),width:i.value,bordered:"",overlay:"",side:"right",class:"row"},{default:s(()=>[l(X,{class:"col"},{default:s(()=>[l(E,{horizontal:""},{default:s(()=>[l(Ze,null,{default:s(()=>[q(" Edit User ")]),_:1}),l(F,{dense:"",label:"Save Changes",icon:"save",color:"primary",onClick:a[0]||(a[0]=f=>b(t).updateUser(u.value)),disable:b(t).user.status==="Active"&&!b(t).user.groupId},null,8,["disable"])]),_:1}),l(E,null,{default:s(()=>[l(O,{modelValue:b(t).user.givenName,"onUpdate:modelValue":a[1]||(a[1]=f=>b(t).user.givenName=f),label:"Name"},null,8,["modelValue"]),l(O,{modelValue:b(t).user.surname,"onUpdate:modelValue":a[2]||(a[2]=f=>b(t).user.surname=f),label:"Surname"},null,8,["modelValue"]),l(O,{modelValue:b(t).user.loginName,"onUpdate:modelValue":a[3]||(a[3]=f=>b(t).user.loginName=f),label:"Login"},null,8,["modelValue"]),l(O,{modelValue:b(t).user.email,"onUpdate:modelValue":a[4]||(a[4]=f=>b(t).user.email=f),label:"Email",type:"email",rules:[f=>!f||/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(f)||"Invalid email"]},null,8,["modelValue","rules"]),l(O,{modelValue:b(t).user.note,"onUpdate:modelValue":a[5]||(a[5]=f=>b(t).user.note=f),label:"Note",type:"textarea"},null,8,["modelValue"])]),_:1}),l(E,{style:{"background-color":"rgb(197, 198, 198)","border-radius":"4%"}},{default:s(()=>[l(Qe,{modelValue:b(t).user.status,"onUpdate:modelValue":[a[6]||(a[6]=f=>b(t).user.status=f),a[7]||(a[7]=f=>o())],label:"Status",options:b(t).statusOptions},null,8,["modelValue","options"]),l(Qe,{modelValue:b(t).user.groupId,"onUpdate:modelValue":a[8]||(a[8]=f=>b(t).user.groupId=f),"emit-value":"","map-options":"",label:"Group",clearable:"",disable:b(t).user.status!=="Active",options:b(n).groupsOptions},null,8,["modelValue","disable","options"])]),_:1}),b(t).user.status==="Active"&&(b(t).user.groupId===null||b(t).user.groupId==="")?(M(),z(E,{key:0},{default:s(()=>[l(mt,{class:"bg-orange text-white",rounded:""},{avatar:s(()=>[l(K,{name:"warning"})]),default:s(()=>[q(" Select a Group before saving changes ")]),_:1})]),_:1})):ft("",!0)]),_:1}),b(t).selectedUser.status!=="Inactive"&&b(t).user.status==="Inactive"?(M(),z(X,{key:0,class:"col"},{default:s(()=>[l(E,null,{default:s(()=>[l(mt,{class:"bg-red text-white",rounded:""},{avatar:s(()=>[l(K,{name:"warning"})]),default:s(()=>[q(" You are going to inactivate this user, the email and the group associated will be removed and an email to unauthorized the user will be sent. ")]),_:1})]),_:1}),l(X,{class:"bg-blue-2"},{default:s(()=>[l(E,null,{default:s(()=>[l(Xe,{style:{"background-color":"hsl(200, 50%, 90%)"}},{default:s(()=>[l(Z,{avatar:""},{default:s(()=>[l(K,{name:"mail"})]),_:1}),l(Z,null,{default:s(()=>[q(R(b(n).bookingsSupportEmail),1)]),_:1})]),_:1}),l(O,{modelValue:u.value.subject,"onUpdate:modelValue":a[9]||(a[9]=f=>u.value.subject=f),label:"Subject"},null,8,["modelValue"]),l(O,{modelValue:u.value.body,"onUpdate:modelValue":a[10]||(a[10]=f=>u.value.body=f),label:"Body",type:"textarea",autogrow:"",hint:"The email can be personalized before sending it."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):ft("",!0)]),_:1},8,["modelValue","width"]))}}),ql=[{label:"Activity ID",value:"activityId",table:"z_ACT_Activity",field:"_kplt_Activity",type:"text",sql:"act"},{label:"Created At",value:"createdAt",table:"z_ACT_Activity",field:"CreatedAtUnix",type:"number",sql:"act"},{label:"Performer User ID",value:"performerUserId",table:"z_ACT_Activity",field:"_kflt_User_Performer",type:"text",sql:"act"},{label:"Performer User Name",value:"performerUserName",table:"z_CD_USE_Users",field:"Name",type:"text",sql:"use1"},{label:"Performer User Surname",value:"performerUserSurname",table:"z_CD_USE_Users",field:"Surname",type:"text",sql:"use1"},{label:"Related User ID",value:"relatedUserId",table:"z_ACT_Activity",field:"_kflt_User_Related",type:"text",sql:"act"},{label:"Related User Name",value:"relatedUserName",table:"z_CD_USE_Users",field:"Name",type:"text",sql:"use2"},{label:"Related User Surname",value:"relatedUserSurname",table:"z_CD_USE_Users",field:"Surname",type:"text",sql:"use2"},{label:"Action",value:"action",table:"z_ACT_Activity",field:"Action",type:"text",sql:"act"},{label:"Description",value:"description",table:"z_ACT_Activity",field:"Description",type:"text",sql:"act"},{label:"Note",value:"note",table:"z_ACT_Activity",field:"Note",type:"text",sql:"act"}],Pe=S(()=>cl(ql));S(()=>I("SELECT "+Pe.value.map(t=>t)+" FROM z_ACT_Activity AS act").value);const xl=S(()=>{const e=te(),t=I("SELECT "+Pe.value.map(n=>n)+" FROM z_ACT_Activity AS act");return Pe.value.some(n=>n.indexOf("use1.")!==-1)&&(t.value+=' LEFT OUTER JOIN z_CD_USE_Users AS use1 ON use1."_kplt_User" = act."_kflt_User_Performer" '),Pe.value.some(n=>n.indexOf("use2.")!==-1)&&(t.value+=' LEFT OUTER JOIN z_CD_USE_Users AS use2 ON use2."_kplt_User" = act."_kflt_User_Related" '),t.value+=` WHERE act."_kflt_User_Performer" ='${e.selectedUser.userId}' OR act."_kflt_User_Related" ='${e.selectedUser.userId}'`,t.value});const Pl=ee({__name:"UsersList",setup(e){const t=te(),n=Tt(),u=i=>{t.selectedUser=i,t.editMode=!1,t.createMode=!1,n.readActivity(xl.value)};return(i,c)=>(M(),z(X,{style:{width:"100%"}},{default:s(()=>[l($t,{style:{"margin-top":"76px"}},{default:s(()=>[(M(!0),We(Je,null,qt(b(t).filterUsers,o=>(M(),z(Xe,{key:o.userId,clickable:"",onClick:v=>u(o),class:"bg-grey-2 menu",active:b(t).selectedUser===o,"active-class":"menu-active"},{default:s(()=>[l(Z,{avatar:""},{default:s(()=>[l(Y,{style:Pt({backgroundColor:o.color}),class:"text-white"},{default:s(()=>[q(R(o.initials),1)]),_:2},1032,["style"])]),_:2},1024),l(Z,null,{default:s(()=>[l(G,{class:"text-h4"},{default:s(()=>[q(R(o.givenName),1)]),_:2},1024),l(G,{class:"text-h5"},{default:s(()=>[q(R(o.surname),1)]),_:2},1024)]),_:2},1024),l(Z,{side:"",top:""},{default:s(()=>[l(sl,{rounded:"",color:o.status==="Active"?"green":o.status==="Pending"?"orange":"grey"},null,8,["color"])]),_:2},1024)]),_:2},1032,["onClick","active"]))),128))]),_:1})]),_:1}))}});var Vl=xt(Pl,[["__scopeId","data-v-d8b8b4e8"]]);const Dl=ee({__name:"UserAvatar",setup(e){const t=te();return(n,u)=>(M(),z(Y,vl({style:{backgroundColor:b(t).selectedUser.color},class:"text-white"},n.$attrs),{default:s(()=>[q(R(b(t).selectedUser.initials),1)]),_:1},16,["style"]))}}),Nl=ee({__name:"UserInfoCard",setup(e){const t=te(),n=Ve();return(u,i)=>(M(),z(X,{style:{width:"16rem"}},{default:s(()=>[l(E,{class:"row"},{default:s(()=>[l(be),l(je,{dark:"",size:"md",label:b(t).selectedUser.status,color:b(t).selectedUser.status==="Active"?"green":b(t).selectedUser.status==="Pending"?"orange":"grey"},null,8,["label","color"])]),_:1}),l(E,{class:"column items-center q-pa-none"},{default:s(()=>[l(Dl,{size:"100px"})]),_:1}),l(E,null,{default:s(()=>[l(G,{class:"text-h3 text-center"},{default:s(()=>{var c;return[q(R((c=b(t).selectedUser)==null?void 0:c.givenName),1)]}),_:1}),l(G,{class:"text-h4 text-center"},{default:s(()=>{var c;return[q(R((c=b(t).selectedUser)==null?void 0:c.surname),1)]}),_:1})]),_:1}),l(E,{class:"bg-blue-2"},{default:s(()=>[l(Z,{avatar:""},{default:s(()=>[l(G,null,{default:s(()=>[q("Group")]),_:1}),l(G,{class:"text-h4"},{default:s(()=>[q(R(b(t).selectedUser.groupId?b(n).groups[b(t).selectedUser.groupId].name:"No Group"),1)]),_:1})]),_:1})]),_:1})]),_:1}))}});var le=ae({name:"QTh",props:{props:Object,autoWidth:Boolean},emits:["click"],setup(e,{slots:t,emit:n}){const u=de(),{proxy:{$q:i}}=u,c=o=>{n("click",o)};return()=>{if(e.props===void 0)return y("th",{class:e.autoWidth===!0?"q-table--col-auto-width":"",onClick:c},ie(t.default));let o,v;const a=u.vnode.key;if(a){if(o=e.props.colsMap[a],o===void 0)return}else o=e.props.col;if(o.sortable===!0){const m=o.align==="right"?"unshift":"push";v=ml(t.default,[]),v[m](y(K,{class:o.__iconClass,name:i.iconSet.table.arrowUp}))}else v=ie(t.default);const f={class:o.__thClass+(e.autoWidth===!0?" q-table--col-auto-width":""),style:o.headerStyle,onClick:m=>{o.sortable===!0&&e.props.sort(o),c(m)}};return y("th",f,v)}}}),ue=ae({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:t}){const n=de(),u=S(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return y("td",{class:u.value},ie(t.default));const i=n.vnode.key,c=(e.props.colsMap!==void 0?e.props.colsMap[i]:null)||e.props.col;if(c===void 0)return;const{row:o}=e.props;return y("td",{class:u.value+c.__tdClass(o),style:c.__tdStyle(o)},ie(t.default))}}}),Rl=ae({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:t}){const n=S(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>y("tr",{class:n.value},ie(t.default))}});const $l=["horizontal","vertical","cell","none"];var Al=ae({name:"QMarkupTable",props:{...et,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:e=>$l.includes(e)}},setup(e,{slots:t}){const n=de(),u=tt(e,n.proxy.$q),i=S(()=>`q-markup-table q-table__container q-table__card q-table--${e.separator}-separator`+(u.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(e.dense===!0?" q-table--dense":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")+(e.square===!0?" q-table--square":"")+(e.wrapCells===!1?" q-table--no-wrap":""));return()=>y("div",{class:i.value},[y("table",{class:"q-table"},ie(t.default))])}});function At(e,t){return y("div",e,[y("table",{class:"q-table"},t)])}const Fl={list:$t,table:Al},Ol=["list","table","__qtable"];var Il=ae({name:"QVirtualScroll",props:{...ul,type:{type:String,default:"list",validator:e=>Ol.includes(e)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}},setup(e,{slots:t,attrs:n}){let u;const i=I(null),c=S(()=>e.itemsSize>=0&&e.itemsFn!==void 0?parseInt(e.itemsSize,10):Array.isArray(e.items)?e.items.length:0),{virtualScrollSliceRange:o,localResetVirtualScroll:v,padVirtualScroll:a,onVirtualScrollEvt:f}=il({virtualScrollLength:c,getVirtualScrollTarget:V,getVirtualScrollEl:P}),m=S(()=>{if(c.value===0)return[];const p=(T,D)=>({index:o.value.from+D,item:T});return e.itemsFn===void 0?e.items.slice(o.value.from,o.value.to).map(p):e.itemsFn(o.value.from,o.value.to-o.value.from).map(p)}),C=S(()=>"q-virtual-scroll q-virtual-scroll"+(e.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(e.scrollTarget!==void 0?"":" scroll")),x=S(()=>e.scrollTarget!==void 0?{}:{tabindex:0});Q(c,()=>{v()}),Q(()=>e.scrollTarget,()=>{d(),w()});function P(){return i.value.$el||i.value}function V(){return u}function w(){u=gl(P(),e.scrollTarget),u.addEventListener("scroll",f,bt.passive)}function d(){u!==void 0&&(u.removeEventListener("scroll",f,bt.passive),u=void 0)}function g(){let p=a(e.type==="list"?"div":"tbody",m.value.map(t.default));return t.before!==void 0&&(p=t.before().concat(p)),Nt(t.after,p)}return Ke(()=>{v()}),Vt(()=>{w()}),fl(()=>{w()}),bl(()=>{d()}),Dt(()=>{d()}),()=>{if(t.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return e.type==="__qtable"?At({ref:i,class:"q-table__middle "+C.value},g()):y(Fl[e.type],{...n,ref:i,class:[n.class,C.value],...x.value},g)}}});const Ml={xs:2,sm:4,md:6,lg:10,xl:14};function St(e,t,n){return{transform:t===!0?`translateX(${n.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var Bl=ae({name:"QLinearProgress",props:{...et,...yl,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:t}){const{proxy:n}=de(),u=tt(e,n.$q),i=_l(e,Ml),c=S(()=>e.indeterminate===!0||e.query===!0),o=S(()=>e.reverse!==e.query),v=S(()=>({...i.value!==null?i.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),a=S(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),f=S(()=>St(e.buffer!==void 0?e.buffer:1,o.value,n.$q)),m=S(()=>`with${e.instantFeedback===!0?"out":""}-transition`),C=S(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${m.value} q-linear-progress__track--${u.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),x=S(()=>St(c.value===!0?1:e.value,o.value,n.$q)),P=S(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${m.value} q-linear-progress__model--${c.value===!0?"in":""}determinate`),V=S(()=>({width:`${e.value*100}%`})),w=S(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${m.value}`);return()=>{const d=[y("div",{class:C.value,style:f.value}),y("div",{class:P.value,style:x.value})];return e.stripe===!0&&c.value===!1&&d.push(y("div",{class:w.value,style:V.value})),y("div",{class:a.value,style:v.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},Nt(t.default,d))}}});let fe=0;const El={fullscreen:Boolean,noRouteFullscreenExit:Boolean},Ll=["update:fullscreen","fullscreen"];function zl(){const e=de(),{props:t,emit:n,proxy:u}=e;let i,c,o;const v=I(!1);Sl(e)===!0&&Q(()=>u.$route.fullPath,()=>{t.noRouteFullscreenExit!==!0&&m()}),Q(()=>t.fullscreen,C=>{v.value!==C&&a()}),Q(v,C=>{n("update:fullscreen",C),n("fullscreen",C)});function a(){v.value===!0?m():f()}function f(){v.value!==!0&&(v.value=!0,o=u.$el.parentNode,o.replaceChild(c,u.$el),document.body.appendChild(u.$el),fe++,fe===1&&document.body.classList.add("q-body--fullscreen-mixin"),i={handler:m},gt.add(i))}function m(){v.value===!0&&(i!==void 0&&(gt.remove(i),i=void 0),o.replaceChild(u.$el,c),v.value=!1,fe=Math.max(0,fe-1),fe===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),u.$el.scrollIntoView!==void 0&&setTimeout(()=>{u.$el.scrollIntoView()})))}return Ke(()=>{c=document.createElement("span")}),Vt(()=>{t.fullscreen===!0&&f()}),Dt(m),Object.assign(u,{toggleFullscreen:a,setFullscreen:f,exitFullscreen:m}),{inFullscreen:v,toggleFullscreen:a}}function Ql(e,t){return new Date(e)-new Date(t)}const jl={sortMethod:Function,binaryStateSort:Boolean,columnSortOrder:{type:String,validator:e=>e==="ad"||e==="da",default:"ad"}};function Hl(e,t,n,u){const i=S(()=>{const{sortBy:v}=t.value;return v&&n.value.find(a=>a.name===v)||null}),c=S(()=>e.sortMethod!==void 0?e.sortMethod:(v,a,f)=>{const m=n.value.find(P=>P.name===a);if(m===void 0||m.field===void 0)return v;const C=f===!0?-1:1,x=typeof m.field=="function"?P=>m.field(P):P=>P[m.field];return v.sort((P,V)=>{let w=x(P),d=x(V);return m.rawSort!==void 0?m.rawSort(w,d,P,V)*C:w==null?-1*C:d==null?1*C:m.sort!==void 0?m.sort(w,d,P,V)*C:He(w)===!0&&He(d)===!0?(w-d)*C:yt(w)===!0&&yt(d)===!0?Ql(w,d)*C:typeof w=="boolean"&&typeof d=="boolean"?(w-d)*C:([w,d]=[w,d].map(g=>(g+"").toLocaleString().toLowerCase()),w<d?-1*C:w===d?0:C)})});function o(v){let a=e.columnSortOrder;if(pl(v)===!0)v.sortOrder&&(a=v.sortOrder),v=v.name;else{const C=n.value.find(x=>x.name===v);C!==void 0&&C.sortOrder&&(a=C.sortOrder)}let{sortBy:f,descending:m}=t.value;f!==v?(f=v,m=a==="da"):e.binaryStateSort===!0?m=!m:m===!0?a==="ad"?f=null:m=!1:a==="ad"?m=!0:f=null,u({sortBy:f,descending:m,page:1})}return{columnToSort:i,computedSortMethod:c,sort:o}}const Yl={filter:[String,Object],filterMethod:Function};function Gl(e,t){const n=S(()=>e.filterMethod!==void 0?e.filterMethod:(u,i,c,o)=>{const v=i?i.toLowerCase():"";return u.filter(a=>c.some(f=>{const m=o(f,a)+"";return(m==="undefined"||m==="null"?"":m.toLowerCase()).indexOf(v)!==-1}))});return Q(()=>e.filter,()=>{Rt(()=>{t({page:1},!0)})},{deep:!0}),{computedFilterMethod:n}}function Wl(e,t){for(const n in t)if(t[n]!==e[n])return!1;return!0}function pt(e){return e.page<1&&(e.page=1),e.rowsPerPage!==void 0&&e.rowsPerPage<1&&(e.rowsPerPage=0),e}const Jl={pagination:Object,rowsPerPageOptions:{type:Array,default:()=>[5,7,10,15,20,25,50,0]},"onUpdate:pagination":[Function,Array]};function Kl(e,t){const{props:n,emit:u}=e,i=I(Object.assign({sortBy:null,descending:!1,page:1,rowsPerPage:n.rowsPerPageOptions.length!==0?n.rowsPerPageOptions[0]:5},n.pagination)),c=S(()=>{const m=n["onUpdate:pagination"]!==void 0?{...i.value,...n.pagination}:i.value;return pt(m)}),o=S(()=>c.value.rowsNumber!==void 0);function v(m){a({pagination:m,filter:n.filter})}function a(m={}){Rt(()=>{u("request",{pagination:m.pagination||c.value,filter:m.filter||n.filter,getCellValue:t})})}function f(m,C){const x=pt({...c.value,...m});if(Wl(c.value,x)===!0){o.value===!0&&C===!0&&v(x);return}if(o.value===!0){v(x);return}n.pagination!==void 0&&n["onUpdate:pagination"]!==void 0?u("update:pagination",x):i.value=x}return{innerPagination:i,computedPagination:c,isServerSide:o,requestServerInteraction:a,setPagination:f}}function Zl(e,t,n,u,i,c){const{props:o,emit:v,proxy:{$q:a}}=e,f=S(()=>u.value===!0?n.value.rowsNumber||0:c.value),m=S(()=>{const{page:D,rowsPerPage:N}=n.value;return(D-1)*N}),C=S(()=>{const{page:D,rowsPerPage:N}=n.value;return D*N}),x=S(()=>n.value.page===1),P=S(()=>n.value.rowsPerPage===0?1:Math.max(1,Math.ceil(f.value/n.value.rowsPerPage))),V=S(()=>C.value===0?!0:n.value.page>=P.value),w=S(()=>(o.rowsPerPageOptions.includes(t.value.rowsPerPage)?o.rowsPerPageOptions:[t.value.rowsPerPage].concat(o.rowsPerPageOptions)).map(N=>({label:N===0?a.lang.table.allRows:""+N,value:N})));Q(P,(D,N)=>{if(D===N)return;const L=n.value.page;D&&!L?i({page:1}):D<L&&i({page:D})});function d(){i({page:1})}function g(){const{page:D}=n.value;D>1&&i({page:D-1})}function p(){const{page:D,rowsPerPage:N}=n.value;C.value>0&&D*N<f.value&&i({page:D+1})}function T(){i({page:P.value})}return o["onUpdate:pagination"]!==void 0&&v("update:pagination",{...n.value}),{firstRowIndex:m,lastRowIndex:C,isFirstPage:x,isLastPage:V,pagesNumber:P,computedRowsPerPageOptions:w,computedRowsNumber:f,firstPage:d,prevPage:g,nextPage:p,lastPage:T}}const Xl={selection:{type:String,default:"none",validator:e=>["single","multiple","none"].includes(e)},selected:{type:Array,default:()=>[]}},ea=["update:selected","selection"];function ta(e,t,n,u){const i=S(()=>{const V={};return e.selected.map(u.value).forEach(w=>{V[w]=!0}),V}),c=S(()=>e.selection!=="none"),o=S(()=>e.selection==="single"),v=S(()=>e.selection==="multiple"),a=S(()=>n.value.length!==0&&n.value.every(V=>i.value[u.value(V)]===!0)),f=S(()=>a.value!==!0&&n.value.some(V=>i.value[u.value(V)]===!0)),m=S(()=>e.selected.length);function C(V){return i.value[V]===!0}function x(){t("update:selected",[])}function P(V,w,d,g){t("selection",{rows:w,added:d,keys:V,evt:g});const p=o.value===!0?d===!0?w:[]:d===!0?e.selected.concat(w):e.selected.filter(T=>V.includes(u.value(T))===!1);t("update:selected",p)}return{hasSelectionMode:c,singleSelection:o,multipleSelection:v,allRowsSelected:a,someRowsSelected:f,rowsSelectedNumber:m,isRowSelected:C,clearSelection:x,updateSelection:P}}function wt(e){return Array.isArray(e)?e.slice():[]}const la={expanded:Array},aa=["update:expanded"];function ra(e,t){const n=I(wt(e.expanded));Q(()=>e.expanded,o=>{n.value=wt(o)});function u(o){return n.value.includes(o)}function i(o){e.expanded!==void 0?t("update:expanded",o):n.value=o}function c(o,v){const a=n.value.slice(),f=a.indexOf(o);v===!0?f===-1&&(a.push(o),i(a)):f!==-1&&(a.splice(f,1),i(a))}return{isRowExpanded:u,setExpanded:i,updateExpanded:c}}const na={visibleColumns:Array};function oa(e,t,n){const u=S(()=>{if(e.columns!==void 0)return e.columns;const v=e.rows[0];return v!==void 0?Object.keys(v).map(a=>({name:a,label:a.toUpperCase(),field:a,align:He(v[a])?"right":"left",sortable:!0})):[]}),i=S(()=>{const{sortBy:v,descending:a}=t.value;return(e.visibleColumns!==void 0?u.value.filter(m=>m.required===!0||e.visibleColumns.includes(m.name)===!0):u.value).map(m=>{const C=m.align||"right",x=`text-${C}`;return{...m,align:C,__iconClass:`q-table__sort-icon q-table__sort-icon--${C}`,__thClass:x+(m.headerClasses!==void 0?" "+m.headerClasses:"")+(m.sortable===!0?" sortable":"")+(m.name===v?` sorted ${a===!0?"sort-desc":""}`:""),__tdStyle:m.style!==void 0?typeof m.style!="function"?()=>m.style:m.style:()=>null,__tdClass:m.classes!==void 0?typeof m.classes!="function"?()=>x+" "+m.classes:P=>x+" "+m.classes(P):()=>x}})}),c=S(()=>{const v={};return i.value.forEach(a=>{v[a.name]=a}),v}),o=S(()=>e.tableColspan!==void 0?e.tableColspan:i.value.length+(n.value===!0?1:0));return{colList:u,computedCols:i,computedColsMap:c,computedColspan:o}}const Te="q-table__bottom row items-center",Ft={};kt.forEach(e=>{Ft[e]={}});var sa=ae({name:"QTable",props:{rows:{type:Array,default:()=>[]},rowKey:{type:[String,Function],default:"id"},columns:Array,loading:Boolean,iconFirstPage:String,iconPrevPage:String,iconNextPage:String,iconLastPage:String,title:String,hideHeader:Boolean,grid:Boolean,gridHeader:Boolean,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,separator:{type:String,default:"horizontal",validator:e=>["horizontal","vertical","cell","none"].includes(e)},wrapCells:Boolean,virtualScroll:Boolean,virtualScrollTarget:{default:void 0},...Ft,noDataLabel:String,noResultsLabel:String,loadingLabel:String,selectedRowsLabel:Function,rowsPerPageLabel:String,paginationLabel:Function,color:{type:String,default:"grey-8"},titleClass:[String,Array,Object],tableStyle:[String,Array,Object],tableClass:[String,Array,Object],tableHeaderStyle:[String,Array,Object],tableHeaderClass:[String,Array,Object],cardContainerClass:[String,Array,Object],cardContainerStyle:[String,Array,Object],cardStyle:[String,Array,Object],cardClass:[String,Array,Object],hideBottom:Boolean,hideSelectedBanner:Boolean,hideNoData:Boolean,hidePagination:Boolean,onRowClick:Function,onRowDblclick:Function,onRowContextmenu:Function,...et,...El,...na,...Yl,...Jl,...la,...Xl,...jl},emits:["request","virtualScroll",...Ll,...aa,...ea],setup(e,{slots:t,emit:n}){const u=de(),{proxy:{$q:i}}=u,c=tt(e,i),{inFullscreen:o,toggleFullscreen:v}=zl(),a=S(()=>typeof e.rowKey=="function"?e.rowKey:r=>r[e.rowKey]),f=I(null),m=I(null),C=S(()=>e.grid!==!0&&e.virtualScroll===!0),x=S(()=>" q-table__card"+(c.value===!0?" q-table__card--dark q-dark":"")+(e.square===!0?" q-table--square":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")),P=S(()=>`q-table__container q-table--${e.separator}-separator column no-wrap`+(e.grid===!0?" q-table--grid":x.value)+(c.value===!0?" q-table--dark":"")+(e.dense===!0?" q-table--dense":"")+(e.wrapCells===!1?" q-table--no-wrap":"")+(o.value===!0?" fullscreen scroll":"")),V=S(()=>P.value+(e.loading===!0?" q-table--loading":""));Q(()=>e.tableStyle+e.tableClass+e.tableHeaderStyle+e.tableHeaderClass+P.value,()=>{C.value===!0&&m.value!==null&&m.value.reset()});const{innerPagination:w,computedPagination:d,isServerSide:g,requestServerInteraction:p,setPagination:T}=Kl(u,oe),{computedFilterMethod:D}=Gl(e,T),{isRowExpanded:N,setExpanded:L,updateExpanded:ge}=ra(e,n),re=S(()=>{let r=e.rows;if(g.value===!0||r.length===0)return r;const{sortBy:_,descending:h}=d.value;return e.filter&&(r=D.value(r,e.filter,j.value,oe)),Et.value!==null&&(r=Lt.value(e.rows===r?r.slice():r,_,h)),r}),ce=S(()=>re.value.length),W=S(()=>{let r=re.value;if(g.value===!0)return r;const{rowsPerPage:_}=d.value;return _!==0&&(_e.value===0&&e.rows!==r?r.length>Se.value&&(r=r.slice(0,Se.value)):r=r.slice(_e.value,Se.value)),r}),{hasSelectionMode:ne,singleSelection:Ot,multipleSelection:lt,allRowsSelected:It,someRowsSelected:at,rowsSelectedNumber:De,isRowSelected:Ne,clearSelection:Mt,updateSelection:ye}=ta(e,n,W,a),{colList:Bt,computedCols:j,computedColsMap:rt,computedColspan:nt}=oa(e,d,ne),{columnToSort:Et,computedSortMethod:Lt,sort:Re}=Hl(e,d,Bt,T),{firstRowIndex:_e,lastRowIndex:Se,isFirstPage:$e,isLastPage:Ae,pagesNumber:pe,computedRowsPerPageOptions:zt,computedRowsNumber:we,firstPage:Fe,prevPage:Oe,nextPage:Ie,lastPage:Me}=Zl(u,w,d,g,T,ce),Qt=S(()=>W.value.length===0),jt=S(()=>{const r={};return kt.forEach(_=>{r[_]=e[_]}),r.virtualScrollItemSize===void 0&&(r.virtualScrollItemSize=e.dense===!0?28:48),r});function Ht(){C.value===!0&&m.value.reset()}function Yt(){if(e.grid===!0)return nl();const r=e.hideHeader!==!0?dt:null;if(C.value===!0){const h=t["top-row"],U=t["bottom-row"],k={default:A=>st(A.item,t.body,A.index)};if(h!==void 0){const A=y("tbody",h({cols:j.value}));k.before=r===null?()=>A:()=>[r()].concat(A)}else r!==null&&(k.before=r);return U!==void 0&&(k.after=()=>y("tbody",U({cols:j.value}))),y(Il,{ref:m,class:e.tableClass,style:e.tableStyle,...jt.value,scrollTarget:e.virtualScrollTarget,items:W.value,type:"__qtable",tableColspan:nt.value,onVirtualScroll:Wt},k)}const _=[Jt()];return r!==null&&_.unshift(r()),At({class:["q-table__middle scroll",e.tableClass],style:e.tableStyle},_)}function Gt(r,_){if(m.value!==null){m.value.scrollTo(r,_);return}r=parseInt(r,10);const h=f.value.querySelector(`tbody tr:nth-of-type(${r+1})`);if(h!==null){const U=f.value.querySelector(".q-table__middle.scroll"),k=h.offsetTop-e.virtualScrollStickySizeStart,A=k<U.scrollTop?"decrease":"increase";U.scrollTop=k,n("virtualScroll",{index:r,from:0,to:w.value.rowsPerPage-1,direction:A})}}function Wt(r){n("virtualScroll",r)}function ot(){return[y(Bl,{class:"q-table__linear-progress",color:e.color,dark:c.value,indeterminate:!0,trackColor:"transparent"})]}function st(r,_,h){const U=a.value(r),k=Ne(U);if(_!==void 0)return _(ut({key:U,row:r,pageIndex:h,__trClass:k?"selected":""}));const A=t["body-cell"],$=j.value.map(B=>{const Ce=t[`body-cell-${B.name}`],Ue=Ce!==void 0?Ce:A;return Ue!==void 0?Ue(Kt({key:U,row:r,pageIndex:h,col:B})):y("td",{class:B.__tdClass(r),style:B.__tdStyle(r)},oe(B,r))});if(ne.value===!0){const B=t["body-selection"],Ce=B!==void 0?B(Zt({key:U,row:r,pageIndex:h})):[y(ze,{modelValue:k,color:e.color,dark:c.value,dense:e.dense,"onUpdate:modelValue":(Ue,ol)=>{ye([U],[r],Ue,ol)}})];$.unshift(y("td",{class:"q-table--col-auto-width"},Ce))}const H={key:U,class:{selected:k}};return e.onRowClick!==void 0&&(H.class["cursor-pointer"]=!0,H.onClick=B=>{n("RowClick",B,r,h)}),e.onRowDblclick!==void 0&&(H.class["cursor-pointer"]=!0,H.onDblclick=B=>{n("RowDblclick",B,r,h)}),e.onRowContextmenu!==void 0&&(H.class["cursor-pointer"]=!0,H.onContextmenu=B=>{n("RowContextmenu",B,r,h)}),y("tr",H,$)}function Jt(){const r=t.body,_=t["top-row"],h=t["bottom-row"];let U=W.value.map((k,A)=>st(k,r,A));return _!==void 0&&(U=_({cols:j.value}).concat(U)),h!==void 0&&(U=U.concat(h({cols:j.value}))),y("tbody",U)}function ut(r){return Be(r),r.cols=r.cols.map(_=>me({..._},"value",()=>oe(_,r.row))),r}function Kt(r){return Be(r),me(r,"value",()=>oe(r.col,r.row)),r}function Zt(r){return Be(r),r}function Be(r){Object.assign(r,{cols:j.value,colsMap:rt.value,sort:Re,rowIndex:_e.value+r.pageIndex,color:e.color,dark:c.value,dense:e.dense}),ne.value===!0&&me(r,"selected",()=>Ne(r.key),(_,h)=>{ye([r.key],[r.row],_,h)}),me(r,"expand",()=>N(r.key),_=>{ge(r.key,_)})}function oe(r,_){const h=typeof r.field=="function"?r.field(_):_[r.field];return r.format!==void 0?r.format(h,_):h}const se=S(()=>({pagination:d.value,pagesNumber:pe.value,isFirstPage:$e.value,isLastPage:Ae.value,firstPage:Fe,prevPage:Oe,nextPage:Ie,lastPage:Me,inFullscreen:o.value,toggleFullscreen:v}));function Xt(){const r=t.top,_=t["top-left"],h=t["top-right"],U=t["top-selection"],k=ne.value===!0&&U!==void 0&&De.value>0,A="q-table__top relative-position row items-center";if(r!==void 0)return y("div",{class:A},[r(se.value)]);let $;if(k===!0?$=U(se.value).slice():($=[],_!==void 0?$.push(y("div",{class:"q-table__control"},[_(se.value)])):e.title&&$.push(y("div",{class:"q-table__control"},[y("div",{class:["q-table__title",e.titleClass]},e.title)]))),h!==void 0&&($.push(y("div",{class:"q-table__separator col"})),$.push(y("div",{class:"q-table__control"},[h(se.value)]))),$.length!==0)return y("div",{class:A},$)}const it=S(()=>at.value===!0?null:It.value);function dt(){const r=el();return e.loading===!0&&t.loading===void 0&&r.push(y("tr",{class:"q-table__progress"},[y("th",{class:"relative-position",colspan:nt.value},ot())])),y("thead",r)}function el(){const r=t.header,_=t["header-cell"];if(r!==void 0)return r(Ee({header:!0})).slice();const h=j.value.map(U=>{const k=t[`header-cell-${U.name}`],A=k!==void 0?k:_,$=Ee({col:U});return A!==void 0?A($):y(le,{key:U.name,props:$},()=>U.label)});if(Ot.value===!0&&e.grid!==!0)h.unshift(y("th",{class:"q-table--col-auto-width"}," "));else if(lt.value===!0){const U=t["header-selection"],k=U!==void 0?U(Ee({})):[y(ze,{color:e.color,modelValue:it.value,dark:c.value,dense:e.dense,"onUpdate:modelValue":ct})];h.unshift(y("th",{class:"q-table--col-auto-width"},k))}return[y("tr",{class:e.tableHeaderClass,style:e.tableHeaderStyle},h)]}function Ee(r){return Object.assign(r,{cols:j.value,sort:Re,colsMap:rt.value,color:e.color,dark:c.value,dense:e.dense}),lt.value===!0&&me(r,"selected",()=>it.value,ct),r}function ct(r){at.value===!0&&(r=!1),ye(W.value.map(a.value),W.value,r)}const he=S(()=>{const r=[e.iconFirstPage||i.iconSet.table.firstPage,e.iconPrevPage||i.iconSet.table.prevPage,e.iconNextPage||i.iconSet.table.nextPage,e.iconLastPage||i.iconSet.table.lastPage];return i.lang.rtl===!0?r.reverse():r});function tl(){if(e.hideBottom===!0)return;if(Qt.value===!0){if(e.hideNoData===!0)return;const h=e.loading===!0?e.loadingLabel||i.lang.table.loading:e.filter?e.noResultsLabel||i.lang.table.noResults:e.noDataLabel||i.lang.table.noData,U=t["no-data"],k=U!==void 0?[U({message:h,icon:i.iconSet.table.warning,filter:e.filter})]:[y(K,{class:"q-table__bottom-nodata-icon",name:i.iconSet.table.warning}),h];return y("div",{class:Te+" q-table__bottom--nodata"},k)}const r=t.bottom;if(r!==void 0)return y("div",{class:Te},[r(se.value)]);const _=e.hideSelectedBanner!==!0&&ne.value===!0&&De.value>0?[y("div",{class:"q-table__control"},[y("div",[(e.selectedRowsLabel||i.lang.table.selectedRecords)(De.value)])])]:[];if(e.hidePagination!==!0)return y("div",{class:Te+" justify-end"},al(_));if(_.length!==0)return y("div",{class:Te},_)}function ll(r){T({page:1,rowsPerPage:r.value})}function al(r){let _;const{rowsPerPage:h}=d.value,U=e.paginationLabel||i.lang.table.pagination,k=t.pagination,A=e.rowsPerPageOptions.length>1;if(r.push(y("div",{class:"q-table__separator col"})),A===!0&&r.push(y("div",{class:"q-table__control"},[y("span",{class:"q-table__bottom-item"},[e.rowsPerPageLabel||i.lang.table.recordsPerPage]),y(Qe,{class:"q-table__select inline q-table__bottom-item",color:e.color,modelValue:h,options:zt.value,displayValue:h===0?i.lang.table.allRows:h,dark:c.value,borderless:!0,dense:!0,optionsDense:!0,optionsCover:!0,"onUpdate:modelValue":ll})])),k!==void 0)_=k(se.value);else if(_=[y("span",h!==0?{class:"q-table__bottom-item"}:{},[h?U(_e.value+1,Math.min(Se.value,we.value),we.value):U(1,ce.value,we.value)])],h!==0&&pe.value>1){const $={color:e.color,round:!0,dense:!0,flat:!0};e.dense===!0&&($.size="sm"),pe.value>2&&_.push(y(F,{key:"pgFirst",...$,icon:he.value[0],disable:$e.value,onClick:Fe})),_.push(y(F,{key:"pgPrev",...$,icon:he.value[1],disable:$e.value,onClick:Oe}),y(F,{key:"pgNext",...$,icon:he.value[2],disable:Ae.value,onClick:Ie})),pe.value>2&&_.push(y(F,{key:"pgLast",...$,icon:he.value[3],disable:Ae.value,onClick:Me}))}return r.push(y("div",{class:"q-table__control"},_)),r}function rl(){const r=e.gridHeader===!0?[y("table",{class:"q-table"},[dt()])]:e.loading===!0&&t.loading===void 0?ot():void 0;return y("div",{class:"q-table__middle"},r)}function nl(){const r=t.item!==void 0?t.item:_=>{const h=_.cols.map(k=>y("div",{class:"q-table__grid-item-row"},[y("div",{class:"q-table__grid-item-title"},[k.label]),y("div",{class:"q-table__grid-item-value"},[k.value])]));if(ne.value===!0){const k=t["body-selection"],A=k!==void 0?k(_):[y(ze,{modelValue:_.selected,color:e.color,dark:c.value,dense:e.dense,"onUpdate:modelValue":($,H)=>{ye([_.key],[_.row],$,H)}})];h.unshift(y("div",{class:"q-table__grid-item-row"},A),y(dl,{dark:c.value}))}const U={class:["q-table__grid-item-card"+x.value,e.cardClass],style:e.cardStyle};return(e.onRowClick!==void 0||e.onRowDblclick!==void 0)&&(U.class[0]+=" cursor-pointer",e.onRowClick!==void 0&&(U.onClick=k=>{n("RowClick",k,_.row,_.pageIndex)}),e.onRowDblclick!==void 0&&(U.onDblclick=k=>{n("RowDblclick",k,_.row,_.pageIndex)})),y("div",{class:"q-table__grid-item col-xs-12 col-sm-6 col-md-4 col-lg-3"+(_.selected===!0?" q-table__grid-item--selected":"")},[y("div",U,h)])};return y("div",{class:["q-table__grid-content row",e.cardContainerClass],style:e.cardContainerStyle},W.value.map((_,h)=>r(ut({key:a.value(_),row:_,pageIndex:h}))))}return Object.assign(u.proxy,{requestServerInteraction:p,setPagination:T,firstPage:Fe,prevPage:Oe,nextPage:Ie,lastPage:Me,isRowSelected:Ne,clearSelection:Mt,isRowExpanded:N,setExpanded:L,sort:Re,resetVirtualScroll:Ht,scrollTo:Gt,getCellValue:oe}),wl(u.proxy,{filteredSortedRows:()=>re.value,computedRows:()=>W.value,computedRowsNumber:()=>we.value}),()=>{const r=[Xt()],_={ref:f,class:V.value};return e.grid===!0?r.push(rl()):Object.assign(_,{class:[_.class,e.cardClass],style:e.cardStyle}),r.push(Yt(),tl()),e.loading===!0&&t.loading!==void 0&&r.push(t.loading()),y("div",_,r)}}});function ht(e){setTimeout(()=>{window.URL.revokeObjectURL(e.href)},1e4),e.remove()}function ua(e,t,n={}){const{mimeType:u,byteOrderMark:i,encoding:c}=typeof n=="string"?{mimeType:n}:n,o=c!==void 0?new TextEncoder(c).encode([t]):t,v=i!==void 0?[i,o]:[o],a=new Blob(v,{type:u||"application/octet-stream"}),f=document.createElement("a");f.href=window.URL.createObjectURL(a),f.setAttribute("download",e),typeof f.download=="undefined"&&f.setAttribute("target","_blank"),f.classList.add("hidden"),f.style.position="fixed",document.body.appendChild(f);try{return f.click(),ht(f),!0}catch(m){return ht(f),m}}const Ct=()=>new Date(Date.UTC(new Date().getUTCFullYear(),new Date().getUTCMonth(),new Date().getUTCDate(),new Date().getUTCHours(),new Date().getUTCMinutes(),new Date().getUTCSeconds())),ia=e=>new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),da=e=>{const t=new Date(e.getUTCFullYear(),e.getUTCMonth(),1);return t.setUTCHours(0,0,0,0),t},qe=e=>e.toISOString().split("T")[0],Ut=e=>new Date(e);const ca={class:"q-ma-md column",style:{gap:"0.6rem"}},va={class:"q-ma-md column",style:{gap:"0.6rem"}},ma={class:"q-mx-md"},fa=ee({__name:"UserActivityTable",setup(e){const t=Tt(),n=I(null),u=I([{name:"activityId",label:"ID",align:"left",field:"activityId",sortable:!1},{name:"date",label:"Date",align:"left",field:"date",sortable:!1},{name:"time",label:"Time",align:"left",field:"time",sortable:!1},{name:"performerUserFullName",label:"Performer User",align:"left",field:"performerUserFullName",sortable:!1},{name:"relatedUserFullName",label:"Related User",align:"left",field:"relatedUserFullName",sortable:!1},{name:"action",label:"Action",align:"left",field:"action",sortable:!1},{name:"description",label:"Description",align:"left",field:"description",sortable:!1}]),i=["date","time","performerUserFullName","relatedUserFullName","action","description"],c=Ct(),o=da(c),v=[{value:"today",label:"Today"},{value:"yesterday",label:"Yesterday"},{value:"monthToDate",label:"Month to Date"},{value:"lastMonth",label:"Last Month"},{value:"custom",label:"Custom"}],a=I({term:"",timeframe:"monthToDate",dateStart:qe(o),dateEnd:qe(c),searchColumns:["description"],performerUserId:[],relatedUserId:[],actions:[]}),f=S(()=>[...new Set(t.activity.map(w=>w.action))]),m=S(()=>t.activity.map(w=>({value:w.performerUserId,label:w.performerUserFullName})).filter((w,d,g)=>d===g.findIndex(p=>p.label===w.label&&p.value===w.value))),C=S(()=>t.activity.map(w=>({value:w.relatedUserId,label:w.relatedUserFullName})).filter((w,d,g)=>d===g.findIndex(p=>p.label===w.label&&p.value===w.value))),x=w=>{a.value.timeframe=w;const d=Ct(),g=ia(d);let p=new Date,T=new Date;switch(w){case"today":p=g,T=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),23,59,59));break;case"yesterday":p=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()-1)),T=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),0,0,-1));break;case"monthToDate":p=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),1)),T=d;break;case"lastMonth":p=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth()-1,1)),T=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),0));break;case"custom":p=new Date(a.value.dateStart),T=new Date(a.value.dateEnd),isNaN(p.getTime())||isNaN(T.getTime())?ke({message:"Invalid custom date range",color:"negative",icon:"warning"}):T<p&&ke({message:"End date cannot be before start date",color:"negative",icon:"warning"});break}a.value.dateStart=qe(p),a.value.dateEnd=qe(T)},P=S(()=>{const w=Ut(a.value.dateStart),d=Ut(a.value.dateEnd);return t.activity.filter(g=>{var ge,re,ce;const p=new Date(g.createdAt),T=p>=w&&p<=d,D=!((ge=a.value.performerUserId)!=null&&ge.length)||a.value.performerUserId.includes(g.performerUserId),N=!((re=a.value.relatedUserId)!=null&&re.length)||a.value.relatedUserId.includes(g.relatedUserId),L=!((ce=a.value.actions)!=null&&ce.length)||a.value.actions.includes(g.action);return T&&D&&N&&L})}),V=()=>{if(!n.value)return;const w=n.value.filteredSortedRows,d=[u.value.map(N=>_t(N.label))].concat(w.map(N=>u.value.map(L=>_t(typeof L.field=="function"?L.field(N):N[L.field===void 0?L.name:L.field])).join(","))).join(`\r
`),g=new Date,T=`User Activity ${`${g.getFullYear()}-${g.getMonth()+1}-${g.getDate()} ${g.getHours()}-${g.getMinutes()}-${g.getSeconds()}`}.csv`;ua(T,d,"text/csv")!==!0?ke({message:"Browser denied file download...",color:"negative",icon:"warning"}):ke({message:"File downloaded successfully...",color:"positive",icon:"download"})};return(w,d)=>(M(),z(X,null,{default:s(()=>[l(sa,{ref_key:"tableRef",ref:n,rows:P.value,columns:u.value,"row-key":"activityId","visible-columns":i,filter:a.value.term,"rows-per-page-options":[-1],"hide-pagination":"",dense:"","virtual-scroll":"",class:"header-table",style:{"min-height":"90vh",overflow:"auto",margin:"0.4rem"}},{top:s(g=>[l(G,{class:"text-h3"},{default:s(()=>[q(" Activity ")]),_:1}),l(be),l(je,{class:"bg-blue text-white q-ma-md"},{default:s(()=>[l(Y,{icon:"priority_high"}),q(" Dates in UTC ")]),_:1}),l(F,{color:"primary",icon:"download",label:"Download CSV",onClick:V}),l(F,{round:"",dense:"",icon:g.inFullscreen?"fullscreen_exit":"fullscreen",onClick:g.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"])]),"header-cell-date":s(g=>[l(le,{props:g},{default:s(()=>[l(ve,{dense:"",round:""},{label:s(()=>[l(Y,{icon:"filter_list",size:"sm","text-color":"primary"}),q(" "+R(g.col.label),1)]),default:s(()=>[J("div",ca,[(M(),We(Je,null,qt(v,p=>l(F,{key:p.value,outline:"",label:p.label,color:a.value.timeframe===p.value?"primary":"",onClick:T=>x(p.value)},null,8,["label","color","onClick"])),64))]),J("div",va,[l(O,{outlined:"",debounce:"300",modelValue:a.value.dateStart,"onUpdate:modelValue":d[0]||(d[0]=p=>a.value.dateStart=p),label:"Date Start",type:"date",disable:a.value.timeframe!=="custom"},null,8,["modelValue","disable"]),l(O,{outlined:"",debounce:"300",modelValue:a.value.dateEnd,"onUpdate:modelValue":d[1]||(d[1]=p=>a.value.dateEnd=p),label:"Date End",type:"date",disable:a.value.timeframe!=="custom"},null,8,["modelValue","disable"])])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-time":s(g=>[l(le,{props:g},{default:s(()=>[l(G,{style:{"font-size":"16px"}},{default:s(()=>[q(R(g.col.label),1)]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-performerUserFullName":s(g=>[l(le,{props:g},{default:s(()=>[l(ve,{dense:"",round:""},{label:s(()=>[l(Y,{icon:"filter_list",size:"sm","text-color":a.value.performerUserId&&a.value.performerUserId.length>0?"primary":""},null,8,["text-color"]),q(" "+R(g.col.label),1)]),default:s(()=>[l(xe,{style:{width:"256px"}},{default:s(()=>[l(be),l(F,{dense:"",label:"Clear",onClick:d[2]||(d[2]=p=>a.value.performerUserId=[])})]),_:1}),l(Le,{modelValue:a.value.performerUserId,"onUpdate:modelValue":d[3]||(d[3]=p=>a.value.performerUserId=p),options:m.value,type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-relatedUserFullName":s(g=>[l(le,{props:g},{default:s(()=>[l(ve,{dense:"",round:""},{label:s(()=>[l(Y,{icon:"filter_list",size:"sm","text-color":a.value.relatedUserId&&a.value.relatedUserId.length>0?"primary":""},null,8,["text-color"]),q(" "+R(g.col.label),1)]),default:s(()=>[l(xe,{style:{width:"256px"}},{default:s(()=>[l(be),l(F,{dense:"",label:"Clear",onClick:d[4]||(d[4]=p=>a.value.relatedUserId=[])})]),_:1}),l(Le,{modelValue:a.value.relatedUserId,"onUpdate:modelValue":d[5]||(d[5]=p=>a.value.relatedUserId=p),options:C.value,type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-action":s(g=>[l(le,{props:g},{default:s(()=>[l(ve,{dense:"",round:""},{label:s(()=>[l(Y,{icon:"filter_list",size:"sm","text-color":a.value.actions&&a.value.actions.length>0?"primary":""},null,8,["text-color"]),q(" "+R(g.col.label),1)]),default:s(()=>[l(xe,null,{default:s(()=>[l(be),l(F,{dense:"",label:"Clear",onClick:d[6]||(d[6]=p=>a.value.actions=[])})]),_:1}),l(Le,{modelValue:a.value.actions,"onUpdate:modelValue":d[7]||(d[7]=p=>a.value.actions=p),options:f.value.map(p=>({label:p,value:p})),type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-description":s(g=>[l(le,{props:g},{default:s(()=>[l(ve,{dense:"",round:""},{label:s(()=>[l(Y,{icon:"search",size:"sm","text-color":a.value.term!==""?"primary":""},null,8,["text-color"]),q(" "+R(g.col.label),1)]),default:s(()=>[J("div",ma,[l(O,{outlined:"",dense:"",debounce:"300",modelValue:a.value.term,"onUpdate:modelValue":d[9]||(d[9]=p=>a.value.term=p),type:"search",placeholder:"Description search\u2026",style:{"align-self":"center"}},{append:s(()=>[l(K,{name:a.value.term?"close":"search",class:Ye({"cursor-pointer":a.value.term}),onClick:d[8]||(d[8]=p=>a.value.term?a.value.term="":null)},null,8,["name","class"])]),_:1},8,["modelValue"])])]),_:2},1024)]),_:2},1032,["props"])]),body:s(g=>[l(Rl,{props:g},{default:s(()=>[l(ue,{key:"date",props:g},{default:s(()=>[q(R(g.row.date),1)]),_:2},1032,["props"]),l(ue,{key:"time",props:g},{default:s(()=>[q(R(g.row.time),1)]),_:2},1032,["props"]),l(ue,{key:"performerUserFullName",props:g},{default:s(()=>[q(R(g.row.performerUserFullName),1)]),_:2},1032,["props"]),l(ue,{key:"relatedUserFullName",props:g},{default:s(()=>[J("span",{class:Ye({"text-grey":!g.row.relatedUserFullName})},R(g.row.relatedUserFullName||"No one"),3)]),_:2},1032,["props"]),l(ue,{key:"action",props:g},{default:s(()=>{var p;return[l(je,{"text-color":"white",color:((p=b(t).activityActions.find(T=>T.action===g.row.action))==null?void 0:p.color)||"grey"},{default:s(()=>{var T,D;return[l(Y,{size:"sm","text-color":"white",icon:((T=b(t).activityActions.find(N=>N.action===g.row.action))==null?void 0:T.icon)||"question_mark",color:((D=b(t).activityActions.find(N=>N.action===g.row.action))==null?void 0:D.color)||"grey"},null,8,["icon","color"]),q(" "+R(g.row.action),1)]}),_:2},1032,["color"])]}),_:2},1032,["props"]),l(ue,{key:"description",props:g},{default:s(()=>[q(R(g.row.description),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])]),_:1}))}});var ba=xt(fa,[["__scopeId","data-v-15fc3ad6"]]);const ga=ee({__name:"UsersSearch",setup(e){const t=te();return(n,u)=>(M(),z(O,{modelValue:b(t).searchTerm,"onUpdate:modelValue":u[1]||(u[1]=i=>b(t).searchTerm=i),type:"search",placeholder:"Search\u2026",filled:""},{append:s(()=>[l(K,{name:b(t).searchTerm?"close":"search",class:Ye({"cursor-pointer":b(t).searchTerm}),onClick:u[0]||(u[0]=i=>b(t).searchTerm?b(t).searchTerm="":null)},null,8,["name","class"])]),_:1},8,["modelValue"]))}}),ya={class:"row items-start"},_a={style:{width:"300px"}},Sa={class:"col"},Pa=ee({__name:"UsersPage",setup(e){const t=te(),n=Ve(),u=I(!0);return Ke(()=>{n.readSettings(),t.readAllUsers()}),(i,c)=>(M(),We(Je,null,[l(kl),l(Tl),l(Ge,{modelValue:u.value,"onUpdate:modelValue":c[0]||(c[0]=o=>u.value=o),side:"left",width:320,class:"row"},{default:s(()=>[l(vt,{class:"q-pa-md",style:Pt({backgroundColor:"var(--primary-light)"})},{default:s(()=>[l(ga)]),_:1},8,["style"]),l(Vl)]),_:1},8,["modelValue"]),l(Cl,{class:"row-container"},{default:s(()=>[l(vt,null,{default:s(()=>[l(hl,null,{default:s(()=>[u.value?(M(),z(F,{key:1,onClick:c[2]||(c[2]=o=>u.value=!u.value),icon:"menu"})):(M(),z(F,{key:0,onClick:c[1]||(c[1]=o=>u.value=!u.value),icon:"menu"})),l(Ze,null,{default:s(()=>[q("Users \xBB "+R(b(t).selectedUser.givenName)+" "+R(b(t).selectedUser.surname),1)]),_:1}),l(xe,null,{default:s(()=>[l(F,{icon:b(t).createMode?"close":"add",label:b(t).createMode?"Cancel Create":"Create User",onClick:c[3]||(c[3]=o=>{(b(t).createMode=!b(t).createMode)&&(b(t).editMode=!1)})},null,8,["icon","label"]),l(F,{icon:b(t).editMode?"close":"edit",label:b(t).editMode?"Cancel Edit":"Edit User",onClick:c[4]||(c[4]=o=>{(b(t).editMode=!b(t).editMode)&&(b(t).createMode=!1)})},null,8,["icon","label"])]),_:1})]),_:1})]),_:1}),J("div",ya,[J("div",_a,[l(Nl)]),J("div",Sa,[l(ba)])])]),_:1})],64))}});export{Pa as default};
