import{Q as il,a as bt}from"./QBadge.a911b365.js";import{i as et,d as Ke,b as gt,Q as Se,e as ae,u as dl,j as cl,k as xt,h as vl,a as ge,f as We}from"./QSeparator.63bbde44.js";import{L as ne,a as le,u as Fe,y as M,w as W,F,G as z,H as o,P as b,I as l,Q as T,U as I,a4 as ee,R as P,K as j,aN as yt,h as p,aO as ml,e as Pt,M as ce,O as pe,N as ve,_ as Dt,aP as X,aQ as Vt,aR as fl,f as ue,j as y,k as me,Z as bl,l as fe,T as tt,o as Nt,ad as gl,ac as yl,q as Rt,s as _l,t as _t,D as $t,ao as Sl,am as pl,aq as wl,ap as St,aS as Ze,aT as pt,aU as hl,J as At,aV as Ul,aa as ye,a0 as Cl,a3 as Tl,aW as Xe,aX as wt,aY as Ve,a1 as kl,a2 as ql}from"./index.9c6167b6.js";import{Q as Ie,a as Ft}from"./QToolbar.8f152eb8.js";import{b as Q,c as E,Q as te,q as Je,a as $e}from"./QToggle.39796720.js";import{Q as xl}from"./QPage.28b74124.js";import{c as B,a as lt,b as oe,Q as It,u as at,d as rt}from"./QList.48002a3b.js";import"./QResizeObserver.0f37b82b.js";import"./QBtnGroup.e613580b.js";const Pl=j("br",null,null,-1),Dl=ne({__name:"UserCreateDrawer",setup(e){const t=le(),n=Fe(),u=M({subject:"",body:""});W(()=>({givenName:t.user.givenName,surname:t.user.surname}),m=>{u.value.subject=`Onboarding ${m.givenName} ${m.surname}`,u.value.body=`Please add ${m.givenName} to the Active Directory.
Name: ${m.givenName}
Surname: ${m.surname}

Thanks

This email has been sent from FileMaker by ${n.user.fullName}`},{immediate:!0});const i=()=>{t.user={givenName:"",surname:"",status:"Pending",groupId:null}};return(m,s)=>(F(),z(et,{modelValue:b(t).createMode,"onUpdate:modelValue":s[5]||(s[5]=f=>b(t).createMode=f),onBeforeShow:s[6]||(s[6]=f=>i()),width:384,bordered:"",overlay:"",side:"right"},{default:o(()=>[l(te,null,{default:o(()=>[l(Q,null,{default:o(()=>[l(Ie,null,{default:o(()=>[T(" Create User ")]),_:1}),l(B,{class:"text-body2"},{default:o(()=>[T(" A new User will be created and, an email request to add him/her to Active Directory will be send ")]),_:1}),Pl,l(I,{dense:"",label:"Create User and Send Request",icon:"person_add",color:"primary",onClick:s[0]||(s[0]=f=>b(t).createUser(u.value)),disable:!b(t).user.givenName||!b(t).user.surname},null,8,["disable"])]),_:1}),l(Q,null,{default:o(()=>[l(E,{modelValue:b(t).user.givenName,"onUpdate:modelValue":s[1]||(s[1]=f=>b(t).user.givenName=f),label:"Name",rules:[f=>!!f||"Name is required"]},null,8,["modelValue","rules"]),l(E,{modelValue:b(t).user.surname,"onUpdate:modelValue":s[2]||(s[2]=f=>b(t).user.surname=f),label:"Surname",rules:[f=>!!f||"Surname is required"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(te,{class:"bg-blue-2"},{default:o(()=>[l(Q,null,{default:o(()=>[l(lt,{style:{"background-color":"hsl(200, 50%, 90%)"}},{default:o(()=>[l(oe,{avatar:""},{default:o(()=>[l(ee,{name:"mail"})]),_:1}),l(oe,null,{default:o(()=>[T(P(b(n).userCreationNotification),1)]),_:1})]),_:1}),l(E,{modelValue:u.value.subject,"onUpdate:modelValue":s[3]||(s[3]=f=>u.value.subject=f),label:"Subject"},null,8,["modelValue"]),l(E,{modelValue:u.value.body,"onUpdate:modelValue":s[4]||(s[4]=f=>u.value.body=f),label:"Body",type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Vl=ne({__name:"UserUpdateDrawer",setup(e){const t=le(),n=Fe(),u=M({subject:"",body:""}),i=M(320),m=()=>{t.user=JSON.parse(JSON.stringify(t.selectedUser))},s=()=>{if(t.selectedUser.status!=="Inactive"&&t.user.status==="Inactive"){t.user.groupId=null;const f=t.user.email;t.user.email=null,i.value=720,u.value.subject=`Deauthorize ${t.user.givenName} ${t.user.surname}`,u.value.body=`Please remove ${t.user.givenName} from the Active Directory.
Name: ${t.user.givenName}
Surname: ${t.user.surname}
Email: ${f}
 
Thanks
 
This email has been sent from FileMaker by ${n.user.fullName}`}else i.value=320};return(f,d)=>(F(),z(et,{modelValue:b(t).editMode,"onUpdate:modelValue":d[11]||(d[11]=v=>b(t).editMode=v),onBeforeShow:d[12]||(d[12]=v=>m()),onBeforeHide:d[13]||(d[13]=v=>i.value=320),width:i.value,bordered:"",overlay:"",side:"right",class:"row"},{default:o(()=>[l(te,{class:"col"},{default:o(()=>[l(Q,{horizontal:""},{default:o(()=>[l(Ie,null,{default:o(()=>[T(" Edit User ")]),_:1}),l(I,{dense:"",label:"Save Changes",icon:"save",color:"primary",onClick:d[0]||(d[0]=v=>b(t).updateUser(u.value)),disable:b(t).user.status==="Active"&&!b(t).user.groupId},null,8,["disable"])]),_:1}),l(Q,null,{default:o(()=>[l(E,{modelValue:b(t).user.givenName,"onUpdate:modelValue":d[1]||(d[1]=v=>b(t).user.givenName=v),label:"Name"},null,8,["modelValue"]),l(E,{modelValue:b(t).user.surname,"onUpdate:modelValue":d[2]||(d[2]=v=>b(t).user.surname=v),label:"Surname"},null,8,["modelValue"]),l(E,{modelValue:b(t).user.loginName,"onUpdate:modelValue":d[3]||(d[3]=v=>b(t).user.loginName=v),label:"Login"},null,8,["modelValue"]),l(E,{modelValue:b(t).user.email,"onUpdate:modelValue":d[4]||(d[4]=v=>b(t).user.email=v),label:"Email",type:"email",rules:[v=>!v||/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(v)||"Invalid email"]},null,8,["modelValue","rules"]),l(E,{modelValue:b(t).user.note,"onUpdate:modelValue":d[5]||(d[5]=v=>b(t).user.note=v),label:"Note",type:"textarea"},null,8,["modelValue"])]),_:1}),l(Q,{style:{"background-color":"rgb(197, 198, 198)","border-radius":"4%"}},{default:o(()=>[l(Ke,{modelValue:b(t).user.status,"onUpdate:modelValue":[d[6]||(d[6]=v=>b(t).user.status=v),d[7]||(d[7]=v=>s())],label:"Status",options:b(t).statusOptions},null,8,["modelValue","options"]),l(Ke,{modelValue:b(t).user.groupId,"onUpdate:modelValue":d[8]||(d[8]=v=>b(t).user.groupId=v),"emit-value":"","map-options":"",label:"Group",clearable:"",disable:b(t).user.status!=="Active",options:b(n).groupsOptions},null,8,["modelValue","disable","options"])]),_:1}),b(t).user.status==="Active"&&(b(t).user.groupId===null||b(t).user.groupId==="")?(F(),z(Q,{key:0},{default:o(()=>[l(gt,{class:"bg-orange text-white",rounded:""},{avatar:o(()=>[l(ee,{name:"warning"})]),default:o(()=>[T(" Select a Group before saving changes ")]),_:1})]),_:1})):yt("",!0)]),_:1}),b(t).selectedUser.status!=="Inactive"&&b(t).user.status==="Inactive"?(F(),z(te,{key:0,class:"col"},{default:o(()=>[l(Q,null,{default:o(()=>[l(gt,{class:"bg-red text-white",rounded:""},{avatar:o(()=>[l(ee,{name:"warning"})]),default:o(()=>[T(" You are going to inactivate this user, the email and the group associated will be removed and an email to unauthorized the user will be sent. ")]),_:1})]),_:1}),l(te,{class:"bg-blue-2"},{default:o(()=>[l(Q,null,{default:o(()=>[l(lt,{style:{"background-color":"hsl(200, 50%, 90%)"}},{default:o(()=>[l(oe,{avatar:""},{default:o(()=>[l(ee,{name:"mail"})]),_:1}),l(oe,null,{default:o(()=>[T(P(b(n).userCreationNotification),1)]),_:1})]),_:1}),l(E,{modelValue:u.value.subject,"onUpdate:modelValue":d[9]||(d[9]=v=>u.value.subject=v),label:"Subject"},null,8,["modelValue"]),l(E,{modelValue:u.value.body,"onUpdate:modelValue":d[10]||(d[10]=v=>u.value.body=v),label:"Body",type:"textarea",autogrow:"",hint:"The email can be personalized before sending it."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):yt("",!0)]),_:1},8,["modelValue","width"]))}}),Nl=[{label:"Activity ID",value:"activityId",table:"z_ACT_Activity",field:"_kplt_Activity",type:"text",sql:"act"},{label:"Created At",value:"createdAt",table:"z_ACT_Activity",field:"CreatedAtUnix",type:"number",sql:"act"},{label:"Performer User ID",value:"performerUserId",table:"z_ACT_Activity",field:"_kflt_User_Performer",type:"text",sql:"act"},{label:"Performer User Name",value:"performerUserName",table:"z_CD_USE_Users",field:"Name",type:"text",sql:"use1"},{label:"Performer User Surname",value:"performerUserSurname",table:"z_CD_USE_Users",field:"Surname",type:"text",sql:"use1"},{label:"Related User ID",value:"relatedUserId",table:"z_ACT_Activity",field:"_kflt_User_Related",type:"text",sql:"act"},{label:"Related User Name",value:"relatedUserName",table:"z_CD_USE_Users",field:"Name",type:"text",sql:"use2"},{label:"Related User Surname",value:"relatedUserSurname",table:"z_CD_USE_Users",field:"Surname",type:"text",sql:"use2"},{label:"Action",value:"action",table:"z_ACT_Activity",field:"Action",type:"text",sql:"act"},{label:"Description",value:"description",table:"z_ACT_Activity",field:"Description",type:"text",sql:"act"},{label:"Note",value:"note",table:"z_ACT_Activity",field:"Note",type:"text",sql:"act"}],Ae=p(()=>ml(Nl));p(()=>M("SELECT "+Ae.value.map(t=>t)+" FROM z_ACT_Activity AS act").value);const Rl=p(()=>{const e=le(),t=M("SELECT "+Ae.value.map(n=>n)+" FROM z_ACT_Activity AS act");return Ae.value.some(n=>n.indexOf("use1.")!==-1)&&(t.value+=' LEFT OUTER JOIN z_CD_USE_Users AS use1 ON use1."_kplt_User" = act."_kflt_User_Performer" '),Ae.value.some(n=>n.indexOf("use2.")!==-1)&&(t.value+=' LEFT OUTER JOIN z_CD_USE_Users AS use2 ON use2."_kplt_User" = act."_kflt_User_Related" '),t.value+=` WHERE act."_kflt_User_Performer" ='${e.selectedUser.userId}' OR act."_kflt_User_Related" ='${e.selectedUser.userId}'`,t.value});const $l=ne({__name:"UsersList",setup(e){const t=le(),n=Pt(),u=i=>{t.selectedUser=i,t.editMode=!1,t.createMode=!1,n.readActivity(Rl.value)};return(i,m)=>(F(),z(te,{style:{width:"100%"}},{default:o(()=>[l(It,{style:{"margin-top":"76px"}},{default:o(()=>[(F(!0),ce(ve,null,pe(b(t).filterUsers,s=>(F(),z(lt,{key:s.userId,clickable:"",onClick:f=>u(s),class:"bg-grey-2 menu",active:b(t).selectedUser===s,"active-class":"menu-active"},{default:o(()=>[l(oe,{avatar:""},{default:o(()=>[l(X,{style:Vt({backgroundColor:s.color}),class:"text-white"},{default:o(()=>[T(P(s.initials),1)]),_:2},1032,["style"])]),_:2},1024),l(oe,null,{default:o(()=>[l(B,{class:"text-h4"},{default:o(()=>[T(P(s.givenName),1)]),_:2},1024),l(B,{class:"text-h5"},{default:o(()=>[T(P(s.surname),1)]),_:2},1024)]),_:2},1024),l(oe,{side:"",top:""},{default:o(()=>[l(il,{rounded:"",color:s.status==="Active"?"green":s.status==="Pending"?"orange":"grey"},null,8,["color"])]),_:2},1024)]),_:2},1032,["onClick","active"]))),128))]),_:1})]),_:1}))}});var Al=Dt($l,[["__scopeId","data-v-d8b8b4e8"]]);const Fl=ne({__name:"UserAvatar",setup(e){const t=le();return(n,u)=>(F(),z(X,fl({style:{backgroundColor:b(t).selectedUser.color},class:"text-white"},n.$attrs),{default:o(()=>[T(P(b(t).selectedUser.initials),1)]),_:1},16,["style"]))}}),Il=ne({__name:"UserInfoCard",setup(e){const t=le(),n=Fe();return(u,i)=>(F(),z(te,{style:{width:"16rem"}},{default:o(()=>[l(Q,{class:"row"},{default:o(()=>[l(Se),l(ae,{dark:"",size:"md",label:b(t).selectedUser.status,color:b(t).selectedUser.status==="Active"?"green":b(t).selectedUser.status==="Pending"?"orange":"grey"},null,8,["label","color"])]),_:1}),l(Q,{class:"column items-center q-pa-none"},{default:o(()=>[l(Fl,{size:"100px"})]),_:1}),l(Q,null,{default:o(()=>[l(B,{class:"text-h3 text-center"},{default:o(()=>{var m;return[T(P((m=b(t).selectedUser)==null?void 0:m.givenName),1)]}),_:1}),l(B,{class:"text-h4 text-center"},{default:o(()=>{var m;return[T(P((m=b(t).selectedUser)==null?void 0:m.surname),1)]}),_:1})]),_:1}),l(Q,{class:"bg-blue-2"},{default:o(()=>[l(oe,{avatar:""},{default:o(()=>[l(B,null,{default:o(()=>[T("Group")]),_:1}),l(B,{class:"text-h4"},{default:o(()=>[T(P(b(t).selectedUser.groupId?b(n).groups[b(t).selectedUser.groupId].name:"No Group"),1)]),_:1})]),_:1})]),_:1})]),_:1}))}});var re=ue({name:"QTh",props:{props:Object,autoWidth:Boolean},emits:["click"],setup(e,{slots:t,emit:n}){const u=fe(),{proxy:{$q:i}}=u,m=s=>{n("click",s)};return()=>{if(e.props===void 0)return y("th",{class:e.autoWidth===!0?"q-table--col-auto-width":"",onClick:m},me(t.default));let s,f;const d=u.vnode.key;if(d){if(s=e.props.colsMap[d],s===void 0)return}else s=e.props.col;if(s.sortable===!0){const a=s.align==="right"?"unshift":"push";f=bl(t.default,[]),f[a](y(ee,{class:s.__iconClass,name:i.iconSet.table.arrowUp}))}else f=me(t.default);const v={class:s.__thClass+(e.autoWidth===!0?" q-table--col-auto-width":""),style:s.headerStyle,onClick:a=>{s.sortable===!0&&e.props.sort(s),m(a)}};return y("th",v,f)}}}),se=ue({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:t}){const n=fe(),u=p(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return y("td",{class:u.value},me(t.default));const i=n.vnode.key,m=(e.props.colsMap!==void 0?e.props.colsMap[i]:null)||e.props.col;if(m===void 0)return;const{row:s}=e.props;return y("td",{class:u.value+m.__tdClass(s),style:m.__tdStyle(s)},me(t.default))}}}),Ol=ue({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:t}){const n=p(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>y("tr",{class:n.value},me(t.default))}});const Ml=["horizontal","vertical","cell","none"];var Bl=ue({name:"QMarkupTable",props:{...at,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:e=>Ml.includes(e)}},setup(e,{slots:t}){const n=fe(),u=rt(e,n.proxy.$q),i=p(()=>`q-markup-table q-table__container q-table__card q-table--${e.separator}-separator`+(u.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(e.dense===!0?" q-table--dense":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")+(e.square===!0?" q-table--square":"")+(e.wrapCells===!1?" q-table--no-wrap":""));return()=>y("div",{class:i.value},[y("table",{class:"q-table"},me(t.default))])}});function Ot(e,t){return y("div",e,[y("table",{class:"q-table"},t)])}const El={list:It,table:Bl},zl=["list","table","__qtable"];var Ll=ue({name:"QVirtualScroll",props:{...dl,type:{type:String,default:"list",validator:e=>zl.includes(e)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}},setup(e,{slots:t,attrs:n}){let u;const i=M(null),m=p(()=>e.itemsSize>=0&&e.itemsFn!==void 0?parseInt(e.itemsSize,10):Array.isArray(e.items)?e.items.length:0),{virtualScrollSliceRange:s,localResetVirtualScroll:f,padVirtualScroll:d,onVirtualScrollEvt:v}=cl({virtualScrollLength:m,getVirtualScrollTarget:R,getVirtualScrollEl:N}),a=p(()=>{if(m.value===0)return[];const _=(g,c)=>({index:s.value.from+c,item:g});return e.itemsFn===void 0?e.items.slice(s.value.from,s.value.to).map(_):e.itemsFn(s.value.from,s.value.to-s.value.from).map(_)}),U=p(()=>"q-virtual-scroll q-virtual-scroll"+(e.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(e.scrollTarget!==void 0?"":" scroll")),V=p(()=>e.scrollTarget!==void 0?{}:{tabindex:0});W(m,()=>{f()}),W(()=>e.scrollTarget,()=>{k(),D()});function N(){return i.value.$el||i.value}function R(){return u}function D(){u=_l(N(),e.scrollTarget),u.addEventListener("scroll",v,_t.passive)}function k(){u!==void 0&&(u.removeEventListener("scroll",v,_t.passive),u=void 0)}function x(){let _=d(e.type==="list"?"div":"tbody",a.value.map(t.default));return t.before!==void 0&&(_=t.before().concat(_)),$t(t.after,_)}return tt(()=>{f()}),Nt(()=>{D()}),gl(()=>{D()}),yl(()=>{k()}),Rt(()=>{k()}),()=>{if(t.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return e.type==="__qtable"?Ot({ref:i,class:"q-table__middle "+U.value},x()):y(El[e.type],{...n,ref:i,class:[n.class,U.value],...V.value},x)}}});const Ql={xs:2,sm:4,md:6,lg:10,xl:14};function ht(e,t,n){return{transform:t===!0?`translateX(${n.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var jl=ue({name:"QLinearProgress",props:{...at,...Sl,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:t}){const{proxy:n}=fe(),u=rt(e,n.$q),i=pl(e,Ql),m=p(()=>e.indeterminate===!0||e.query===!0),s=p(()=>e.reverse!==e.query),f=p(()=>({...i.value!==null?i.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),d=p(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),v=p(()=>ht(e.buffer!==void 0?e.buffer:1,s.value,n.$q)),a=p(()=>`with${e.instantFeedback===!0?"out":""}-transition`),U=p(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${a.value} q-linear-progress__track--${u.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),V=p(()=>ht(m.value===!0?1:e.value,s.value,n.$q)),N=p(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${a.value} q-linear-progress__model--${m.value===!0?"in":""}determinate`),R=p(()=>({width:`${e.value*100}%`})),D=p(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${a.value}`);return()=>{const k=[y("div",{class:U.value,style:v.value}),y("div",{class:N.value,style:V.value})];return e.stripe===!0&&m.value===!1&&k.push(y("div",{class:D.value,style:R.value})),y("div",{class:d.value,style:f.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},$t(t.default,k))}}});let _e=0;const Hl={fullscreen:Boolean,noRouteFullscreenExit:Boolean},Yl=["update:fullscreen","fullscreen"];function Gl(){const e=fe(),{props:t,emit:n,proxy:u}=e;let i,m,s;const f=M(!1);wl(e)===!0&&W(()=>u.$route.fullPath,()=>{t.noRouteFullscreenExit!==!0&&a()}),W(()=>t.fullscreen,U=>{f.value!==U&&d()}),W(f,U=>{n("update:fullscreen",U),n("fullscreen",U)});function d(){f.value===!0?a():v()}function v(){f.value!==!0&&(f.value=!0,s=u.$el.parentNode,s.replaceChild(m,u.$el),document.body.appendChild(u.$el),_e++,_e===1&&document.body.classList.add("q-body--fullscreen-mixin"),i={handler:a},St.add(i))}function a(){f.value===!0&&(i!==void 0&&(St.remove(i),i=void 0),s.replaceChild(u.$el,m),f.value=!1,_e=Math.max(0,_e-1),_e===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),u.$el.scrollIntoView!==void 0&&setTimeout(()=>{u.$el.scrollIntoView()})))}return tt(()=>{m=document.createElement("span")}),Nt(()=>{t.fullscreen===!0&&v()}),Rt(a),Object.assign(u,{toggleFullscreen:d,setFullscreen:v,exitFullscreen:a}),{inFullscreen:f,toggleFullscreen:d}}function Wl(e,t){return new Date(e)-new Date(t)}const Jl={sortMethod:Function,binaryStateSort:Boolean,columnSortOrder:{type:String,validator:e=>e==="ad"||e==="da",default:"ad"}};function Kl(e,t,n,u){const i=p(()=>{const{sortBy:f}=t.value;return f&&n.value.find(d=>d.name===f)||null}),m=p(()=>e.sortMethod!==void 0?e.sortMethod:(f,d,v)=>{const a=n.value.find(N=>N.name===d);if(a===void 0||a.field===void 0)return f;const U=v===!0?-1:1,V=typeof a.field=="function"?N=>a.field(N):N=>N[a.field];return f.sort((N,R)=>{let D=V(N),k=V(R);return a.rawSort!==void 0?a.rawSort(D,k,N,R)*U:D==null?-1*U:k==null?1*U:a.sort!==void 0?a.sort(D,k,N,R)*U:Ze(D)===!0&&Ze(k)===!0?(D-k)*U:pt(D)===!0&&pt(k)===!0?Wl(D,k)*U:typeof D=="boolean"&&typeof k=="boolean"?(D-k)*U:([D,k]=[D,k].map(x=>(x+"").toLocaleString().toLowerCase()),D<k?-1*U:D===k?0:U)})});function s(f){let d=e.columnSortOrder;if(hl(f)===!0)f.sortOrder&&(d=f.sortOrder),f=f.name;else{const U=n.value.find(V=>V.name===f);U!==void 0&&U.sortOrder&&(d=U.sortOrder)}let{sortBy:v,descending:a}=t.value;v!==f?(v=f,a=d==="da"):e.binaryStateSort===!0?a=!a:a===!0?d==="ad"?v=null:a=!1:d==="ad"?a=!0:v=null,u({sortBy:v,descending:a,page:1})}return{columnToSort:i,computedSortMethod:m,sort:s}}const Zl={filter:[String,Object],filterMethod:Function};function Xl(e,t){const n=p(()=>e.filterMethod!==void 0?e.filterMethod:(u,i,m,s)=>{const f=i?i.toLowerCase():"";return u.filter(d=>m.some(v=>{const a=s(v,d)+"";return(a==="undefined"||a==="null"?"":a.toLowerCase()).indexOf(f)!==-1}))});return W(()=>e.filter,()=>{At(()=>{t({page:1},!0)})},{deep:!0}),{computedFilterMethod:n}}function ea(e,t){for(const n in t)if(t[n]!==e[n])return!1;return!0}function Ut(e){return e.page<1&&(e.page=1),e.rowsPerPage!==void 0&&e.rowsPerPage<1&&(e.rowsPerPage=0),e}const ta={pagination:Object,rowsPerPageOptions:{type:Array,default:()=>[5,7,10,15,20,25,50,0]},"onUpdate:pagination":[Function,Array]};function la(e,t){const{props:n,emit:u}=e,i=M(Object.assign({sortBy:null,descending:!1,page:1,rowsPerPage:n.rowsPerPageOptions.length!==0?n.rowsPerPageOptions[0]:5},n.pagination)),m=p(()=>{const a=n["onUpdate:pagination"]!==void 0?{...i.value,...n.pagination}:i.value;return Ut(a)}),s=p(()=>m.value.rowsNumber!==void 0);function f(a){d({pagination:a,filter:n.filter})}function d(a={}){At(()=>{u("request",{pagination:a.pagination||m.value,filter:a.filter||n.filter,getCellValue:t})})}function v(a,U){const V=Ut({...m.value,...a});if(ea(m.value,V)===!0){s.value===!0&&U===!0&&f(V);return}if(s.value===!0){f(V);return}n.pagination!==void 0&&n["onUpdate:pagination"]!==void 0?u("update:pagination",V):i.value=V}return{innerPagination:i,computedPagination:m,isServerSide:s,requestServerInteraction:d,setPagination:v}}function aa(e,t,n,u,i,m){const{props:s,emit:f,proxy:{$q:d}}=e,v=p(()=>u.value===!0?n.value.rowsNumber||0:m.value),a=p(()=>{const{page:c,rowsPerPage:w}=n.value;return(c-1)*w}),U=p(()=>{const{page:c,rowsPerPage:w}=n.value;return c*w}),V=p(()=>n.value.page===1),N=p(()=>n.value.rowsPerPage===0?1:Math.max(1,Math.ceil(v.value/n.value.rowsPerPage))),R=p(()=>U.value===0?!0:n.value.page>=N.value),D=p(()=>(s.rowsPerPageOptions.includes(t.value.rowsPerPage)?s.rowsPerPageOptions:[t.value.rowsPerPage].concat(s.rowsPerPageOptions)).map(w=>({label:w===0?d.lang.table.allRows:""+w,value:w})));W(N,(c,w)=>{if(c===w)return;const O=n.value.page;c&&!O?i({page:1}):c<O&&i({page:c})});function k(){i({page:1})}function x(){const{page:c}=n.value;c>1&&i({page:c-1})}function _(){const{page:c,rowsPerPage:w}=n.value;U.value>0&&c*w<v.value&&i({page:c+1})}function g(){i({page:N.value})}return s["onUpdate:pagination"]!==void 0&&f("update:pagination",{...n.value}),{firstRowIndex:a,lastRowIndex:U,isFirstPage:V,isLastPage:R,pagesNumber:N,computedRowsPerPageOptions:D,computedRowsNumber:v,firstPage:k,prevPage:x,nextPage:_,lastPage:g}}const ra={selection:{type:String,default:"none",validator:e=>["single","multiple","none"].includes(e)},selected:{type:Array,default:()=>[]}},oa=["update:selected","selection"];function na(e,t,n,u){const i=p(()=>{const R={};return e.selected.map(u.value).forEach(D=>{R[D]=!0}),R}),m=p(()=>e.selection!=="none"),s=p(()=>e.selection==="single"),f=p(()=>e.selection==="multiple"),d=p(()=>n.value.length!==0&&n.value.every(R=>i.value[u.value(R)]===!0)),v=p(()=>d.value!==!0&&n.value.some(R=>i.value[u.value(R)]===!0)),a=p(()=>e.selected.length);function U(R){return i.value[R]===!0}function V(){t("update:selected",[])}function N(R,D,k,x){t("selection",{rows:D,added:k,keys:R,evt:x});const _=s.value===!0?k===!0?D:[]:k===!0?e.selected.concat(D):e.selected.filter(g=>R.includes(u.value(g))===!1);t("update:selected",_)}return{hasSelectionMode:m,singleSelection:s,multipleSelection:f,allRowsSelected:d,someRowsSelected:v,rowsSelectedNumber:a,isRowSelected:U,clearSelection:V,updateSelection:N}}function Ct(e){return Array.isArray(e)?e.slice():[]}const sa={expanded:Array},ua=["update:expanded"];function ia(e,t){const n=M(Ct(e.expanded));W(()=>e.expanded,s=>{n.value=Ct(s)});function u(s){return n.value.includes(s)}function i(s){e.expanded!==void 0?t("update:expanded",s):n.value=s}function m(s,f){const d=n.value.slice(),v=d.indexOf(s);f===!0?v===-1&&(d.push(s),i(d)):v!==-1&&(d.splice(v,1),i(d))}return{isRowExpanded:u,setExpanded:i,updateExpanded:m}}const da={visibleColumns:Array};function ca(e,t,n){const u=p(()=>{if(e.columns!==void 0)return e.columns;const f=e.rows[0];return f!==void 0?Object.keys(f).map(d=>({name:d,label:d.toUpperCase(),field:d,align:Ze(f[d])?"right":"left",sortable:!0})):[]}),i=p(()=>{const{sortBy:f,descending:d}=t.value;return(e.visibleColumns!==void 0?u.value.filter(a=>a.required===!0||e.visibleColumns.includes(a.name)===!0):u.value).map(a=>{const U=a.align||"right",V=`text-${U}`;return{...a,align:U,__iconClass:`q-table__sort-icon q-table__sort-icon--${U}`,__thClass:V+(a.headerClasses!==void 0?" "+a.headerClasses:"")+(a.sortable===!0?" sortable":"")+(a.name===f?` sorted ${d===!0?"sort-desc":""}`:""),__tdStyle:a.style!==void 0?typeof a.style!="function"?()=>a.style:a.style:()=>null,__tdClass:a.classes!==void 0?typeof a.classes!="function"?()=>V+" "+a.classes:N=>V+" "+a.classes(N):()=>V}})}),m=p(()=>{const f={};return i.value.forEach(d=>{f[d.name]=d}),f}),s=p(()=>e.tableColspan!==void 0?e.tableColspan:i.value.length+(n.value===!0?1:0));return{colList:u,computedCols:i,computedColsMap:m,computedColspan:s}}const Ne="q-table__bottom row items-center",Mt={};xt.forEach(e=>{Mt[e]={}});var va=ue({name:"QTable",props:{rows:{type:Array,default:()=>[]},rowKey:{type:[String,Function],default:"id"},columns:Array,loading:Boolean,iconFirstPage:String,iconPrevPage:String,iconNextPage:String,iconLastPage:String,title:String,hideHeader:Boolean,grid:Boolean,gridHeader:Boolean,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,separator:{type:String,default:"horizontal",validator:e=>["horizontal","vertical","cell","none"].includes(e)},wrapCells:Boolean,virtualScroll:Boolean,virtualScrollTarget:{default:void 0},...Mt,noDataLabel:String,noResultsLabel:String,loadingLabel:String,selectedRowsLabel:Function,rowsPerPageLabel:String,paginationLabel:Function,color:{type:String,default:"grey-8"},titleClass:[String,Array,Object],tableStyle:[String,Array,Object],tableClass:[String,Array,Object],tableHeaderStyle:[String,Array,Object],tableHeaderClass:[String,Array,Object],cardContainerClass:[String,Array,Object],cardContainerStyle:[String,Array,Object],cardStyle:[String,Array,Object],cardClass:[String,Array,Object],hideBottom:Boolean,hideSelectedBanner:Boolean,hideNoData:Boolean,hidePagination:Boolean,onRowClick:Function,onRowDblclick:Function,onRowContextmenu:Function,...at,...Hl,...da,...Zl,...ta,...sa,...ra,...Jl},emits:["request","virtualScroll",...Yl,...ua,...oa],setup(e,{slots:t,emit:n}){const u=fe(),{proxy:{$q:i}}=u,m=rt(e,i),{inFullscreen:s,toggleFullscreen:f}=Gl(),d=p(()=>typeof e.rowKey=="function"?e.rowKey:r=>r[e.rowKey]),v=M(null),a=M(null),U=p(()=>e.grid!==!0&&e.virtualScroll===!0),V=p(()=>" q-table__card"+(m.value===!0?" q-table__card--dark q-dark":"")+(e.square===!0?" q-table--square":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")),N=p(()=>`q-table__container q-table--${e.separator}-separator column no-wrap`+(e.grid===!0?" q-table--grid":V.value)+(m.value===!0?" q-table--dark":"")+(e.dense===!0?" q-table--dense":"")+(e.wrapCells===!1?" q-table--no-wrap":"")+(s.value===!0?" fullscreen scroll":"")),R=p(()=>N.value+(e.loading===!0?" q-table--loading":""));W(()=>e.tableStyle+e.tableClass+e.tableHeaderStyle+e.tableHeaderClass+N.value,()=>{U.value===!0&&a.value!==null&&a.value.reset()});const{innerPagination:D,computedPagination:k,isServerSide:x,requestServerInteraction:_,setPagination:g}=la(u,ie),{computedFilterMethod:c}=Xl(e,g),{isRowExpanded:w,setExpanded:O,updateExpanded:H}=ia(e,n),Y=p(()=>{let r=e.rows;if(x.value===!0||r.length===0)return r;const{sortBy:S,descending:h}=k.value;return e.filter&&(r=c.value(r,e.filter,K.value,ie)),Lt.value!==null&&(r=Qt.value(e.rows===r?r.slice():r,S,h)),r}),we=p(()=>Y.value.length),G=p(()=>{let r=Y.value;if(x.value===!0)return r;const{rowsPerPage:S}=k.value;return S!==0&&(Ce.value===0&&e.rows!==r?r.length>Te.value&&(r=r.slice(0,Te.value)):r=r.slice(Ce.value,Te.value)),r}),{hasSelectionMode:J,singleSelection:he,multipleSelection:ot,allRowsSelected:Bt,someRowsSelected:nt,rowsSelectedNumber:Oe,isRowSelected:Me,clearSelection:Et,updateSelection:Ue}=na(e,n,G,d),{colList:zt,computedCols:K,computedColsMap:st,computedColspan:ut}=ca(e,k,J),{columnToSort:Lt,computedSortMethod:Qt,sort:Be}=Kl(e,k,zt,g),{firstRowIndex:Ce,lastRowIndex:Te,isFirstPage:Ee,isLastPage:ze,pagesNumber:ke,computedRowsPerPageOptions:jt,computedRowsNumber:qe,firstPage:Le,prevPage:Qe,nextPage:je,lastPage:He}=aa(u,D,k,x,g,we),Ht=p(()=>G.value.length===0),Yt=p(()=>{const r={};return xt.forEach(S=>{r[S]=e[S]}),r.virtualScrollItemSize===void 0&&(r.virtualScrollItemSize=e.dense===!0?28:48),r});function Gt(){U.value===!0&&a.value.reset()}function Wt(){if(e.grid===!0)return sl();const r=e.hideHeader!==!0?mt:null;if(U.value===!0){const h=t["top-row"],C=t["bottom-row"],q={default:A=>dt(A.item,t.body,A.index)};if(h!==void 0){const A=y("tbody",h({cols:K.value}));q.before=r===null?()=>A:()=>[r()].concat(A)}else r!==null&&(q.before=r);return C!==void 0&&(q.after=()=>y("tbody",C({cols:K.value}))),y(Ll,{ref:a,class:e.tableClass,style:e.tableStyle,...Yt.value,scrollTarget:e.virtualScrollTarget,items:G.value,type:"__qtable",tableColspan:ut.value,onVirtualScroll:Kt},q)}const S=[Zt()];return r!==null&&S.unshift(r()),Ot({class:["q-table__middle scroll",e.tableClass],style:e.tableStyle},S)}function Jt(r,S){if(a.value!==null){a.value.scrollTo(r,S);return}r=parseInt(r,10);const h=v.value.querySelector(`tbody tr:nth-of-type(${r+1})`);if(h!==null){const C=v.value.querySelector(".q-table__middle.scroll"),q=h.offsetTop-e.virtualScrollStickySizeStart,A=q<C.scrollTop?"decrease":"increase";C.scrollTop=q,n("virtualScroll",{index:r,from:0,to:D.value.rowsPerPage-1,direction:A})}}function Kt(r){n("virtualScroll",r)}function it(){return[y(jl,{class:"q-table__linear-progress",color:e.color,dark:m.value,indeterminate:!0,trackColor:"transparent"})]}function dt(r,S,h){const C=d.value(r),q=Me(C);if(S!==void 0)return S(ct({key:C,row:r,pageIndex:h,__trClass:q?"selected":""}));const A=t["body-cell"],$=K.value.map(L=>{const Pe=t[`body-cell-${L.name}`],De=Pe!==void 0?Pe:A;return De!==void 0?De(Xt({key:C,row:r,pageIndex:h,col:L})):y("td",{class:L.__tdClass(r),style:L.__tdStyle(r)},ie(L,r))});if(J.value===!0){const L=t["body-selection"],Pe=L!==void 0?L(el({key:C,row:r,pageIndex:h})):[y(Je,{modelValue:q,color:e.color,dark:m.value,dense:e.dense,"onUpdate:modelValue":(De,ul)=>{Ue([C],[r],De,ul)}})];$.unshift(y("td",{class:"q-table--col-auto-width"},Pe))}const Z={key:C,class:{selected:q}};return e.onRowClick!==void 0&&(Z.class["cursor-pointer"]=!0,Z.onClick=L=>{n("RowClick",L,r,h)}),e.onRowDblclick!==void 0&&(Z.class["cursor-pointer"]=!0,Z.onDblclick=L=>{n("RowDblclick",L,r,h)}),e.onRowContextmenu!==void 0&&(Z.class["cursor-pointer"]=!0,Z.onContextmenu=L=>{n("RowContextmenu",L,r,h)}),y("tr",Z,$)}function Zt(){const r=t.body,S=t["top-row"],h=t["bottom-row"];let C=G.value.map((q,A)=>dt(q,r,A));return S!==void 0&&(C=S({cols:K.value}).concat(C)),h!==void 0&&(C=C.concat(h({cols:K.value}))),y("tbody",C)}function ct(r){return Ye(r),r.cols=r.cols.map(S=>ye({...S},"value",()=>ie(S,r.row))),r}function Xt(r){return Ye(r),ye(r,"value",()=>ie(r.col,r.row)),r}function el(r){return Ye(r),r}function Ye(r){Object.assign(r,{cols:K.value,colsMap:st.value,sort:Be,rowIndex:Ce.value+r.pageIndex,color:e.color,dark:m.value,dense:e.dense}),J.value===!0&&ye(r,"selected",()=>Me(r.key),(S,h)=>{Ue([r.key],[r.row],S,h)}),ye(r,"expand",()=>w(r.key),S=>{H(r.key,S)})}function ie(r,S){const h=typeof r.field=="function"?r.field(S):S[r.field];return r.format!==void 0?r.format(h,S):h}const de=p(()=>({pagination:k.value,pagesNumber:ke.value,isFirstPage:Ee.value,isLastPage:ze.value,firstPage:Le,prevPage:Qe,nextPage:je,lastPage:He,inFullscreen:s.value,toggleFullscreen:f}));function tl(){const r=t.top,S=t["top-left"],h=t["top-right"],C=t["top-selection"],q=J.value===!0&&C!==void 0&&Oe.value>0,A="q-table__top relative-position row items-center";if(r!==void 0)return y("div",{class:A},[r(de.value)]);let $;if(q===!0?$=C(de.value).slice():($=[],S!==void 0?$.push(y("div",{class:"q-table__control"},[S(de.value)])):e.title&&$.push(y("div",{class:"q-table__control"},[y("div",{class:["q-table__title",e.titleClass]},e.title)]))),h!==void 0&&($.push(y("div",{class:"q-table__separator col"})),$.push(y("div",{class:"q-table__control"},[h(de.value)]))),$.length!==0)return y("div",{class:A},$)}const vt=p(()=>nt.value===!0?null:Bt.value);function mt(){const r=ll();return e.loading===!0&&t.loading===void 0&&r.push(y("tr",{class:"q-table__progress"},[y("th",{class:"relative-position",colspan:ut.value},it())])),y("thead",r)}function ll(){const r=t.header,S=t["header-cell"];if(r!==void 0)return r(Ge({header:!0})).slice();const h=K.value.map(C=>{const q=t[`header-cell-${C.name}`],A=q!==void 0?q:S,$=Ge({col:C});return A!==void 0?A($):y(re,{key:C.name,props:$},()=>C.label)});if(he.value===!0&&e.grid!==!0)h.unshift(y("th",{class:"q-table--col-auto-width"}," "));else if(ot.value===!0){const C=t["header-selection"],q=C!==void 0?C(Ge({})):[y(Je,{color:e.color,modelValue:vt.value,dark:m.value,dense:e.dense,"onUpdate:modelValue":ft})];h.unshift(y("th",{class:"q-table--col-auto-width"},q))}return[y("tr",{class:e.tableHeaderClass,style:e.tableHeaderStyle},h)]}function Ge(r){return Object.assign(r,{cols:K.value,sort:Be,colsMap:st.value,color:e.color,dark:m.value,dense:e.dense}),ot.value===!0&&ye(r,"selected",()=>vt.value,ft),r}function ft(r){nt.value===!0&&(r=!1),Ue(G.value.map(d.value),G.value,r)}const xe=p(()=>{const r=[e.iconFirstPage||i.iconSet.table.firstPage,e.iconPrevPage||i.iconSet.table.prevPage,e.iconNextPage||i.iconSet.table.nextPage,e.iconLastPage||i.iconSet.table.lastPage];return i.lang.rtl===!0?r.reverse():r});function al(){if(e.hideBottom===!0)return;if(Ht.value===!0){if(e.hideNoData===!0)return;const h=e.loading===!0?e.loadingLabel||i.lang.table.loading:e.filter?e.noResultsLabel||i.lang.table.noResults:e.noDataLabel||i.lang.table.noData,C=t["no-data"],q=C!==void 0?[C({message:h,icon:i.iconSet.table.warning,filter:e.filter})]:[y(ee,{class:"q-table__bottom-nodata-icon",name:i.iconSet.table.warning}),h];return y("div",{class:Ne+" q-table__bottom--nodata"},q)}const r=t.bottom;if(r!==void 0)return y("div",{class:Ne},[r(de.value)]);const S=e.hideSelectedBanner!==!0&&J.value===!0&&Oe.value>0?[y("div",{class:"q-table__control"},[y("div",[(e.selectedRowsLabel||i.lang.table.selectedRecords)(Oe.value)])])]:[];if(e.hidePagination!==!0)return y("div",{class:Ne+" justify-end"},ol(S));if(S.length!==0)return y("div",{class:Ne},S)}function rl(r){g({page:1,rowsPerPage:r.value})}function ol(r){let S;const{rowsPerPage:h}=k.value,C=e.paginationLabel||i.lang.table.pagination,q=t.pagination,A=e.rowsPerPageOptions.length>1;if(r.push(y("div",{class:"q-table__separator col"})),A===!0&&r.push(y("div",{class:"q-table__control"},[y("span",{class:"q-table__bottom-item"},[e.rowsPerPageLabel||i.lang.table.recordsPerPage]),y(Ke,{class:"q-table__select inline q-table__bottom-item",color:e.color,modelValue:h,options:jt.value,displayValue:h===0?i.lang.table.allRows:h,dark:m.value,borderless:!0,dense:!0,optionsDense:!0,optionsCover:!0,"onUpdate:modelValue":rl})])),q!==void 0)S=q(de.value);else if(S=[y("span",h!==0?{class:"q-table__bottom-item"}:{},[h?C(Ce.value+1,Math.min(Te.value,qe.value),qe.value):C(1,we.value,qe.value)])],h!==0&&ke.value>1){const $={color:e.color,round:!0,dense:!0,flat:!0};e.dense===!0&&($.size="sm"),ke.value>2&&S.push(y(I,{key:"pgFirst",...$,icon:xe.value[0],disable:Ee.value,onClick:Le})),S.push(y(I,{key:"pgPrev",...$,icon:xe.value[1],disable:Ee.value,onClick:Qe}),y(I,{key:"pgNext",...$,icon:xe.value[2],disable:ze.value,onClick:je})),ke.value>2&&S.push(y(I,{key:"pgLast",...$,icon:xe.value[3],disable:ze.value,onClick:He}))}return r.push(y("div",{class:"q-table__control"},S)),r}function nl(){const r=e.gridHeader===!0?[y("table",{class:"q-table"},[mt()])]:e.loading===!0&&t.loading===void 0?it():void 0;return y("div",{class:"q-table__middle"},r)}function sl(){const r=t.item!==void 0?t.item:S=>{const h=S.cols.map(q=>y("div",{class:"q-table__grid-item-row"},[y("div",{class:"q-table__grid-item-title"},[q.label]),y("div",{class:"q-table__grid-item-value"},[q.value])]));if(J.value===!0){const q=t["body-selection"],A=q!==void 0?q(S):[y(Je,{modelValue:S.selected,color:e.color,dark:m.value,dense:e.dense,"onUpdate:modelValue":($,Z)=>{Ue([S.key],[S.row],$,Z)}})];h.unshift(y("div",{class:"q-table__grid-item-row"},A),y(vl,{dark:m.value}))}const C={class:["q-table__grid-item-card"+V.value,e.cardClass],style:e.cardStyle};return(e.onRowClick!==void 0||e.onRowDblclick!==void 0)&&(C.class[0]+=" cursor-pointer",e.onRowClick!==void 0&&(C.onClick=q=>{n("RowClick",q,S.row,S.pageIndex)}),e.onRowDblclick!==void 0&&(C.onDblclick=q=>{n("RowDblclick",q,S.row,S.pageIndex)})),y("div",{class:"q-table__grid-item col-xs-12 col-sm-6 col-md-4 col-lg-3"+(S.selected===!0?" q-table__grid-item--selected":"")},[y("div",C,h)])};return y("div",{class:["q-table__grid-content row",e.cardContainerClass],style:e.cardContainerStyle},G.value.map((S,h)=>r(ct({key:d.value(S),row:S,pageIndex:h}))))}return Object.assign(u.proxy,{requestServerInteraction:_,setPagination:g,firstPage:Le,prevPage:Qe,nextPage:je,lastPage:He,isRowSelected:Me,clearSelection:Et,isRowExpanded:w,setExpanded:O,sort:Be,resetVirtualScroll:Gt,scrollTo:Jt,getCellValue:ie}),Ul(u.proxy,{filteredSortedRows:()=>Y.value,computedRows:()=>G.value,computedRowsNumber:()=>qe.value}),()=>{const r=[tl()],S={ref:v,class:R.value};return e.grid===!0?r.push(nl()):Object.assign(S,{class:[S.class,e.cardClass],style:e.cardStyle}),r.push(Wt(),al()),e.loading===!0&&t.loading!==void 0&&r.push(t.loading()),y("div",S,r)}}});function Tt(e){setTimeout(()=>{window.URL.revokeObjectURL(e.href)},1e4),e.remove()}function ma(e,t,n={}){const{mimeType:u,byteOrderMark:i,encoding:m}=typeof n=="string"?{mimeType:n}:n,s=m!==void 0?new TextEncoder(m).encode([t]):t,f=i!==void 0?[i,s]:[s],d=new Blob(f,{type:u||"application/octet-stream"}),v=document.createElement("a");v.href=window.URL.createObjectURL(d),v.setAttribute("download",e),typeof v.download=="undefined"&&v.setAttribute("target","_blank"),v.classList.add("hidden"),v.style.position="fixed",document.body.appendChild(v);try{return v.click(),Tt(v),!0}catch(a){return Tt(v),a}}const kt=()=>new Date(Date.UTC(new Date().getUTCFullYear(),new Date().getUTCMonth(),new Date().getUTCDate(),new Date().getUTCHours(),new Date().getUTCMinutes(),new Date().getUTCSeconds())),fa=e=>new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),ba=e=>{const t=new Date(e.getUTCFullYear(),e.getUTCMonth(),1);return t.setUTCHours(0,0,0,0),t},Re=e=>e.toISOString().split("T")[0],qt=e=>new Date(e);const be=e=>(kl("data-v-272258b2"),e=e(),ql(),e),ga=be(()=>j("span",{style:{"font-weight":"bold"}},"Timeframe:",-1)),ya=be(()=>j("span",{style:{"font-weight":"bold"}},"Performer Users:",-1)),_a=be(()=>j("span",{style:{"font-weight":"bold"}},"Related Users:",-1)),Sa=be(()=>j("span",{style:{"font-weight":"bold"}},"Actions:",-1)),pa=be(()=>j("span",{style:{"font-weight":"bold"}},"Decription Filter:",-1)),wa=be(()=>j("span",{style:{"font-weight":"bold"}},"Size:",-1)),ha={class:"q-ma-md column",style:{gap:"0.6rem"}},Ua={class:"q-ma-md column",style:{gap:"0.6rem"}},Ca={class:"q-mx-md"},Ta=ne({__name:"UserActivityTable",setup(e){const t=Pt(),n=le(),u=M(null),i=M([{name:"rowNumber",label:"rowNumber",align:"right",field:"",sortable:!1},{name:"activityId",label:"ID",align:"left",field:"activityId",sortable:!1},{name:"date",label:"Date",align:"left",field:"date",sortable:!1},{name:"time",label:"Time",align:"left",field:"time",sortable:!1},{name:"performerUserFullName",label:"Performer User",align:"left",field:"performerUserFullName",sortable:!1},{name:"relatedUserFullName",label:"Related User",align:"left",field:"relatedUserFullName",sortable:!1},{name:"action",label:"Action",align:"left",field:"action",sortable:!1},{name:"description",label:"Description",align:"left",field:"description",sortable:!1}]),m=["rowNumber","date","time","performerUserFullName","relatedUserFullName","action","description"],s=kt(),f=ba(s),d=[{value:"today",label:"Today"},{value:"yesterday",label:"Yesterday"},{value:"monthToDate",label:"Month to Date"},{value:"lastMonth",label:"Last Month"},{value:"custom",label:"Custom"}],v=M(!1),a=M({term:"",timeframe:"monthToDate",dateStart:Re(f),dateEnd:Re(s),searchColumns:["description"],performerUserId:[],relatedUserId:[],actions:[]}),U=p(()=>[...new Set(t.activity.map(x=>x.action))]),V=p(()=>t.activity.map(x=>({value:x.performerUserId,label:x.performerUserFullName})).filter((x,_,g)=>_===g.findIndex(c=>c.label===x.label&&c.value===x.value))),N=p(()=>t.activity.map(x=>({value:x.relatedUserId,label:x.relatedUserFullName})).filter((x,_,g)=>_===g.findIndex(c=>c.label===x.label&&c.value===x.value))),R=x=>{a.value.timeframe=x;const _=kt(),g=fa(_);let c=new Date,w=new Date;switch(x){case"today":c=g,w=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),_.getUTCDate(),23,59,59));break;case"yesterday":c=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),_.getUTCDate()-1)),w=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),_.getUTCDate()-1,23,59,59));break;case"monthToDate":c=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),1)),w=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),_.getUTCDate(),23,59,59));break;case"lastMonth":c=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth()-1,1)),w=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),0));break;case"custom":c=new Date(a.value.dateStart),w=new Date(a.value.dateEnd),isNaN(c.getTime())||isNaN(w.getTime())?Ve({message:"Invalid custom date range",color:"negative",icon:"warning"}):w<c&&Ve({message:"End date cannot be before start date",color:"negative",icon:"warning"});break}a.value.dateStart=Re(c),a.value.dateEnd=Re(w)},D=p(()=>{const x=qt(a.value.dateStart),_=qt(a.value.dateEnd);return t.activity.filter(g=>{var G,J,he;const c=new Date(g.createdAt),w=new Date(Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate())),O=w>=x&&w<=_,H=!((G=a.value.performerUserId)!=null&&G.length)||a.value.performerUserId.includes(g.performerUserId),Y=!((J=a.value.relatedUserId)!=null&&J.length)||a.value.relatedUserId.includes(g.relatedUserId),we=!((he=a.value.actions)!=null&&he.length)||a.value.actions.includes(g.action);return O&&H&&Y&&we})}),k=()=>{if(!u.value)return;const x=u.value.filteredSortedRows,_=[i.value.map(H=>wt(H.label))].concat(x.map(H=>i.value.map(Y=>wt(typeof Y.field=="function"?Y.field(H):H[Y.field===void 0?Y.name:Y.field])).join(","))).join(`\r
`),g=new Date,w=`User Activity ${`${g.getFullYear()}-${g.getMonth()+1}-${g.getDate()} ${g.getHours()}-${g.getMinutes()}-${g.getSeconds()}`}.csv`;ma(w,_,"text/csv")!==!0?Ve({message:"Browser denied file download...",color:"negative",icon:"warning"}):Ve({message:"File downloaded successfully...",color:"positive",icon:"download"})};return W(()=>n.selectedUser,()=>{a.value.performerUserId=[],a.value.relatedUserId=[],a.value.actions=[],a.value.term=""}),(x,_)=>(F(),z(te,null,{default:o(()=>[l(va,{ref_key:"tableRef",ref:u,rows:D.value,columns:i.value,"row-key":"activityId","rows-per-page-options":[-1],"visible-columns":m,filter:a.value.term,dense:"","hide-pagination":"","virtual-scroll":"",class:"header-table",style:{"min-height":"90vh",overflow:"auto",margin:"0.4rem"}},{top:o(g=>[l(B,{class:"text-h3"},{default:o(()=>[T(" Activity ")]),_:1}),l(Se),l(ae,{class:"bg-blue text-white q-ma-md"},{default:o(()=>[l(X,{icon:"priority_high"}),T(" Dates in UTC ")]),_:1}),l(I,{color:"primary",icon:"download",label:"Download",onClick:k}),l(I,{dense:"",icon:g.inFullscreen?"fullscreen_exit":"fullscreen",onClick:g.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"]),l(I,{dense:"",icon:v.value?"more_vert":"more_horiz",onClick:_[0]||(_[0]=c=>v.value=!v.value),class:"q-ml-md"},null,8,["icon"]),Cl(l(Ft,null,{default:o(()=>[l(te,{class:"col"},{default:o(()=>[l(Q,{class:"q-pa-md",style:{"background-color":"var(--primary-white)"}},{default:o(()=>[l(Ie,null,{default:o(()=>[T(" Summary ")]),_:1}),l(B,null,{default:o(()=>[ga,l(ae,{color:"orange-3"},{default:o(()=>{var c;return[T(P(((c=d.find(w=>w.value===a.value.timeframe))==null?void 0:c.label)||""),1)]}),_:1}),T("from "+P(a.value.dateStart)+" to "+P(a.value.dateEnd),1)]),_:1}),l(B,null,{default:o(()=>{var c;return[ya,(F(!0),ce(ve,null,pe([...new Set((c=u.value)==null?void 0:c.computedRows.map(w=>w.performerUserFullName))],(w,O)=>(F(),z(ae,{key:O},{default:o(()=>[T(P(w),1)]),_:2},1024))),128))]}),_:1}),l(B,null,{default:o(()=>{var c;return[_a,(F(!0),ce(ve,null,pe([...new Set((c=u.value)==null?void 0:c.computedRows.map(w=>w.relatedUserFullName).filter(Boolean))],(w,O)=>(F(),z(ae,{key:O},{default:o(()=>[T(P(w),1)]),_:2},1024))),128))]}),_:1}),l(B,null,{default:o(()=>{var c;return[Sa,(F(!0),ce(ve,null,pe([...new Set((c=u.value)==null?void 0:c.computedRows.map(w=>w.action))],(w,O)=>(F(),z(ae,{color:"blue-3",key:O},{default:o(()=>[T(P(w),1)]),_:2},1024))),128))]}),_:1}),l(B,null,{default:o(()=>{var c;return[pa,T(" "+P(((c=a.value.term)==null?void 0:c.length)>0?a.value.term:"None"),1)]}),_:1}),l(B,null,{default:o(()=>{var c;return[wa,T(" Showing "+P((c=u.value)==null?void 0:c.computedRowsNumber)+" of "+P(b(t).activity.length)+" Rows where ",1),l(ae,{color:"green-3"},{default:o(()=>[T(P(b(n).selectedUser.fullName),1)]),_:1}),T("was involved")]}),_:1})]),_:1})]),_:1})]),_:1},512),[[Tl,v.value]])]),"header-cell-rowNumber":o(g=>[l(re,{props:g},{default:o(()=>[l(ee,{size:"sm",name:"tag"})]),_:2},1032,["props"])]),"header-cell-date":o(g=>[l(re,{props:g},{default:o(()=>[l(ge,{dense:"",round:""},{label:o(()=>[l(X,{icon:"filter_list",size:"sm","text-color":"primary"}),T(" "+P(g.col.label),1)]),default:o(()=>[j("div",ha,[(F(),ce(ve,null,pe(d,c=>l(I,{key:c.value,outline:"",label:c.label,color:a.value.timeframe===c.value?"primary":"",onClick:w=>R(c.value)},null,8,["label","color","onClick"])),64))]),j("div",Ua,[l(E,{outlined:"",debounce:"300",modelValue:a.value.dateStart,"onUpdate:modelValue":_[1]||(_[1]=c=>a.value.dateStart=c),label:"Date Start",type:"date",disable:a.value.timeframe!=="custom"},null,8,["modelValue","disable"]),l(E,{outlined:"",debounce:"300",modelValue:a.value.dateEnd,"onUpdate:modelValue":_[2]||(_[2]=c=>a.value.dateEnd=c),label:"Date End",type:"date",disable:a.value.timeframe!=="custom"},null,8,["modelValue","disable"])])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-time":o(g=>[l(re,{props:g},{default:o(()=>[l(B,{style:{"font-size":"16px"}},{default:o(()=>[T(P(g.col.label),1)]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-performerUserFullName":o(g=>[l(re,{props:g},{default:o(()=>[l(ge,{dense:"",round:""},{label:o(()=>[l(X,{icon:"filter_list",size:"sm","text-color":a.value.performerUserId&&a.value.performerUserId.length>0?"primary":""},null,8,["text-color"]),T(" "+P(g.col.label),1)]),default:o(()=>[l($e,{style:{width:"256px"}},{default:o(()=>[l(Se),l(I,{dense:"",label:"Clear",onClick:_[3]||(_[3]=c=>a.value.performerUserId=[])})]),_:1}),l(We,{modelValue:a.value.performerUserId,"onUpdate:modelValue":_[4]||(_[4]=c=>a.value.performerUserId=c),options:V.value,type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-relatedUserFullName":o(g=>[l(re,{props:g},{default:o(()=>[l(ge,{dense:"",round:""},{label:o(()=>[l(X,{icon:"filter_list",size:"sm","text-color":a.value.relatedUserId&&a.value.relatedUserId.length>0?"primary":""},null,8,["text-color"]),T(" "+P(g.col.label),1)]),default:o(()=>[l($e,{style:{width:"256px"}},{default:o(()=>[l(Se),l(I,{dense:"",label:"Clear",onClick:_[5]||(_[5]=c=>a.value.relatedUserId=[])})]),_:1}),l(We,{modelValue:a.value.relatedUserId,"onUpdate:modelValue":_[6]||(_[6]=c=>a.value.relatedUserId=c),options:N.value,type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-action":o(g=>[l(re,{props:g},{default:o(()=>[l(ge,{dense:"",round:""},{label:o(()=>[l(X,{icon:"filter_list",size:"sm","text-color":a.value.actions&&a.value.actions.length>0?"primary":""},null,8,["text-color"]),T(" "+P(g.col.label),1)]),default:o(()=>[l($e,null,{default:o(()=>[l(Se),l(I,{dense:"",label:"Clear",onClick:_[7]||(_[7]=c=>a.value.actions=[])})]),_:1}),l(We,{modelValue:a.value.actions,"onUpdate:modelValue":_[8]||(_[8]=c=>a.value.actions=c),options:U.value.map(c=>({label:c,value:c})),type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-description":o(g=>[l(re,{props:g},{default:o(()=>[l(ge,{dense:"",round:""},{label:o(()=>[l(X,{icon:"search",size:"sm","text-color":a.value.term!==""?"primary":""},null,8,["text-color"]),T(" "+P(g.col.label),1)]),default:o(()=>[j("div",Ca,[l(E,{outlined:"",dense:"",debounce:"300",modelValue:a.value.term,"onUpdate:modelValue":_[10]||(_[10]=c=>a.value.term=c),type:"search",placeholder:"Description search\u2026",style:{"align-self":"center"}},{append:o(()=>[l(ee,{name:a.value.term?"close":"search",class:Xe({"cursor-pointer":a.value.term}),onClick:_[9]||(_[9]=c=>a.value.term?a.value.term="":null)},null,8,["name","class"])]),_:1},8,["modelValue"])])]),_:2},1024)]),_:2},1032,["props"])]),body:o(g=>[l(Ol,{props:g},{default:o(()=>[l(se,{class:"text-grey"},{default:o(()=>[T(P(g.rowIndex+1),1)]),_:2},1024),l(se,{key:"date",props:g},{default:o(()=>[T(P(g.row.date),1)]),_:2},1032,["props"]),l(se,{key:"time",props:g},{default:o(()=>[T(P(g.row.time),1)]),_:2},1032,["props"]),l(se,{key:"performerUserFullName",props:g},{default:o(()=>[T(P(g.row.performerUserFullName),1)]),_:2},1032,["props"]),l(se,{key:"relatedUserFullName",props:g},{default:o(()=>[j("span",{class:Xe({"text-grey":!g.row.relatedUserFullName})},P(g.row.relatedUserFullName||"No one"),3)]),_:2},1032,["props"]),l(se,{key:"action",props:g},{default:o(()=>{var c;return[l(ae,{"text-color":"white",color:((c=b(t).activityActions.find(w=>w.action===g.row.action))==null?void 0:c.color)||"grey"},{default:o(()=>{var w,O;return[l(X,{size:"sm","text-color":"white",icon:((w=b(t).activityActions.find(H=>H.action===g.row.action))==null?void 0:w.icon)||"question_mark",color:((O=b(t).activityActions.find(H=>H.action===g.row.action))==null?void 0:O.color)||"grey"},null,8,["icon","color"]),T(" "+P(g.row.action),1)]}),_:2},1032,["color"])]}),_:2},1032,["props"]),l(se,{key:"description",props:g},{default:o(()=>[T(P(g.row.description),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])]),_:1}))}});var ka=Dt(Ta,[["__scopeId","data-v-272258b2"]]);const qa=ne({__name:"UsersSearch",setup(e){const t=le();return(n,u)=>(F(),z(E,{modelValue:b(t).searchTerm,"onUpdate:modelValue":u[1]||(u[1]=i=>b(t).searchTerm=i),type:"search",placeholder:"Search\u2026",filled:""},{append:o(()=>[l(ee,{name:b(t).searchTerm?"close":"search",class:Xe({"cursor-pointer":b(t).searchTerm}),onClick:u[0]||(u[0]=i=>b(t).searchTerm?b(t).searchTerm="":null)},null,8,["name","class"])]),_:1},8,["modelValue"]))}}),xa={class:"row items-start"},Pa={style:{width:"300px"}},Da={class:"col"},Ba=ne({__name:"UsersPage",setup(e){const t=le(),n=Fe(),u=M(!0);return tt(()=>{n.readSettings(),t.readAllUsers()}),(i,m)=>(F(),ce(ve,null,[l(Dl),l(Vl),l(et,{modelValue:u.value,"onUpdate:modelValue":m[0]||(m[0]=s=>u.value=s),side:"left",width:320,class:"row"},{default:o(()=>[l(bt,{class:"q-pa-md",style:Vt({backgroundColor:"var(--primary-light)"})},{default:o(()=>[l(qa)]),_:1},8,["style"]),l(Al)]),_:1},8,["modelValue"]),l(xl,{class:"row-container"},{default:o(()=>[l(bt,null,{default:o(()=>[l(Ft,null,{default:o(()=>[u.value?(F(),z(I,{key:1,onClick:m[2]||(m[2]=s=>u.value=!u.value),icon:"menu"})):(F(),z(I,{key:0,onClick:m[1]||(m[1]=s=>u.value=!u.value),icon:"menu"})),l(Ie,null,{default:o(()=>[T("Users \xBB "+P(b(t).selectedUser.givenName)+" "+P(b(t).selectedUser.surname),1)]),_:1}),l($e,null,{default:o(()=>[l(I,{icon:b(t).createMode?"close":"add",label:b(t).createMode?"Cancel Create":"Create User",onClick:m[3]||(m[3]=s=>{(b(t).createMode=!b(t).createMode)&&(b(t).editMode=!1)})},null,8,["icon","label"]),l(I,{icon:b(t).editMode?"close":"edit",label:b(t).editMode?"Cancel Edit":"Edit User",onClick:m[4]||(m[4]=s=>{(b(t).editMode=!b(t).editMode)&&(b(t).createMode=!1)})},null,8,["icon","label"])]),_:1})]),_:1})]),_:1}),j("div",xa,[j("div",Pa,[l(Il)]),j("div",Da,[l(ka)])])]),_:1})],64))}});export{Ba as default};
