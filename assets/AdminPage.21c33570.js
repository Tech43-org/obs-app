import{Q as ue}from"./QPage.cf5438ca.js";import{L as Z,e as ee,a as ce,y as k,h as N,w as me,F as v,G as S,H as l,I as e,Q as n,a5 as U,U as y,a0 as fe,a3 as ve,R as i,M as F,O as Q,N as V,P as D,a4 as G,K as f,aR as H,_ as pe,aS as K,aT as A,a1 as be,a2 as ge,T as Ue}from"./index.6cbc1c32.js";import{n as W,s as ye,d as M,I as J,Q as _,a as z,b as _e,c as w,e as we,f as he,g as Ce,h as Te}from"./utils.2039f302.js";import{c as b}from"./QList.f87a6b82.js";import{Q as R,d as h,a as I}from"./QSeparator.902ea310.js";import{a as De,Q as Ie}from"./QToolbar.9858aa28.js";import{Q as X,b as Se,c as O,a as Y}from"./QCardActions.fdb521cd.js";import"./QCheckbox.675d2b2a.js";import"./QBtnGroup.95ab99ad.js";const C=T=>(be("data-v-b914e098"),T=T(),ge(),T),xe=C(()=>f("span",{style:{"font-weight":"bold"}},"Timeframe:",-1)),ke=C(()=>f("span",{style:{"font-weight":"bold"}},"Performer Users:",-1)),Ne=C(()=>f("span",{style:{"font-weight":"bold"}},"Related Users:",-1)),Fe=C(()=>f("span",{style:{"font-weight":"bold"}},"Actions:",-1)),Qe=C(()=>f("span",{style:{"font-weight":"bold"}},"Decription Filter:",-1)),Ve=C(()=>f("span",{style:{"font-weight":"bold"}},"Size:",-1)),Ae={class:"q-ma-md column",style:{gap:"0.6rem"}},Me={class:"q-ma-md column",style:{gap:"0.6rem"}},Re={class:"q-mx-md"},$e=Z({__name:"AdminActivityTable",setup(T){const c=ee(),$=ce(),p=k(null),E=k([{name:"rowNumber",label:"rowNumber",align:"right",field:"",sortable:!1},{name:"activityId",label:"ID",align:"left",field:"activityId",sortable:!1},{name:"date",label:"Date",align:"left",field:"date",sortable:!1},{name:"time",label:"Time",align:"left",field:"time",sortable:!1},{name:"performerUserFullName",label:"Performer User",align:"left",field:"performerUserFullName",sortable:!1},{name:"relatedUserFullName",label:"Related User",align:"left",field:"relatedUserFullName",sortable:!1},{name:"action",label:"Action",align:"left",field:"action",sortable:!1},{name:"description",label:"Description",align:"left",field:"description",sortable:!1}]),te=["rowNumber","date","time","performerUserFullName","relatedUserFullName","action","description"],q=W(),ae=ye(q),B=[{value:"today",label:"Today"},{value:"yesterday",label:"Yesterday"},{value:"monthToDate",label:"Month to Date"},{value:"lastMonth",label:"Last Month"},{value:"custom",label:"Custom"}],x=k(!1),o=k({term:"",timeframe:"monthToDate",dateStart:M(ae),dateEnd:M(q),searchColumns:["description"],performerUserId:[],relatedUserId:[],actions:[]}),le=N(()=>[...new Set(c.activity.map(d=>d.action))]),oe=N(()=>c.activity.map(d=>({value:d.performerUserId,label:d.performerUserFullName})).filter((d,r,a)=>r===a.findIndex(t=>t.label===d.label&&t.value===d.value))),re=N(()=>c.activity.map(d=>({value:d.relatedUserId,label:d.relatedUserFullName})).filter((d,r,a)=>r===a.findIndex(t=>t.label===d.label&&t.value===d.value))),se=d=>{o.value.timeframe=d;const r=W(),a=Ce(r);let t=new Date,s=new Date;switch(d){case"today":t=a,s=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),23,59,59));break;case"yesterday":t=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate()-1)),s=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate()-1,23,59,59));break;case"monthToDate":t=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),1)),s=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),23,59,59));break;case"lastMonth":t=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth()-1,1)),s=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),0));break;case"custom":t=new Date(o.value.dateStart),s=new Date(o.value.dateEnd),isNaN(t.getTime())||isNaN(s.getTime())?A({message:"Invalid custom date range",color:"negative",icon:"warning"}):s<t&&A({message:"End date cannot be before start date",color:"negative",icon:"warning"});break}o.value.dateStart=M(t),o.value.dateEnd=M(s)},ne=N(()=>{const d=J(o.value.dateStart),r=J(o.value.dateEnd);return c.activity.filter(a=>{var P,L,j;const t=new Date(a.createdAt),s=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())),u=s>=d&&s<=r,m=!((P=o.value.performerUserId)!=null&&P.length)||o.value.performerUserId.includes(a.performerUserId),g=!((L=o.value.relatedUserId)!=null&&L.length)||o.value.relatedUserId.includes(a.relatedUserId),de=!((j=o.value.actions)!=null&&j.length)||o.value.actions.includes(a.action);return u&&m&&g&&de})}),ie=()=>{if(!p.value)return;const d=p.value.filteredSortedRows,r=[E.value.map(m=>K(m.label))].concat(d.map(m=>E.value.map(g=>K(typeof g.field=="function"?g.field(m):m[g.field===void 0?g.name:g.field])).join(","))).join(`\r
`),a=new Date,s=`User Activity ${`${a.getFullYear()}-${a.getMonth()+1}-${a.getDate()} ${a.getHours()}-${a.getMinutes()}-${a.getSeconds()}`}.csv`;he(s,r,"text/csv")!==!0?A({message:"Browser denied file download...",color:"negative",icon:"warning"}):A({message:"File downloaded successfully...",color:"positive",icon:"download"})};return me(()=>$.selectedUser,()=>{o.value.performerUserId=[],o.value.relatedUserId=[],o.value.actions=[],o.value.term=""}),(d,r)=>(v(),S(X,null,{default:l(()=>[e(we,{ref_key:"tableRef",ref:p,rows:ne.value,columns:E.value,"row-key":"activityId","rows-per-page-options":[-1],"visible-columns":te,filter:o.value.term,dense:"","hide-pagination":"","virtual-scroll":"",class:"header-table",style:{"min-height":"90vh",overflow:"auto",margin:"0.4rem"}},{top:l(a=>[e(b,{class:"text-h3"},{default:l(()=>[n(" Admin Activity ")]),_:1}),e(R),e(h,{class:"bg-blue text-white q-ma-md"},{default:l(()=>[e(U,{icon:"priority_high"}),n(" Dates in UTC ")]),_:1}),e(y,{color:"primary",icon:"download",label:"Download",onClick:ie}),e(y,{dense:"",icon:a.inFullscreen?"fullscreen_exit":"fullscreen",onClick:a.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"]),e(y,{dense:"",icon:x.value?"more_vert":"more_horiz",onClick:r[0]||(r[0]=t=>x.value=!x.value),class:"q-ml-md"},null,8,["icon"]),fe(e(De,null,{default:l(()=>[e(X,{class:"col"},{default:l(()=>[e(Se,{class:"q-pa-md",style:{"background-color":"var(--primary-white)"}},{default:l(()=>[e(Ie,null,{default:l(()=>[n(" Summary ")]),_:1}),e(b,null,{default:l(()=>[xe,e(h,{color:"orange-3"},{default:l(()=>{var t;return[n(i(((t=B.find(s=>s.value===o.value.timeframe))==null?void 0:t.label)||""),1)]}),_:1}),n("from "+i(o.value.dateStart)+" to "+i(o.value.dateEnd),1)]),_:1}),e(b,null,{default:l(()=>{var t;return[ke,(v(!0),F(V,null,Q([...new Set((t=p.value)==null?void 0:t.computedRows.map(s=>s.performerUserFullName))],(s,u)=>(v(),S(h,{key:u},{default:l(()=>[n(i(s),1)]),_:2},1024))),128))]}),_:1}),e(b,null,{default:l(()=>{var t;return[Ne,(v(!0),F(V,null,Q([...new Set((t=p.value)==null?void 0:t.computedRows.map(s=>s.relatedUserFullName).filter(Boolean))],(s,u)=>(v(),S(h,{key:u},{default:l(()=>[n(i(s),1)]),_:2},1024))),128))]}),_:1}),e(b,null,{default:l(()=>{var t;return[Fe,(v(!0),F(V,null,Q([...new Set((t=p.value)==null?void 0:t.computedRows.map(s=>s.action))],(s,u)=>(v(),S(h,{color:"blue-3",key:u},{default:l(()=>[n(i(s),1)]),_:2},1024))),128))]}),_:1}),e(b,null,{default:l(()=>{var t;return[Qe,n(" "+i(((t=o.value.term)==null?void 0:t.length)>0?o.value.term:"None"),1)]}),_:1}),e(b,null,{default:l(()=>{var t;return[Ve,n(" Showing "+i((t=p.value)==null?void 0:t.computedRowsNumber)+" of "+i(D(c).activity.length)+" Rows where ",1),e(h,{color:"green-3"},{default:l(()=>[n(i(D($).selectedUser.fullName),1)]),_:1}),n("was involved")]}),_:1})]),_:1})]),_:1})]),_:1},512),[[ve,x.value]])]),"header-cell-rowNumber":l(a=>[e(_,{props:a},{default:l(()=>[e(G,{size:"sm",name:"tag"})]),_:2},1032,["props"])]),"header-cell-date":l(a=>[e(_,{props:a},{default:l(()=>[e(I,{dense:"",round:""},{label:l(()=>[e(U,{icon:"filter_list",size:"sm","text-color":"primary"}),n(" "+i(a.col.label),1)]),default:l(()=>[f("div",Ae,[(v(),F(V,null,Q(B,t=>e(y,{key:t.value,outline:"",label:t.label,color:o.value.timeframe===t.value?"primary":"",onClick:s=>se(t.value)},null,8,["label","color","onClick"])),64))]),f("div",Me,[e(O,{outlined:"",debounce:"300",modelValue:o.value.dateStart,"onUpdate:modelValue":r[1]||(r[1]=t=>o.value.dateStart=t),label:"Date Start",type:"date",disable:o.value.timeframe!=="custom"},null,8,["modelValue","disable"]),e(O,{outlined:"",debounce:"300",modelValue:o.value.dateEnd,"onUpdate:modelValue":r[2]||(r[2]=t=>o.value.dateEnd=t),label:"Date End",type:"date",disable:o.value.timeframe!=="custom"},null,8,["modelValue","disable"])])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-time":l(a=>[e(_,{props:a},{default:l(()=>[e(b,{style:{"font-size":"16px"}},{default:l(()=>[n(i(a.col.label),1)]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-performerUserFullName":l(a=>[e(_,{props:a},{default:l(()=>[e(I,{dense:"",round:""},{label:l(()=>[e(U,{icon:"filter_list",size:"sm","text-color":o.value.performerUserId&&o.value.performerUserId.length>0?"primary":""},null,8,["text-color"]),n(" "+i(a.col.label),1)]),default:l(()=>[e(Y,{style:{width:"256px"}},{default:l(()=>[e(R),e(y,{dense:"",label:"Clear",onClick:r[3]||(r[3]=t=>o.value.performerUserId=[])})]),_:1}),e(z,{modelValue:o.value.performerUserId,"onUpdate:modelValue":r[4]||(r[4]=t=>o.value.performerUserId=t),options:oe.value,type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-relatedUserFullName":l(a=>[e(_,{props:a},{default:l(()=>[e(I,{dense:"",round:""},{label:l(()=>[e(U,{icon:"filter_list",size:"sm","text-color":o.value.relatedUserId&&o.value.relatedUserId.length>0?"primary":""},null,8,["text-color"]),n(" "+i(a.col.label),1)]),default:l(()=>[e(Y,{style:{width:"256px"}},{default:l(()=>[e(R),e(y,{dense:"",label:"Clear",onClick:r[5]||(r[5]=t=>o.value.relatedUserId=[])})]),_:1}),e(z,{modelValue:o.value.relatedUserId,"onUpdate:modelValue":r[6]||(r[6]=t=>o.value.relatedUserId=t),options:re.value,type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-action":l(a=>[e(_,{props:a},{default:l(()=>[e(I,{dense:"",round:""},{label:l(()=>[e(U,{icon:"filter_list",size:"sm","text-color":o.value.actions&&o.value.actions.length>0?"primary":""},null,8,["text-color"]),n(" "+i(a.col.label),1)]),default:l(()=>[e(Y,{style:{width:"192px"}},{default:l(()=>[e(R),e(y,{dense:"",label:"Clear",onClick:r[7]||(r[7]=t=>o.value.actions=[])})]),_:1}),e(z,{modelValue:o.value.actions,"onUpdate:modelValue":r[8]||(r[8]=t=>o.value.actions=t),options:le.value.map(t=>({label:t,value:t})),type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-description":l(a=>[e(_,{props:a},{default:l(()=>[e(I,{dense:"",round:""},{label:l(()=>[e(U,{icon:"search",size:"sm","text-color":o.value.term!==""?"primary":""},null,8,["text-color"]),n(" "+i(a.col.label),1)]),default:l(()=>[f("div",Re,[e(O,{outlined:"",dense:"",debounce:"300",modelValue:o.value.term,"onUpdate:modelValue":r[10]||(r[10]=t=>o.value.term=t),type:"search",placeholder:"Description search\u2026",style:{"align-self":"center"}},{append:l(()=>[e(G,{name:o.value.term?"close":"search",class:H({"cursor-pointer":o.value.term}),onClick:r[9]||(r[9]=t=>o.value.term?o.value.term="":null)},null,8,["name","class"])]),_:1},8,["modelValue"])])]),_:2},1024)]),_:2},1032,["props"])]),body:l(a=>[e(_e,{props:a},{default:l(()=>[e(w,{class:"text-grey"},{default:l(()=>[n(i(a.rowIndex+1),1)]),_:2},1024),e(w,{key:"date",props:a},{default:l(()=>[n(i(a.row.date),1)]),_:2},1032,["props"]),e(w,{key:"time",props:a},{default:l(()=>[n(i(a.row.time),1)]),_:2},1032,["props"]),e(w,{key:"performerUserFullName",props:a},{default:l(()=>[n(i(a.row.performerUserFullName),1)]),_:2},1032,["props"]),e(w,{key:"relatedUserFullName",props:a},{default:l(()=>[f("span",{class:H({"text-grey":!a.row.relatedUserFullName})},i(a.row.relatedUserFullName||"No one"),3)]),_:2},1032,["props"]),e(w,{key:"action",props:a},{default:l(()=>{var t;return[e(h,{"text-color":"white",color:((t=D(c).activityActions.find(s=>s.action===a.row.action))==null?void 0:t.color)||"grey"},{default:l(()=>{var s,u;return[e(U,{size:"sm","text-color":"white",icon:((s=D(c).activityActions.find(m=>m.action===a.row.action))==null?void 0:s.icon)||"question_mark",color:((u=D(c).activityActions.find(m=>m.action===a.row.action))==null?void 0:u.color)||"grey"},null,8,["icon","color"]),n(" "+i(a.row.action),1)]}),_:2},1032,["color"])]}),_:2},1032,["props"]),e(w,{key:"description",props:a},{default:l(()=>[n(i(a.row.description),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])]),_:1}))}});var Ee=pe($e,[["__scopeId","data-v-b914e098"]]);const He=Z({__name:"AdminPage",setup(T){const c=ee();return Ue(()=>{c.readActivity(Te.value)}),($,p)=>(v(),S(ue,null,{default:l(()=>[e(Ee)]),_:1}))}});export{He as default};
