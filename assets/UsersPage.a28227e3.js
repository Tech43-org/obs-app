import{Q as ul,a as vt}from"./QBadge.5603394d.js";import{i as We,d as je,b as mt,Q as ge,e as He,u as il,j as dl,k as kt,h as cl,a as me,f as Le}from"./QSeparator.c7bf548b.js";import{L as le,a as ae,u as De,y as O,w as H,F as B,G as L,H as o,P as b,I as l,Q as x,U as F,a4 as K,R as V,K as ee,aN as ft,h as p,aO as vl,e as qt,M as Je,O as Tt,N as Ke,_ as xt,aP as J,aQ as Pt,aR as ml,f as oe,j as g,k as de,Z as fl,l as ce,T as Ze,o as Dt,ad as bl,ac as gl,q as Vt,s as yl,t as bt,D as Nt,ao as _l,am as Sl,aq as pl,ap as gt,aS as Ye,aT as yt,aU as wl,J as Rt,aV as hl,aa as fe,a0 as Cl,a3 as Ul,aW as Ge,aX as _t,aY as ke}from"./index.9129b366.js";import{Q as Ve,a as $t}from"./QToolbar.be4cd49a.js";import{b as z,c as M,Q as Z,q as Qe,a as xe}from"./QToggle.e0a28452.js";import{Q as kl}from"./QPage.aaa69243.js";import{c as j,a as Xe,b as te,Q as At,u as et,d as tt}from"./QList.72c9e931.js";import"./QResizeObserver.7a97c980.js";import"./QBtnGroup.ebf28432.js";const ql=ee("br",null,null,-1),Tl=le({__name:"UserCreateDrawer",setup(e){const t=ae(),n=De(),u=O({subject:"",body:""});H(()=>({givenName:t.user.givenName,surname:t.user.surname}),c=>{u.value.subject=`Onboarding ${c.givenName} ${c.surname}`,u.value.body=`Please add ${c.givenName} to the Active Directory.
Name: ${c.givenName}
Surname: ${c.surname}

Thanks

This email has been sent from FileMaker by ${n.user.fullName}`},{immediate:!0});const d=()=>{t.user={givenName:"",surname:"",status:"Pending",groupId:null}};return(c,s)=>(B(),L(We,{modelValue:b(t).createMode,"onUpdate:modelValue":s[5]||(s[5]=v=>b(t).createMode=v),onBeforeShow:s[6]||(s[6]=v=>d()),width:384,bordered:"",overlay:"",side:"right"},{default:o(()=>[l(Z,null,{default:o(()=>[l(z,null,{default:o(()=>[l(Ve,null,{default:o(()=>[x(" Create User ")]),_:1}),l(j,{class:"text-body2"},{default:o(()=>[x(" A new User will be created and, an email request to add him/her to Active Directory will be send ")]),_:1}),ql,l(F,{dense:"",label:"Create User and Send Request",icon:"person_add",color:"primary",onClick:s[0]||(s[0]=v=>b(t).createUser(u.value)),disable:!b(t).user.givenName||!b(t).user.surname},null,8,["disable"])]),_:1}),l(z,null,{default:o(()=>[l(M,{modelValue:b(t).user.givenName,"onUpdate:modelValue":s[1]||(s[1]=v=>b(t).user.givenName=v),label:"Name",rules:[v=>!!v||"Name is required"]},null,8,["modelValue","rules"]),l(M,{modelValue:b(t).user.surname,"onUpdate:modelValue":s[2]||(s[2]=v=>b(t).user.surname=v),label:"Surname",rules:[v=>!!v||"Surname is required"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(Z,{class:"bg-blue-2"},{default:o(()=>[l(z,null,{default:o(()=>[l(Xe,{style:{"background-color":"hsl(200, 50%, 90%)"}},{default:o(()=>[l(te,{avatar:""},{default:o(()=>[l(K,{name:"mail"})]),_:1}),l(te,null,{default:o(()=>[x(V(b(n).bookingsSupportEmail),1)]),_:1})]),_:1}),l(M,{modelValue:u.value.subject,"onUpdate:modelValue":s[3]||(s[3]=v=>u.value.subject=v),label:"Subject"},null,8,["modelValue"]),l(M,{modelValue:u.value.body,"onUpdate:modelValue":s[4]||(s[4]=v=>u.value.body=v),label:"Body",type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),xl=le({__name:"UserUpdateDrawer",setup(e){const t=ae(),n=De(),u=O({subject:"",body:""}),d=O(320),c=()=>{t.user=JSON.parse(JSON.stringify(t.selectedUser))},s=()=>{if(t.selectedUser.status!=="Inactive"&&t.user.status==="Inactive"){t.user.groupId=null;const v=t.user.email;t.user.email=null,d.value=720,u.value.subject=`Deauthorize ${t.user.givenName} ${t.user.surname}`,u.value.body=`Please remove ${t.user.givenName} from the Active Directory.
Name: ${t.user.givenName}
Surname: ${t.user.surname}
Email: ${v}
 
Thanks
 
This email has been sent from FileMaker by ${n.user.fullName}`}else d.value=320};return(v,i)=>(B(),L(We,{modelValue:b(t).editMode,"onUpdate:modelValue":i[11]||(i[11]=r=>b(t).editMode=r),onBeforeShow:i[12]||(i[12]=r=>c()),onBeforeHide:i[13]||(i[13]=r=>d.value=320),width:d.value,bordered:"",overlay:"",side:"right",class:"row"},{default:o(()=>[l(Z,{class:"col"},{default:o(()=>[l(z,{horizontal:""},{default:o(()=>[l(Ve,null,{default:o(()=>[x(" Edit User ")]),_:1}),l(F,{dense:"",label:"Save Changes",icon:"save",color:"primary",onClick:i[0]||(i[0]=r=>b(t).updateUser(u.value)),disable:b(t).user.status==="Active"&&!b(t).user.groupId},null,8,["disable"])]),_:1}),l(z,null,{default:o(()=>[l(M,{modelValue:b(t).user.givenName,"onUpdate:modelValue":i[1]||(i[1]=r=>b(t).user.givenName=r),label:"Name"},null,8,["modelValue"]),l(M,{modelValue:b(t).user.surname,"onUpdate:modelValue":i[2]||(i[2]=r=>b(t).user.surname=r),label:"Surname"},null,8,["modelValue"]),l(M,{modelValue:b(t).user.loginName,"onUpdate:modelValue":i[3]||(i[3]=r=>b(t).user.loginName=r),label:"Login"},null,8,["modelValue"]),l(M,{modelValue:b(t).user.email,"onUpdate:modelValue":i[4]||(i[4]=r=>b(t).user.email=r),label:"Email",type:"email",rules:[r=>!r||/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(r)||"Invalid email"]},null,8,["modelValue","rules"]),l(M,{modelValue:b(t).user.note,"onUpdate:modelValue":i[5]||(i[5]=r=>b(t).user.note=r),label:"Note",type:"textarea"},null,8,["modelValue"])]),_:1}),l(z,{style:{"background-color":"rgb(197, 198, 198)","border-radius":"4%"}},{default:o(()=>[l(je,{modelValue:b(t).user.status,"onUpdate:modelValue":[i[6]||(i[6]=r=>b(t).user.status=r),i[7]||(i[7]=r=>s())],label:"Status",options:b(t).statusOptions},null,8,["modelValue","options"]),l(je,{modelValue:b(t).user.groupId,"onUpdate:modelValue":i[8]||(i[8]=r=>b(t).user.groupId=r),"emit-value":"","map-options":"",label:"Group",clearable:"",disable:b(t).user.status!=="Active",options:b(n).groupsOptions},null,8,["modelValue","disable","options"])]),_:1}),b(t).user.status==="Active"&&(b(t).user.groupId===null||b(t).user.groupId==="")?(B(),L(z,{key:0},{default:o(()=>[l(mt,{class:"bg-orange text-white",rounded:""},{avatar:o(()=>[l(K,{name:"warning"})]),default:o(()=>[x(" Select a Group before saving changes ")]),_:1})]),_:1})):ft("",!0)]),_:1}),b(t).selectedUser.status!=="Inactive"&&b(t).user.status==="Inactive"?(B(),L(Z,{key:0,class:"col"},{default:o(()=>[l(z,null,{default:o(()=>[l(mt,{class:"bg-red text-white",rounded:""},{avatar:o(()=>[l(K,{name:"warning"})]),default:o(()=>[x(" You are going to inactivate this user, the email and the group associated will be removed and an email to unauthorized the user will be sent. ")]),_:1})]),_:1}),l(Z,{class:"bg-blue-2"},{default:o(()=>[l(z,null,{default:o(()=>[l(Xe,{style:{"background-color":"hsl(200, 50%, 90%)"}},{default:o(()=>[l(te,{avatar:""},{default:o(()=>[l(K,{name:"mail"})]),_:1}),l(te,null,{default:o(()=>[x(V(b(n).bookingsSupportEmail),1)]),_:1})]),_:1}),l(M,{modelValue:u.value.subject,"onUpdate:modelValue":i[9]||(i[9]=r=>u.value.subject=r),label:"Subject"},null,8,["modelValue"]),l(M,{modelValue:u.value.body,"onUpdate:modelValue":i[10]||(i[10]=r=>u.value.body=r),label:"Body",type:"textarea",autogrow:"",hint:"The email can be personalized before sending it."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):ft("",!0)]),_:1},8,["modelValue","width"]))}}),Pl=[{label:"Activity ID",value:"activityId",table:"z_ACT_Activity",field:"_kplt_Activity",type:"text",sql:"act"},{label:"Created At",value:"createdAt",table:"z_ACT_Activity",field:"CreatedAtUnix",type:"number",sql:"act"},{label:"Performer User ID",value:"performerUserId",table:"z_ACT_Activity",field:"_kflt_User_Performer",type:"text",sql:"act"},{label:"Performer User Name",value:"performerUserName",table:"z_CD_USE_Users",field:"Name",type:"text",sql:"use1"},{label:"Performer User Surname",value:"performerUserSurname",table:"z_CD_USE_Users",field:"Surname",type:"text",sql:"use1"},{label:"Related User ID",value:"relatedUserId",table:"z_ACT_Activity",field:"_kflt_User_Related",type:"text",sql:"act"},{label:"Related User Name",value:"relatedUserName",table:"z_CD_USE_Users",field:"Name",type:"text",sql:"use2"},{label:"Related User Surname",value:"relatedUserSurname",table:"z_CD_USE_Users",field:"Surname",type:"text",sql:"use2"},{label:"Action",value:"action",table:"z_ACT_Activity",field:"Action",type:"text",sql:"act"},{label:"Description",value:"description",table:"z_ACT_Activity",field:"Description",type:"text",sql:"act"},{label:"Note",value:"note",table:"z_ACT_Activity",field:"Note",type:"text",sql:"act"}],Pe=p(()=>vl(Pl));p(()=>O("SELECT "+Pe.value.map(t=>t)+" FROM z_ACT_Activity AS act").value);const Dl=p(()=>{const e=ae(),t=O("SELECT "+Pe.value.map(n=>n)+" FROM z_ACT_Activity AS act");return Pe.value.some(n=>n.indexOf("use1.")!==-1)&&(t.value+=' LEFT OUTER JOIN z_CD_USE_Users AS use1 ON use1."_kplt_User" = act."_kflt_User_Performer" '),Pe.value.some(n=>n.indexOf("use2.")!==-1)&&(t.value+=' LEFT OUTER JOIN z_CD_USE_Users AS use2 ON use2."_kplt_User" = act."_kflt_User_Related" '),t.value+=` WHERE act."_kflt_User_Performer" ='${e.selectedUser.userId}' OR act."_kflt_User_Related" ='${e.selectedUser.userId}'`,t.value});const Vl=le({__name:"UsersList",setup(e){const t=ae(),n=qt(),u=d=>{t.selectedUser=d,t.editMode=!1,t.createMode=!1,n.readActivity(Dl.value)};return(d,c)=>(B(),L(Z,{style:{width:"100%"}},{default:o(()=>[l(At,{style:{"margin-top":"76px"}},{default:o(()=>[(B(!0),Je(Ke,null,Tt(b(t).filterUsers,s=>(B(),L(Xe,{key:s.userId,clickable:"",onClick:v=>u(s),class:"bg-grey-2 menu",active:b(t).selectedUser===s,"active-class":"menu-active"},{default:o(()=>[l(te,{avatar:""},{default:o(()=>[l(J,{style:Pt({backgroundColor:s.color}),class:"text-white"},{default:o(()=>[x(V(s.initials),1)]),_:2},1032,["style"])]),_:2},1024),l(te,null,{default:o(()=>[l(j,{class:"text-h4"},{default:o(()=>[x(V(s.givenName),1)]),_:2},1024),l(j,{class:"text-h5"},{default:o(()=>[x(V(s.surname),1)]),_:2},1024)]),_:2},1024),l(te,{side:"",top:""},{default:o(()=>[l(ul,{rounded:"",color:s.status==="Active"?"green":s.status==="Pending"?"orange":"grey"},null,8,["color"])]),_:2},1024)]),_:2},1032,["onClick","active"]))),128))]),_:1})]),_:1}))}});var Nl=xt(Vl,[["__scopeId","data-v-d8b8b4e8"]]);const Rl=le({__name:"UserAvatar",setup(e){const t=ae();return(n,u)=>(B(),L(J,ml({style:{backgroundColor:b(t).selectedUser.color},class:"text-white"},n.$attrs),{default:o(()=>[x(V(b(t).selectedUser.initials),1)]),_:1},16,["style"]))}}),$l=le({__name:"UserInfoCard",setup(e){const t=ae(),n=De();return(u,d)=>(B(),L(Z,{style:{width:"16rem"}},{default:o(()=>[l(z,{class:"row"},{default:o(()=>[l(ge),l(He,{dark:"",size:"md",label:b(t).selectedUser.status,color:b(t).selectedUser.status==="Active"?"green":b(t).selectedUser.status==="Pending"?"orange":"grey"},null,8,["label","color"])]),_:1}),l(z,{class:"column items-center q-pa-none"},{default:o(()=>[l(Rl,{size:"100px"})]),_:1}),l(z,null,{default:o(()=>[l(j,{class:"text-h3 text-center"},{default:o(()=>{var c;return[x(V((c=b(t).selectedUser)==null?void 0:c.givenName),1)]}),_:1}),l(j,{class:"text-h4 text-center"},{default:o(()=>{var c;return[x(V((c=b(t).selectedUser)==null?void 0:c.surname),1)]}),_:1})]),_:1}),l(z,{class:"bg-blue-2"},{default:o(()=>[l(te,{avatar:""},{default:o(()=>[l(j,null,{default:o(()=>[x("Group")]),_:1}),l(j,{class:"text-h4"},{default:o(()=>[x(V(b(t).selectedUser.groupId?b(n).groups[b(t).selectedUser.groupId].name:"No Group"),1)]),_:1})]),_:1})]),_:1})]),_:1}))}});var X=oe({name:"QTh",props:{props:Object,autoWidth:Boolean},emits:["click"],setup(e,{slots:t,emit:n}){const u=ce(),{proxy:{$q:d}}=u,c=s=>{n("click",s)};return()=>{if(e.props===void 0)return g("th",{class:e.autoWidth===!0?"q-table--col-auto-width":"",onClick:c},de(t.default));let s,v;const i=u.vnode.key;if(i){if(s=e.props.colsMap[i],s===void 0)return}else s=e.props.col;if(s.sortable===!0){const m=s.align==="right"?"unshift":"push";v=fl(t.default,[]),v[m](g(K,{class:s.__iconClass,name:d.iconSet.table.arrowUp}))}else v=de(t.default);const r={class:s.__thClass+(e.autoWidth===!0?" q-table--col-auto-width":""),style:s.headerStyle,onClick:m=>{s.sortable===!0&&e.props.sort(s),c(m)}};return g("th",r,v)}}}),re=oe({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:t}){const n=ce(),u=p(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return g("td",{class:u.value},de(t.default));const d=n.vnode.key,c=(e.props.colsMap!==void 0?e.props.colsMap[d]:null)||e.props.col;if(c===void 0)return;const{row:s}=e.props;return g("td",{class:u.value+c.__tdClass(s),style:c.__tdStyle(s)},de(t.default))}}}),Al=oe({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:t}){const n=p(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>g("tr",{class:n.value},de(t.default))}});const Fl=["horizontal","vertical","cell","none"];var Ol=oe({name:"QMarkupTable",props:{...et,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:e=>Fl.includes(e)}},setup(e,{slots:t}){const n=ce(),u=tt(e,n.proxy.$q),d=p(()=>`q-markup-table q-table__container q-table__card q-table--${e.separator}-separator`+(u.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(e.dense===!0?" q-table--dense":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")+(e.square===!0?" q-table--square":"")+(e.wrapCells===!1?" q-table--no-wrap":""));return()=>g("div",{class:d.value},[g("table",{class:"q-table"},de(t.default))])}});function Ft(e,t){return g("div",e,[g("table",{class:"q-table"},t)])}const Il={list:At,table:Ol},Ml=["list","table","__qtable"];var Bl=oe({name:"QVirtualScroll",props:{...il,type:{type:String,default:"list",validator:e=>Ml.includes(e)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}},setup(e,{slots:t,attrs:n}){let u;const d=O(null),c=p(()=>e.itemsSize>=0&&e.itemsFn!==void 0?parseInt(e.itemsSize,10):Array.isArray(e.items)?e.items.length:0),{virtualScrollSliceRange:s,localResetVirtualScroll:v,padVirtualScroll:i,onVirtualScrollEvt:r}=dl({virtualScrollLength:c,getVirtualScrollTarget:N,getVirtualScrollEl:D}),m=p(()=>{if(c.value===0)return[];const f=(S,k)=>({index:s.value.from+k,item:S});return e.itemsFn===void 0?e.items.slice(s.value.from,s.value.to).map(f):e.itemsFn(s.value.from,s.value.to-s.value.from).map(f)}),C=p(()=>"q-virtual-scroll q-virtual-scroll"+(e.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(e.scrollTarget!==void 0?"":" scroll")),P=p(()=>e.scrollTarget!==void 0?{}:{tabindex:0});H(c,()=>{v()}),H(()=>e.scrollTarget,()=>{w(),T()});function D(){return d.value.$el||d.value}function N(){return u}function T(){u=yl(D(),e.scrollTarget),u.addEventListener("scroll",r,bt.passive)}function w(){u!==void 0&&(u.removeEventListener("scroll",r,bt.passive),u=void 0)}function _(){let f=i(e.type==="list"?"div":"tbody",m.value.map(t.default));return t.before!==void 0&&(f=t.before().concat(f)),Nt(t.after,f)}return Ze(()=>{v()}),Dt(()=>{T()}),bl(()=>{T()}),gl(()=>{w()}),Vt(()=>{w()}),()=>{if(t.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return e.type==="__qtable"?Ft({ref:d,class:"q-table__middle "+C.value},_()):g(Il[e.type],{...n,ref:d,class:[n.class,C.value],...P.value},_)}}});const El={xs:2,sm:4,md:6,lg:10,xl:14};function St(e,t,n){return{transform:t===!0?`translateX(${n.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var zl=oe({name:"QLinearProgress",props:{...et,..._l,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:t}){const{proxy:n}=ce(),u=tt(e,n.$q),d=Sl(e,El),c=p(()=>e.indeterminate===!0||e.query===!0),s=p(()=>e.reverse!==e.query),v=p(()=>({...d.value!==null?d.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),i=p(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),r=p(()=>St(e.buffer!==void 0?e.buffer:1,s.value,n.$q)),m=p(()=>`with${e.instantFeedback===!0?"out":""}-transition`),C=p(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${m.value} q-linear-progress__track--${u.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),P=p(()=>St(c.value===!0?1:e.value,s.value,n.$q)),D=p(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${m.value} q-linear-progress__model--${c.value===!0?"in":""}determinate`),N=p(()=>({width:`${e.value*100}%`})),T=p(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${m.value}`);return()=>{const w=[g("div",{class:C.value,style:r.value}),g("div",{class:D.value,style:P.value})];return e.stripe===!0&&c.value===!1&&w.push(g("div",{class:T.value,style:N.value})),g("div",{class:i.value,style:v.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},Nt(t.default,w))}}});let be=0;const Ll={fullscreen:Boolean,noRouteFullscreenExit:Boolean},Ql=["update:fullscreen","fullscreen"];function jl(){const e=ce(),{props:t,emit:n,proxy:u}=e;let d,c,s;const v=O(!1);pl(e)===!0&&H(()=>u.$route.fullPath,()=>{t.noRouteFullscreenExit!==!0&&m()}),H(()=>t.fullscreen,C=>{v.value!==C&&i()}),H(v,C=>{n("update:fullscreen",C),n("fullscreen",C)});function i(){v.value===!0?m():r()}function r(){v.value!==!0&&(v.value=!0,s=u.$el.parentNode,s.replaceChild(c,u.$el),document.body.appendChild(u.$el),be++,be===1&&document.body.classList.add("q-body--fullscreen-mixin"),d={handler:m},gt.add(d))}function m(){v.value===!0&&(d!==void 0&&(gt.remove(d),d=void 0),s.replaceChild(u.$el,c),v.value=!1,be=Math.max(0,be-1),be===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),u.$el.scrollIntoView!==void 0&&setTimeout(()=>{u.$el.scrollIntoView()})))}return Ze(()=>{c=document.createElement("span")}),Dt(()=>{t.fullscreen===!0&&r()}),Vt(m),Object.assign(u,{toggleFullscreen:i,setFullscreen:r,exitFullscreen:m}),{inFullscreen:v,toggleFullscreen:i}}function Hl(e,t){return new Date(e)-new Date(t)}const Yl={sortMethod:Function,binaryStateSort:Boolean,columnSortOrder:{type:String,validator:e=>e==="ad"||e==="da",default:"ad"}};function Gl(e,t,n,u){const d=p(()=>{const{sortBy:v}=t.value;return v&&n.value.find(i=>i.name===v)||null}),c=p(()=>e.sortMethod!==void 0?e.sortMethod:(v,i,r)=>{const m=n.value.find(D=>D.name===i);if(m===void 0||m.field===void 0)return v;const C=r===!0?-1:1,P=typeof m.field=="function"?D=>m.field(D):D=>D[m.field];return v.sort((D,N)=>{let T=P(D),w=P(N);return m.rawSort!==void 0?m.rawSort(T,w,D,N)*C:T==null?-1*C:w==null?1*C:m.sort!==void 0?m.sort(T,w,D,N)*C:Ye(T)===!0&&Ye(w)===!0?(T-w)*C:yt(T)===!0&&yt(w)===!0?Hl(T,w)*C:typeof T=="boolean"&&typeof w=="boolean"?(T-w)*C:([T,w]=[T,w].map(_=>(_+"").toLocaleString().toLowerCase()),T<w?-1*C:T===w?0:C)})});function s(v){let i=e.columnSortOrder;if(wl(v)===!0)v.sortOrder&&(i=v.sortOrder),v=v.name;else{const C=n.value.find(P=>P.name===v);C!==void 0&&C.sortOrder&&(i=C.sortOrder)}let{sortBy:r,descending:m}=t.value;r!==v?(r=v,m=i==="da"):e.binaryStateSort===!0?m=!m:m===!0?i==="ad"?r=null:m=!1:i==="ad"?m=!0:r=null,u({sortBy:r,descending:m,page:1})}return{columnToSort:d,computedSortMethod:c,sort:s}}const Wl={filter:[String,Object],filterMethod:Function};function Jl(e,t){const n=p(()=>e.filterMethod!==void 0?e.filterMethod:(u,d,c,s)=>{const v=d?d.toLowerCase():"";return u.filter(i=>c.some(r=>{const m=s(r,i)+"";return(m==="undefined"||m==="null"?"":m.toLowerCase()).indexOf(v)!==-1}))});return H(()=>e.filter,()=>{Rt(()=>{t({page:1},!0)})},{deep:!0}),{computedFilterMethod:n}}function Kl(e,t){for(const n in t)if(t[n]!==e[n])return!1;return!0}function pt(e){return e.page<1&&(e.page=1),e.rowsPerPage!==void 0&&e.rowsPerPage<1&&(e.rowsPerPage=0),e}const Zl={pagination:Object,rowsPerPageOptions:{type:Array,default:()=>[5,7,10,15,20,25,50,0]},"onUpdate:pagination":[Function,Array]};function Xl(e,t){const{props:n,emit:u}=e,d=O(Object.assign({sortBy:null,descending:!1,page:1,rowsPerPage:n.rowsPerPageOptions.length!==0?n.rowsPerPageOptions[0]:5},n.pagination)),c=p(()=>{const m=n["onUpdate:pagination"]!==void 0?{...d.value,...n.pagination}:d.value;return pt(m)}),s=p(()=>c.value.rowsNumber!==void 0);function v(m){i({pagination:m,filter:n.filter})}function i(m={}){Rt(()=>{u("request",{pagination:m.pagination||c.value,filter:m.filter||n.filter,getCellValue:t})})}function r(m,C){const P=pt({...c.value,...m});if(Kl(c.value,P)===!0){s.value===!0&&C===!0&&v(P);return}if(s.value===!0){v(P);return}n.pagination!==void 0&&n["onUpdate:pagination"]!==void 0?u("update:pagination",P):d.value=P}return{innerPagination:d,computedPagination:c,isServerSide:s,requestServerInteraction:i,setPagination:r}}function ea(e,t,n,u,d,c){const{props:s,emit:v,proxy:{$q:i}}=e,r=p(()=>u.value===!0?n.value.rowsNumber||0:c.value),m=p(()=>{const{page:k,rowsPerPage:A}=n.value;return(k-1)*A}),C=p(()=>{const{page:k,rowsPerPage:A}=n.value;return k*A}),P=p(()=>n.value.page===1),D=p(()=>n.value.rowsPerPage===0?1:Math.max(1,Math.ceil(r.value/n.value.rowsPerPage))),N=p(()=>C.value===0?!0:n.value.page>=D.value),T=p(()=>(s.rowsPerPageOptions.includes(t.value.rowsPerPage)?s.rowsPerPageOptions:[t.value.rowsPerPage].concat(s.rowsPerPageOptions)).map(A=>({label:A===0?i.lang.table.allRows:""+A,value:A})));H(D,(k,A)=>{if(k===A)return;const I=n.value.page;k&&!I?d({page:1}):k<I&&d({page:k})});function w(){d({page:1})}function _(){const{page:k}=n.value;k>1&&d({page:k-1})}function f(){const{page:k,rowsPerPage:A}=n.value;C.value>0&&k*A<r.value&&d({page:k+1})}function S(){d({page:D.value})}return s["onUpdate:pagination"]!==void 0&&v("update:pagination",{...n.value}),{firstRowIndex:m,lastRowIndex:C,isFirstPage:P,isLastPage:N,pagesNumber:D,computedRowsPerPageOptions:T,computedRowsNumber:r,firstPage:w,prevPage:_,nextPage:f,lastPage:S}}const ta={selection:{type:String,default:"none",validator:e=>["single","multiple","none"].includes(e)},selected:{type:Array,default:()=>[]}},la=["update:selected","selection"];function aa(e,t,n,u){const d=p(()=>{const N={};return e.selected.map(u.value).forEach(T=>{N[T]=!0}),N}),c=p(()=>e.selection!=="none"),s=p(()=>e.selection==="single"),v=p(()=>e.selection==="multiple"),i=p(()=>n.value.length!==0&&n.value.every(N=>d.value[u.value(N)]===!0)),r=p(()=>i.value!==!0&&n.value.some(N=>d.value[u.value(N)]===!0)),m=p(()=>e.selected.length);function C(N){return d.value[N]===!0}function P(){t("update:selected",[])}function D(N,T,w,_){t("selection",{rows:T,added:w,keys:N,evt:_});const f=s.value===!0?w===!0?T:[]:w===!0?e.selected.concat(T):e.selected.filter(S=>N.includes(u.value(S))===!1);t("update:selected",f)}return{hasSelectionMode:c,singleSelection:s,multipleSelection:v,allRowsSelected:i,someRowsSelected:r,rowsSelectedNumber:m,isRowSelected:C,clearSelection:P,updateSelection:D}}function wt(e){return Array.isArray(e)?e.slice():[]}const ra={expanded:Array},oa=["update:expanded"];function na(e,t){const n=O(wt(e.expanded));H(()=>e.expanded,s=>{n.value=wt(s)});function u(s){return n.value.includes(s)}function d(s){e.expanded!==void 0?t("update:expanded",s):n.value=s}function c(s,v){const i=n.value.slice(),r=i.indexOf(s);v===!0?r===-1&&(i.push(s),d(i)):r!==-1&&(i.splice(r,1),d(i))}return{isRowExpanded:u,setExpanded:d,updateExpanded:c}}const sa={visibleColumns:Array};function ua(e,t,n){const u=p(()=>{if(e.columns!==void 0)return e.columns;const v=e.rows[0];return v!==void 0?Object.keys(v).map(i=>({name:i,label:i.toUpperCase(),field:i,align:Ye(v[i])?"right":"left",sortable:!0})):[]}),d=p(()=>{const{sortBy:v,descending:i}=t.value;return(e.visibleColumns!==void 0?u.value.filter(m=>m.required===!0||e.visibleColumns.includes(m.name)===!0):u.value).map(m=>{const C=m.align||"right",P=`text-${C}`;return{...m,align:C,__iconClass:`q-table__sort-icon q-table__sort-icon--${C}`,__thClass:P+(m.headerClasses!==void 0?" "+m.headerClasses:"")+(m.sortable===!0?" sortable":"")+(m.name===v?` sorted ${i===!0?"sort-desc":""}`:""),__tdStyle:m.style!==void 0?typeof m.style!="function"?()=>m.style:m.style:()=>null,__tdClass:m.classes!==void 0?typeof m.classes!="function"?()=>P+" "+m.classes:D=>P+" "+m.classes(D):()=>P}})}),c=p(()=>{const v={};return d.value.forEach(i=>{v[i.name]=i}),v}),s=p(()=>e.tableColspan!==void 0?e.tableColspan:d.value.length+(n.value===!0?1:0));return{colList:u,computedCols:d,computedColsMap:c,computedColspan:s}}const qe="q-table__bottom row items-center",Ot={};kt.forEach(e=>{Ot[e]={}});var ia=oe({name:"QTable",props:{rows:{type:Array,default:()=>[]},rowKey:{type:[String,Function],default:"id"},columns:Array,loading:Boolean,iconFirstPage:String,iconPrevPage:String,iconNextPage:String,iconLastPage:String,title:String,hideHeader:Boolean,grid:Boolean,gridHeader:Boolean,dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,separator:{type:String,default:"horizontal",validator:e=>["horizontal","vertical","cell","none"].includes(e)},wrapCells:Boolean,virtualScroll:Boolean,virtualScrollTarget:{default:void 0},...Ot,noDataLabel:String,noResultsLabel:String,loadingLabel:String,selectedRowsLabel:Function,rowsPerPageLabel:String,paginationLabel:Function,color:{type:String,default:"grey-8"},titleClass:[String,Array,Object],tableStyle:[String,Array,Object],tableClass:[String,Array,Object],tableHeaderStyle:[String,Array,Object],tableHeaderClass:[String,Array,Object],cardContainerClass:[String,Array,Object],cardContainerStyle:[String,Array,Object],cardStyle:[String,Array,Object],cardClass:[String,Array,Object],hideBottom:Boolean,hideSelectedBanner:Boolean,hideNoData:Boolean,hidePagination:Boolean,onRowClick:Function,onRowDblclick:Function,onRowContextmenu:Function,...et,...Ll,...sa,...Wl,...Zl,...ra,...ta,...Yl},emits:["request","virtualScroll",...Ql,...oa,...la],setup(e,{slots:t,emit:n}){const u=ce(),{proxy:{$q:d}}=u,c=tt(e,d),{inFullscreen:s,toggleFullscreen:v}=jl(),i=p(()=>typeof e.rowKey=="function"?e.rowKey:a=>a[e.rowKey]),r=O(null),m=O(null),C=p(()=>e.grid!==!0&&e.virtualScroll===!0),P=p(()=>" q-table__card"+(c.value===!0?" q-table__card--dark q-dark":"")+(e.square===!0?" q-table--square":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")),D=p(()=>`q-table__container q-table--${e.separator}-separator column no-wrap`+(e.grid===!0?" q-table--grid":P.value)+(c.value===!0?" q-table--dark":"")+(e.dense===!0?" q-table--dense":"")+(e.wrapCells===!1?" q-table--no-wrap":"")+(s.value===!0?" fullscreen scroll":"")),N=p(()=>D.value+(e.loading===!0?" q-table--loading":""));H(()=>e.tableStyle+e.tableClass+e.tableHeaderStyle+e.tableHeaderClass+D.value,()=>{C.value===!0&&m.value!==null&&m.value.reset()});const{innerPagination:T,computedPagination:w,isServerSide:_,requestServerInteraction:f,setPagination:S}=Xl(u,ue),{computedFilterMethod:k}=Jl(e,S),{isRowExpanded:A,setExpanded:I,updateExpanded:Y}=na(e,n),ne=p(()=>{let a=e.rows;if(_.value===!0||a.length===0)return a;const{sortBy:y,descending:h}=w.value;return e.filter&&(a=k.value(a,e.filter,G.value,ue)),zt.value!==null&&(a=Lt.value(e.rows===a?a.slice():a,y,h)),a}),ve=p(()=>ne.value.length),Q=p(()=>{let a=ne.value;if(_.value===!0)return a;const{rowsPerPage:y}=w.value;return y!==0&&(_e.value===0&&e.rows!==a?a.length>Se.value&&(a=a.slice(0,Se.value)):a=a.slice(_e.value,Se.value)),a}),{hasSelectionMode:se,singleSelection:It,multipleSelection:lt,allRowsSelected:Mt,someRowsSelected:at,rowsSelectedNumber:Ne,isRowSelected:Re,clearSelection:Bt,updateSelection:ye}=aa(e,n,Q,i),{colList:Et,computedCols:G,computedColsMap:rt,computedColspan:ot}=ua(e,w,se),{columnToSort:zt,computedSortMethod:Lt,sort:$e}=Gl(e,w,Et,S),{firstRowIndex:_e,lastRowIndex:Se,isFirstPage:Ae,isLastPage:Fe,pagesNumber:pe,computedRowsPerPageOptions:Qt,computedRowsNumber:we,firstPage:Oe,prevPage:Ie,nextPage:Me,lastPage:Be}=ea(u,T,w,_,S,ve),jt=p(()=>Q.value.length===0),Ht=p(()=>{const a={};return kt.forEach(y=>{a[y]=e[y]}),a.virtualScrollItemSize===void 0&&(a.virtualScrollItemSize=e.dense===!0?28:48),a});function Yt(){C.value===!0&&m.value.reset()}function Gt(){if(e.grid===!0)return nl();const a=e.hideHeader!==!0?dt:null;if(C.value===!0){const h=t["top-row"],U=t["bottom-row"],q={default:$=>st($.item,t.body,$.index)};if(h!==void 0){const $=g("tbody",h({cols:G.value}));q.before=a===null?()=>$:()=>[a()].concat($)}else a!==null&&(q.before=a);return U!==void 0&&(q.after=()=>g("tbody",U({cols:G.value}))),g(Bl,{ref:m,class:e.tableClass,style:e.tableStyle,...Ht.value,scrollTarget:e.virtualScrollTarget,items:Q.value,type:"__qtable",tableColspan:ot.value,onVirtualScroll:Jt},q)}const y=[Kt()];return a!==null&&y.unshift(a()),Ft({class:["q-table__middle scroll",e.tableClass],style:e.tableStyle},y)}function Wt(a,y){if(m.value!==null){m.value.scrollTo(a,y);return}a=parseInt(a,10);const h=r.value.querySelector(`tbody tr:nth-of-type(${a+1})`);if(h!==null){const U=r.value.querySelector(".q-table__middle.scroll"),q=h.offsetTop-e.virtualScrollStickySizeStart,$=q<U.scrollTop?"decrease":"increase";U.scrollTop=q,n("virtualScroll",{index:a,from:0,to:T.value.rowsPerPage-1,direction:$})}}function Jt(a){n("virtualScroll",a)}function nt(){return[g(zl,{class:"q-table__linear-progress",color:e.color,dark:c.value,indeterminate:!0,trackColor:"transparent"})]}function st(a,y,h){const U=i.value(a),q=Re(U);if(y!==void 0)return y(ut({key:U,row:a,pageIndex:h,__trClass:q?"selected":""}));const $=t["body-cell"],R=G.value.map(E=>{const Ce=t[`body-cell-${E.name}`],Ue=Ce!==void 0?Ce:$;return Ue!==void 0?Ue(Zt({key:U,row:a,pageIndex:h,col:E})):g("td",{class:E.__tdClass(a),style:E.__tdStyle(a)},ue(E,a))});if(se.value===!0){const E=t["body-selection"],Ce=E!==void 0?E(Xt({key:U,row:a,pageIndex:h})):[g(Qe,{modelValue:q,color:e.color,dark:c.value,dense:e.dense,"onUpdate:modelValue":(Ue,sl)=>{ye([U],[a],Ue,sl)}})];R.unshift(g("td",{class:"q-table--col-auto-width"},Ce))}const W={key:U,class:{selected:q}};return e.onRowClick!==void 0&&(W.class["cursor-pointer"]=!0,W.onClick=E=>{n("RowClick",E,a,h)}),e.onRowDblclick!==void 0&&(W.class["cursor-pointer"]=!0,W.onDblclick=E=>{n("RowDblclick",E,a,h)}),e.onRowContextmenu!==void 0&&(W.class["cursor-pointer"]=!0,W.onContextmenu=E=>{n("RowContextmenu",E,a,h)}),g("tr",W,R)}function Kt(){const a=t.body,y=t["top-row"],h=t["bottom-row"];let U=Q.value.map((q,$)=>st(q,a,$));return y!==void 0&&(U=y({cols:G.value}).concat(U)),h!==void 0&&(U=U.concat(h({cols:G.value}))),g("tbody",U)}function ut(a){return Ee(a),a.cols=a.cols.map(y=>fe({...y},"value",()=>ue(y,a.row))),a}function Zt(a){return Ee(a),fe(a,"value",()=>ue(a.col,a.row)),a}function Xt(a){return Ee(a),a}function Ee(a){Object.assign(a,{cols:G.value,colsMap:rt.value,sort:$e,rowIndex:_e.value+a.pageIndex,color:e.color,dark:c.value,dense:e.dense}),se.value===!0&&fe(a,"selected",()=>Re(a.key),(y,h)=>{ye([a.key],[a.row],y,h)}),fe(a,"expand",()=>A(a.key),y=>{Y(a.key,y)})}function ue(a,y){const h=typeof a.field=="function"?a.field(y):y[a.field];return a.format!==void 0?a.format(h,y):h}const ie=p(()=>({pagination:w.value,pagesNumber:pe.value,isFirstPage:Ae.value,isLastPage:Fe.value,firstPage:Oe,prevPage:Ie,nextPage:Me,lastPage:Be,inFullscreen:s.value,toggleFullscreen:v}));function el(){const a=t.top,y=t["top-left"],h=t["top-right"],U=t["top-selection"],q=se.value===!0&&U!==void 0&&Ne.value>0,$="q-table__top relative-position row items-center";if(a!==void 0)return g("div",{class:$},[a(ie.value)]);let R;if(q===!0?R=U(ie.value).slice():(R=[],y!==void 0?R.push(g("div",{class:"q-table__control"},[y(ie.value)])):e.title&&R.push(g("div",{class:"q-table__control"},[g("div",{class:["q-table__title",e.titleClass]},e.title)]))),h!==void 0&&(R.push(g("div",{class:"q-table__separator col"})),R.push(g("div",{class:"q-table__control"},[h(ie.value)]))),R.length!==0)return g("div",{class:$},R)}const it=p(()=>at.value===!0?null:Mt.value);function dt(){const a=tl();return e.loading===!0&&t.loading===void 0&&a.push(g("tr",{class:"q-table__progress"},[g("th",{class:"relative-position",colspan:ot.value},nt())])),g("thead",a)}function tl(){const a=t.header,y=t["header-cell"];if(a!==void 0)return a(ze({header:!0})).slice();const h=G.value.map(U=>{const q=t[`header-cell-${U.name}`],$=q!==void 0?q:y,R=ze({col:U});return $!==void 0?$(R):g(X,{key:U.name,props:R},()=>U.label)});if(It.value===!0&&e.grid!==!0)h.unshift(g("th",{class:"q-table--col-auto-width"}," "));else if(lt.value===!0){const U=t["header-selection"],q=U!==void 0?U(ze({})):[g(Qe,{color:e.color,modelValue:it.value,dark:c.value,dense:e.dense,"onUpdate:modelValue":ct})];h.unshift(g("th",{class:"q-table--col-auto-width"},q))}return[g("tr",{class:e.tableHeaderClass,style:e.tableHeaderStyle},h)]}function ze(a){return Object.assign(a,{cols:G.value,sort:$e,colsMap:rt.value,color:e.color,dark:c.value,dense:e.dense}),lt.value===!0&&fe(a,"selected",()=>it.value,ct),a}function ct(a){at.value===!0&&(a=!1),ye(Q.value.map(i.value),Q.value,a)}const he=p(()=>{const a=[e.iconFirstPage||d.iconSet.table.firstPage,e.iconPrevPage||d.iconSet.table.prevPage,e.iconNextPage||d.iconSet.table.nextPage,e.iconLastPage||d.iconSet.table.lastPage];return d.lang.rtl===!0?a.reverse():a});function ll(){if(e.hideBottom===!0)return;if(jt.value===!0){if(e.hideNoData===!0)return;const h=e.loading===!0?e.loadingLabel||d.lang.table.loading:e.filter?e.noResultsLabel||d.lang.table.noResults:e.noDataLabel||d.lang.table.noData,U=t["no-data"],q=U!==void 0?[U({message:h,icon:d.iconSet.table.warning,filter:e.filter})]:[g(K,{class:"q-table__bottom-nodata-icon",name:d.iconSet.table.warning}),h];return g("div",{class:qe+" q-table__bottom--nodata"},q)}const a=t.bottom;if(a!==void 0)return g("div",{class:qe},[a(ie.value)]);const y=e.hideSelectedBanner!==!0&&se.value===!0&&Ne.value>0?[g("div",{class:"q-table__control"},[g("div",[(e.selectedRowsLabel||d.lang.table.selectedRecords)(Ne.value)])])]:[];if(e.hidePagination!==!0)return g("div",{class:qe+" justify-end"},rl(y));if(y.length!==0)return g("div",{class:qe},y)}function al(a){S({page:1,rowsPerPage:a.value})}function rl(a){let y;const{rowsPerPage:h}=w.value,U=e.paginationLabel||d.lang.table.pagination,q=t.pagination,$=e.rowsPerPageOptions.length>1;if(a.push(g("div",{class:"q-table__separator col"})),$===!0&&a.push(g("div",{class:"q-table__control"},[g("span",{class:"q-table__bottom-item"},[e.rowsPerPageLabel||d.lang.table.recordsPerPage]),g(je,{class:"q-table__select inline q-table__bottom-item",color:e.color,modelValue:h,options:Qt.value,displayValue:h===0?d.lang.table.allRows:h,dark:c.value,borderless:!0,dense:!0,optionsDense:!0,optionsCover:!0,"onUpdate:modelValue":al})])),q!==void 0)y=q(ie.value);else if(y=[g("span",h!==0?{class:"q-table__bottom-item"}:{},[h?U(_e.value+1,Math.min(Se.value,we.value),we.value):U(1,ve.value,we.value)])],h!==0&&pe.value>1){const R={color:e.color,round:!0,dense:!0,flat:!0};e.dense===!0&&(R.size="sm"),pe.value>2&&y.push(g(F,{key:"pgFirst",...R,icon:he.value[0],disable:Ae.value,onClick:Oe})),y.push(g(F,{key:"pgPrev",...R,icon:he.value[1],disable:Ae.value,onClick:Ie}),g(F,{key:"pgNext",...R,icon:he.value[2],disable:Fe.value,onClick:Me})),pe.value>2&&y.push(g(F,{key:"pgLast",...R,icon:he.value[3],disable:Fe.value,onClick:Be}))}return a.push(g("div",{class:"q-table__control"},y)),a}function ol(){const a=e.gridHeader===!0?[g("table",{class:"q-table"},[dt()])]:e.loading===!0&&t.loading===void 0?nt():void 0;return g("div",{class:"q-table__middle"},a)}function nl(){const a=t.item!==void 0?t.item:y=>{const h=y.cols.map(q=>g("div",{class:"q-table__grid-item-row"},[g("div",{class:"q-table__grid-item-title"},[q.label]),g("div",{class:"q-table__grid-item-value"},[q.value])]));if(se.value===!0){const q=t["body-selection"],$=q!==void 0?q(y):[g(Qe,{modelValue:y.selected,color:e.color,dark:c.value,dense:e.dense,"onUpdate:modelValue":(R,W)=>{ye([y.key],[y.row],R,W)}})];h.unshift(g("div",{class:"q-table__grid-item-row"},$),g(cl,{dark:c.value}))}const U={class:["q-table__grid-item-card"+P.value,e.cardClass],style:e.cardStyle};return(e.onRowClick!==void 0||e.onRowDblclick!==void 0)&&(U.class[0]+=" cursor-pointer",e.onRowClick!==void 0&&(U.onClick=q=>{n("RowClick",q,y.row,y.pageIndex)}),e.onRowDblclick!==void 0&&(U.onDblclick=q=>{n("RowDblclick",q,y.row,y.pageIndex)})),g("div",{class:"q-table__grid-item col-xs-12 col-sm-6 col-md-4 col-lg-3"+(y.selected===!0?" q-table__grid-item--selected":"")},[g("div",U,h)])};return g("div",{class:["q-table__grid-content row",e.cardContainerClass],style:e.cardContainerStyle},Q.value.map((y,h)=>a(ut({key:i.value(y),row:y,pageIndex:h}))))}return Object.assign(u.proxy,{requestServerInteraction:f,setPagination:S,firstPage:Oe,prevPage:Ie,nextPage:Me,lastPage:Be,isRowSelected:Re,clearSelection:Bt,isRowExpanded:A,setExpanded:I,sort:$e,resetVirtualScroll:Yt,scrollTo:Wt,getCellValue:ue}),hl(u.proxy,{filteredSortedRows:()=>ne.value,computedRows:()=>Q.value,computedRowsNumber:()=>we.value}),()=>{const a=[el()],y={ref:r,class:N.value};return e.grid===!0?a.push(ol()):Object.assign(y,{class:[y.class,e.cardClass],style:e.cardStyle}),a.push(Gt(),ll()),e.loading===!0&&t.loading!==void 0&&a.push(t.loading()),g("div",y,a)}}});function ht(e){setTimeout(()=>{window.URL.revokeObjectURL(e.href)},1e4),e.remove()}function da(e,t,n={}){const{mimeType:u,byteOrderMark:d,encoding:c}=typeof n=="string"?{mimeType:n}:n,s=c!==void 0?new TextEncoder(c).encode([t]):t,v=d!==void 0?[d,s]:[s],i=new Blob(v,{type:u||"application/octet-stream"}),r=document.createElement("a");r.href=window.URL.createObjectURL(i),r.setAttribute("download",e),typeof r.download=="undefined"&&r.setAttribute("target","_blank"),r.classList.add("hidden"),r.style.position="fixed",document.body.appendChild(r);try{return r.click(),ht(r),!0}catch(m){return ht(r),m}}const Ct=()=>new Date(Date.UTC(new Date().getUTCFullYear(),new Date().getUTCMonth(),new Date().getUTCDate(),new Date().getUTCHours(),new Date().getUTCMinutes(),new Date().getUTCSeconds())),ca=e=>new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),va=e=>{const t=new Date(e.getUTCFullYear(),e.getUTCMonth(),1);return t.setUTCHours(0,0,0,0),t},Te=e=>e.toISOString().split("T")[0],Ut=e=>new Date(e);const ma={class:"q-ma-md column",style:{gap:"0.6rem"}},fa={class:"q-ma-md column",style:{gap:"0.6rem"}},ba={class:"q-mx-md"},ga=le({__name:"UserActivityTable",setup(e){const t=qt(),n=O(null),u=O([{name:"rowNumber",label:"rowNumber",align:"right",field:"",sortable:!1},{name:"activityId",label:"ID",align:"left",field:"activityId",sortable:!1},{name:"date",label:"Date",align:"left",field:"date",sortable:!1},{name:"time",label:"Time",align:"left",field:"time",sortable:!1},{name:"performerUserFullName",label:"Performer User",align:"left",field:"performerUserFullName",sortable:!1},{name:"relatedUserFullName",label:"Related User",align:"left",field:"relatedUserFullName",sortable:!1},{name:"action",label:"Action",align:"left",field:"action",sortable:!1},{name:"description",label:"Description",align:"left",field:"description",sortable:!1}]),d=["rowNumber","date","time","performerUserFullName","relatedUserFullName","action","description"],c=Ct(),s=va(c),v=[{value:"today",label:"Today"},{value:"yesterday",label:"Yesterday"},{value:"monthToDate",label:"Month to Date"},{value:"lastMonth",label:"Last Month"},{value:"custom",label:"Custom"}],i=O(!1),r=O({term:"",timeframe:"monthToDate",dateStart:Te(s),dateEnd:Te(c),searchColumns:["description"],performerUserId:[],relatedUserId:[],actions:[]}),m=p(()=>[...new Set(t.activity.map(w=>w.action))]),C=p(()=>t.activity.map(w=>({value:w.performerUserId,label:w.performerUserFullName})).filter((w,_,f)=>_===f.findIndex(S=>S.label===w.label&&S.value===w.value))),P=p(()=>t.activity.map(w=>({value:w.relatedUserId,label:w.relatedUserFullName})).filter((w,_,f)=>_===f.findIndex(S=>S.label===w.label&&S.value===w.value))),D=w=>{r.value.timeframe=w;const _=Ct(),f=ca(_);let S=new Date,k=new Date;switch(w){case"today":S=f,k=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),_.getUTCDate(),23,59,59));break;case"yesterday":S=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),_.getUTCDate()-1)),k=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),_.getUTCDate(),0,0,-1));break;case"monthToDate":S=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),1)),k=_;break;case"lastMonth":S=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth()-1,1)),k=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth(),0));break;case"custom":S=new Date(r.value.dateStart),k=new Date(r.value.dateEnd),isNaN(S.getTime())||isNaN(k.getTime())?ke({message:"Invalid custom date range",color:"negative",icon:"warning"}):k<S&&ke({message:"End date cannot be before start date",color:"negative",icon:"warning"});break}r.value.dateStart=Te(S),r.value.dateEnd=Te(k)},N=p(()=>{const w=Ut(r.value.dateStart),_=Ut(r.value.dateEnd);return t.activity.filter(f=>{var ne,ve,Q;const S=new Date(f.createdAt),k=S>=w&&S<=_,A=!((ne=r.value.performerUserId)!=null&&ne.length)||r.value.performerUserId.includes(f.performerUserId),I=!((ve=r.value.relatedUserId)!=null&&ve.length)||r.value.relatedUserId.includes(f.relatedUserId),Y=!((Q=r.value.actions)!=null&&Q.length)||r.value.actions.includes(f.action);return k&&A&&I&&Y})}),T=()=>{if(!n.value)return;const w=n.value.filteredSortedRows,_=[u.value.map(I=>_t(I.label))].concat(w.map(I=>u.value.map(Y=>_t(typeof Y.field=="function"?Y.field(I):I[Y.field===void 0?Y.name:Y.field])).join(","))).join(`\r
`),f=new Date,k=`User Activity ${`${f.getFullYear()}-${f.getMonth()+1}-${f.getDate()} ${f.getHours()}-${f.getMinutes()}-${f.getSeconds()}`}.csv`;da(k,_,"text/csv")!==!0?ke({message:"Browser denied file download...",color:"negative",icon:"warning"}):ke({message:"File downloaded successfully...",color:"positive",icon:"download"})};return(w,_)=>(B(),L(Z,null,{default:o(()=>[l(ia,{ref_key:"tableRef",ref:n,rows:N.value,columns:u.value,"row-key":"activityId","rows-per-page-options":[-1],"visible-columns":d,filter:r.value.term,dense:"","hide-pagination":"","virtual-scroll":"",class:"header-table",style:{"min-height":"90vh",overflow:"auto",margin:"0.4rem"}},{top:o(f=>[l(j,{class:"text-h3"},{default:o(()=>[x(" Activity ")]),_:1}),l(ge),l(He,{class:"bg-blue text-white q-ma-md"},{default:o(()=>[l(J,{icon:"priority_high"}),x(" Dates in UTC ")]),_:1}),l(F,{color:"primary",icon:"download",label:"Download",onClick:T}),l(F,{dense:"",icon:f.inFullscreen?"fullscreen_exit":"fullscreen",onClick:f.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"]),l(F,{dense:"",icon:i.value?"more_vert":"more_horiz",onClick:_[0]||(_[0]=S=>i.value=!i.value),class:"q-ml-md"},null,8,["icon"]),Cl(l($t,null,{default:o(()=>[l(Z,{class:"col"},{default:o(()=>[l(z,{class:"q-pa-md",style:{"background-color":"var(--primary-white)"}},{default:o(()=>[l(Ve,null,{default:o(()=>[x(" Summary ")]),_:1}),l(j,null,{default:o(()=>{var S;return[x(" Showing "+V((S=n.value)==null?void 0:S.computedRowsNumber)+" of "+V(b(t).activity.length)+" Rows",1)]}),_:1})]),_:1})]),_:1})]),_:1},512),[[Ul,i.value]])]),"header-cell-rowNumber":o(f=>[l(X,{props:f},{default:o(()=>[l(K,{size:"sm",name:"tag"})]),_:2},1032,["props"])]),"header-cell-date":o(f=>[l(X,{props:f},{default:o(()=>[l(me,{dense:"",round:""},{label:o(()=>[l(J,{icon:"filter_list",size:"sm","text-color":"primary"}),x(" "+V(f.col.label),1)]),default:o(()=>[ee("div",ma,[(B(),Je(Ke,null,Tt(v,S=>l(F,{key:S.value,outline:"",label:S.label,color:r.value.timeframe===S.value?"primary":"",onClick:k=>D(S.value)},null,8,["label","color","onClick"])),64))]),ee("div",fa,[l(M,{outlined:"",debounce:"300",modelValue:r.value.dateStart,"onUpdate:modelValue":_[1]||(_[1]=S=>r.value.dateStart=S),label:"Date Start",type:"date",disable:r.value.timeframe!=="custom"},null,8,["modelValue","disable"]),l(M,{outlined:"",debounce:"300",modelValue:r.value.dateEnd,"onUpdate:modelValue":_[2]||(_[2]=S=>r.value.dateEnd=S),label:"Date End",type:"date",disable:r.value.timeframe!=="custom"},null,8,["modelValue","disable"])])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-time":o(f=>[l(X,{props:f},{default:o(()=>[l(j,{style:{"font-size":"16px"}},{default:o(()=>[x(V(f.col.label),1)]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-performerUserFullName":o(f=>[l(X,{props:f},{default:o(()=>[l(me,{dense:"",round:""},{label:o(()=>[l(J,{icon:"filter_list",size:"sm","text-color":r.value.performerUserId&&r.value.performerUserId.length>0?"primary":""},null,8,["text-color"]),x(" "+V(f.col.label),1)]),default:o(()=>[l(xe,{style:{width:"256px"}},{default:o(()=>[l(ge),l(F,{dense:"",label:"Clear",onClick:_[3]||(_[3]=S=>r.value.performerUserId=[])})]),_:1}),l(Le,{modelValue:r.value.performerUserId,"onUpdate:modelValue":_[4]||(_[4]=S=>r.value.performerUserId=S),options:C.value,type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-relatedUserFullName":o(f=>[l(X,{props:f},{default:o(()=>[l(me,{dense:"",round:""},{label:o(()=>[l(J,{icon:"filter_list",size:"sm","text-color":r.value.relatedUserId&&r.value.relatedUserId.length>0?"primary":""},null,8,["text-color"]),x(" "+V(f.col.label),1)]),default:o(()=>[l(xe,{style:{width:"256px"}},{default:o(()=>[l(ge),l(F,{dense:"",label:"Clear",onClick:_[5]||(_[5]=S=>r.value.relatedUserId=[])})]),_:1}),l(Le,{modelValue:r.value.relatedUserId,"onUpdate:modelValue":_[6]||(_[6]=S=>r.value.relatedUserId=S),options:P.value,type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-action":o(f=>[l(X,{props:f},{default:o(()=>[l(me,{dense:"",round:""},{label:o(()=>[l(J,{icon:"filter_list",size:"sm","text-color":r.value.actions&&r.value.actions.length>0?"primary":""},null,8,["text-color"]),x(" "+V(f.col.label),1)]),default:o(()=>[l(xe,null,{default:o(()=>[l(ge),l(F,{dense:"",label:"Clear",onClick:_[7]||(_[7]=S=>r.value.actions=[])})]),_:1}),l(Le,{modelValue:r.value.actions,"onUpdate:modelValue":_[8]||(_[8]=S=>r.value.actions=S),options:m.value.map(S=>({label:S,value:S})),type:"checkbox"},null,8,["modelValue","options"])]),_:2},1024)]),_:2},1032,["props"])]),"header-cell-description":o(f=>[l(X,{props:f},{default:o(()=>[l(me,{dense:"",round:""},{label:o(()=>[l(J,{icon:"search",size:"sm","text-color":r.value.term!==""?"primary":""},null,8,["text-color"]),x(" "+V(f.col.label),1)]),default:o(()=>[ee("div",ba,[l(M,{outlined:"",dense:"",debounce:"300",modelValue:r.value.term,"onUpdate:modelValue":_[10]||(_[10]=S=>r.value.term=S),type:"search",placeholder:"Description search\u2026",style:{"align-self":"center"}},{append:o(()=>[l(K,{name:r.value.term?"close":"search",class:Ge({"cursor-pointer":r.value.term}),onClick:_[9]||(_[9]=S=>r.value.term?r.value.term="":null)},null,8,["name","class"])]),_:1},8,["modelValue"])])]),_:2},1024)]),_:2},1032,["props"])]),body:o(f=>[l(Al,{props:f},{default:o(()=>[l(re,null,{default:o(()=>[x(V(f.rowIndex+1),1)]),_:2},1024),l(re,{key:"date",props:f},{default:o(()=>[x(V(f.row.date),1)]),_:2},1032,["props"]),l(re,{key:"time",props:f},{default:o(()=>[x(V(f.row.time),1)]),_:2},1032,["props"]),l(re,{key:"performerUserFullName",props:f},{default:o(()=>[x(V(f.row.performerUserFullName),1)]),_:2},1032,["props"]),l(re,{key:"relatedUserFullName",props:f},{default:o(()=>[ee("span",{class:Ge({"text-grey":!f.row.relatedUserFullName})},V(f.row.relatedUserFullName||"No one"),3)]),_:2},1032,["props"]),l(re,{key:"action",props:f},{default:o(()=>{var S;return[l(He,{"text-color":"white",color:((S=b(t).activityActions.find(k=>k.action===f.row.action))==null?void 0:S.color)||"grey"},{default:o(()=>{var k,A;return[l(J,{size:"sm","text-color":"white",icon:((k=b(t).activityActions.find(I=>I.action===f.row.action))==null?void 0:k.icon)||"question_mark",color:((A=b(t).activityActions.find(I=>I.action===f.row.action))==null?void 0:A.color)||"grey"},null,8,["icon","color"]),x(" "+V(f.row.action),1)]}),_:2},1032,["color"])]}),_:2},1032,["props"]),l(re,{key:"description",props:f},{default:o(()=>[x(V(f.row.description),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])]),_:1}))}});var ya=xt(ga,[["__scopeId","data-v-0761c8e6"]]);const _a=le({__name:"UsersSearch",setup(e){const t=ae();return(n,u)=>(B(),L(M,{modelValue:b(t).searchTerm,"onUpdate:modelValue":u[1]||(u[1]=d=>b(t).searchTerm=d),type:"search",placeholder:"Search\u2026",filled:""},{append:o(()=>[l(K,{name:b(t).searchTerm?"close":"search",class:Ge({"cursor-pointer":b(t).searchTerm}),onClick:u[0]||(u[0]=d=>b(t).searchTerm?b(t).searchTerm="":null)},null,8,["name","class"])]),_:1},8,["modelValue"]))}}),Sa={class:"row items-start"},pa={style:{width:"300px"}},wa={class:"col"},Va=le({__name:"UsersPage",setup(e){const t=ae(),n=De(),u=O(!0);return Ze(()=>{n.readSettings(),t.readAllUsers()}),(d,c)=>(B(),Je(Ke,null,[l(Tl),l(xl),l(We,{modelValue:u.value,"onUpdate:modelValue":c[0]||(c[0]=s=>u.value=s),side:"left",width:320,class:"row"},{default:o(()=>[l(vt,{class:"q-pa-md",style:Pt({backgroundColor:"var(--primary-light)"})},{default:o(()=>[l(_a)]),_:1},8,["style"]),l(Nl)]),_:1},8,["modelValue"]),l(kl,{class:"row-container"},{default:o(()=>[l(vt,null,{default:o(()=>[l($t,null,{default:o(()=>[u.value?(B(),L(F,{key:1,onClick:c[2]||(c[2]=s=>u.value=!u.value),icon:"menu"})):(B(),L(F,{key:0,onClick:c[1]||(c[1]=s=>u.value=!u.value),icon:"menu"})),l(Ve,null,{default:o(()=>[x("Users \xBB "+V(b(t).selectedUser.givenName)+" "+V(b(t).selectedUser.surname),1)]),_:1}),l(xe,null,{default:o(()=>[l(F,{icon:b(t).createMode?"close":"add",label:b(t).createMode?"Cancel Create":"Create User",onClick:c[3]||(c[3]=s=>{(b(t).createMode=!b(t).createMode)&&(b(t).editMode=!1)})},null,8,["icon","label"]),l(F,{icon:b(t).editMode?"close":"edit",label:b(t).editMode?"Cancel Edit":"Edit User",onClick:c[4]||(c[4]=s=>{(b(t).editMode=!b(t).editMode)&&(b(t).createMode=!1)})},null,8,["icon","label"])]),_:1})]),_:1})]),_:1}),ee("div",Sa,[ee("div",pa,[l($l)]),ee("div",wa,[l(ya)])])]),_:1})],64))}});export{Va as default};
